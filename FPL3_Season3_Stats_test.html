<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>Stats Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root{--bg:#06060c;--bg2:#0c0c16;--bg3:#12121e;--border:#1a1a30;--cyan:#00f0ff;--cyan-dim:#00f0ff25;--cyan-glow:#00f0ff40;--pink:#ff2d7b;--pink-glow:#ff2d7b40;--purple:#a855f7;--purple-glow:#a855f740;--green:#22c55e;--gold:#ffd700;--silver:#c0c0c0;--bronze:#cd7f32;--text:#e2e8f0;--dim:#4a5568}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'Rajdhani',sans-serif;min-height:100vh;overflow-x:hidden}

/* Particle canvas */
#particleCanvas{position:fixed;inset:0;z-index:0;pointer-events:none}

/* Grid overlay */
body::before{content:'';position:fixed;inset:0;background:linear-gradient(90deg,#00f0ff04 1px,transparent 1px),linear-gradient(0deg,#00f0ff04 1px,transparent 1px);background-size:60px 60px;z-index:0;animation:gridPulse 8s ease-in-out infinite}
@keyframes gridPulse{0%,100%{opacity:.2}50%{opacity:.5}}
body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,#00000008 2px,#00000008 4px);pointer-events:none;z-index:100}

/* Ambient glow orbs */
.ambient-orb{position:fixed;border-radius:50%;filter:blur(80px);opacity:.07;pointer-events:none;z-index:0}
.ambient-orb.o1{width:400px;height:400px;background:var(--cyan);top:-100px;left:-100px;animation:orbFloat1 12s ease-in-out infinite}
.ambient-orb.o2{width:350px;height:350px;background:var(--pink);bottom:-80px;right:-80px;animation:orbFloat2 15s ease-in-out infinite}
.ambient-orb.o3{width:300px;height:300px;background:var(--purple);top:50%;left:50%;animation:orbFloat3 18s ease-in-out infinite}
@keyframes orbFloat1{0%,100%{transform:translate(0,0)}50%{transform:translate(80px,60px)}}
@keyframes orbFloat2{0%,100%{transform:translate(0,0)}50%{transform:translate(-60px,-80px)}}
@keyframes orbFloat3{0%,100%{transform:translate(-50%,-50%)}50%{transform:translate(-30%,-40%)}}

.wrap{max-width:1100px;margin:0 auto;padding:16px;position:relative;z-index:1}

/* Header */
.hdr{text-align:center;padding:40px 0 28px;position:relative}
.hdr::after{content:'';position:absolute;bottom:0;left:5%;right:5%;height:1px;background:linear-gradient(90deg,transparent,var(--cyan),var(--pink),var(--cyan),transparent)}
.hdr::before{content:'';position:absolute;bottom:-1px;left:5%;right:5%;height:3px;background:linear-gradient(90deg,transparent,var(--cyan),var(--pink),var(--cyan),transparent);filter:blur(4px);opacity:.5}

/* Glitch badge */
.badge{display:inline-block;padding:4px 18px;border:1px solid var(--cyan);font-family:'Share Tech Mono',monospace;font-size:10px;letter-spacing:5px;text-transform:uppercase;color:var(--cyan);background:var(--cyan-dim);position:relative;overflow:hidden}
.badge::before{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,240,255,.15),transparent);animation:badgeSweep 3s ease-in-out infinite}
@keyframes badgeSweep{0%{left:-100%}100%{left:200%}}
.badge::after{content:'';position:absolute;inset:0;box-shadow:0 0 12px var(--cyan-glow),inset 0 0 12px var(--cyan-dim);animation:badgeGlow 3s ease-in-out infinite}
@keyframes badgeGlow{0%,100%{opacity:.4}50%{opacity:1}}

/* Glitch title */
.hdr h1{font-family:'Orbitron',sans-serif;font-size:clamp(26px,5vw,50px);font-weight:900;letter-spacing:3px;margin:12px 0 6px;background:linear-gradient(135deg,#fff 0%,var(--cyan) 40%,var(--pink) 70%,var(--purple) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;position:relative;animation:titleShimmer 4s ease-in-out infinite}
@keyframes titleShimmer{0%,100%{filter:brightness(1)}50%{filter:brightness(1.2)}}
.hdr h1::before,.hdr h1::after{content:attr(data-text);position:absolute;left:0;top:0;width:100%;overflow:hidden;background:linear-gradient(135deg,#fff,var(--cyan),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hdr h1::before{animation:glitch1 4s infinite;clip-path:polygon(0 0,100% 0,100% 35%,0 35%)}
.hdr h1::after{animation:glitch2 4s infinite;clip-path:polygon(0 65%,100% 65%,100% 100%,0 100%)}
@keyframes glitch1{0%,92%,100%{transform:translate(0)}93%{transform:translate(-3px,-1px)}96%{transform:translate(2px,1px)}}
@keyframes glitch2{0%,92%,100%{transform:translate(0)}94%{transform:translate(3px,1px)}97%{transform:translate(-2px,-1px)}}
.hdr .sub{font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--dim);letter-spacing:3px;position:relative}
.hdr .sub::before{content:'> ';color:var(--cyan);animation:cursorBlink 1s step-end infinite}
@keyframes cursorBlink{0%,50%{opacity:1}51%,100%{opacity:0}}
.hdr .cred{font-size:11px;color:var(--dim);margin-top:6px;opacity:.4}

/* Meta bar */
.meta-bar{display:flex;justify-content:center;gap:24px;margin:14px 0 0;flex-wrap:wrap}
.meta-item{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--dim);position:relative;padding:4px 0}
.meta-item span{color:var(--cyan);font-weight:700;text-shadow:0 0 8px var(--cyan-glow)}

/* Tab Navigation */
.tab-nav{display:flex;gap:2px;margin:20px 0 16px;flex-wrap:wrap;border-bottom:1px solid var(--border);padding-bottom:0}
.tab-btn{background:transparent;border:1px solid transparent;border-bottom:none;color:var(--dim);font-family:'Orbitron',sans-serif;font-size:10px;font-weight:700;letter-spacing:1.5px;padding:12px 18px;cursor:pointer;transition:all .3s;text-transform:uppercase;position:relative;bottom:-1px;overflow:hidden}
.tab-btn::before{content:'';position:absolute;bottom:0;left:50%;width:0;height:2px;background:var(--cyan);transition:all .3s;transform:translateX(-50%)}
.tab-btn:hover{color:var(--text);background:var(--bg2)}
.tab-btn:hover::before{width:80%}
.tab-btn.active{color:var(--cyan);border-color:var(--border);border-bottom-color:var(--bg);background:var(--bg);text-shadow:0 0 10px var(--cyan-glow)}
.tab-btn.active::before{width:100%;background:var(--cyan);box-shadow:0 0 10px var(--cyan-glow)}
.tab-page{display:none}
.tab-page.active{display:block;animation:pageIn .4s ease}
@keyframes pageIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* Global Filters */
.gfilters{display:flex;gap:10px;margin:0 0 16px;flex-wrap:wrap;align-items:end}
.gfilters .ctrl{min-width:120px}

/* Controls */
.ctrls{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin:0 0 8px}
.ctrls2{display:grid;grid-template-columns:auto 1fr 1fr;gap:10px;margin:0 0 16px}
@media(max-width:768px){.ctrls{grid-template-columns:repeat(3,1fr)}.ctrls2{grid-template-columns:1fr 1fr}}
@media(max-width:480px){.ctrls{grid-template-columns:1fr 1fr}.ctrls2{grid-template-columns:1fr}}
.ctrl{min-width:0}
.ctrl label{display:block;font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--cyan);margin-bottom:4px;text-shadow:0 0 6px var(--cyan-dim)}
.ctrl select{width:100%;background:var(--bg2);border:1px solid var(--border);color:var(--text);font-family:'Rajdhani',sans-serif;font-size:14px;font-weight:600;padding:8px 12px;appearance:none;cursor:pointer;transition:all .3s;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%2300f0ff' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center}
.ctrl select:focus{outline:none;border-color:var(--cyan);box-shadow:0 0 20px var(--cyan-dim),inset 0 0 20px #00f0ff08}
.tog{display:flex;gap:3px}
.tbtn{flex:1;background:var(--bg2);border:1px solid var(--border);color:var(--dim);font-family:'Orbitron',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;padding:8px 4px;cursor:pointer;transition:all .3s;white-space:nowrap}
.tbtn:hover{border-color:var(--dim)}
.tbtn.ah{background:linear-gradient(135deg,#00f0ff10,#22c55e10);border-color:var(--green);color:var(--green);box-shadow:0 0 15px #22c55e15;text-shadow:0 0 8px #22c55e40}
.tbtn.al{background:linear-gradient(135deg,#ff2d7b10,#ef444410);border-color:var(--pink);color:var(--pink);box-shadow:0 0 15px #ff2d7b15;text-shadow:0 0 8px #ff2d7b40}
.tbtn.aa{background:linear-gradient(135deg,#00f0ff10,#a855f710);border-color:var(--purple);color:var(--purple);box-shadow:0 0 15px #a855f715;text-shadow:0 0 8px #a855f740}
.role-checks{display:flex;gap:4px;flex-wrap:wrap}
.rc{cursor:pointer}
.rc input{display:none}
.rb{display:block;padding:6px 10px;font-family:'Orbitron',sans-serif;font-size:10px;font-weight:700;letter-spacing:1px;border:1px solid var(--border);background:var(--bg2);color:var(--dim);transition:all .3s;text-align:center}
.rc input:checked+.rb{border-color:var(--rc);color:var(--rc);background:color-mix(in srgb,var(--rc) 12%,var(--bg2));box-shadow:0 0 12px color-mix(in srgb,var(--rc) 25%,transparent);text-shadow:0 0 6px color-mix(in srgb,var(--rc) 40%,transparent)}
.rc:hover .rb{border-color:var(--dim);transform:translateY(-1px)}

/* Cards with animated edge */
.card{background:var(--bg3);border:1px solid var(--border);padding:20px;margin-bottom:16px;backdrop-filter:blur(8px);position:relative;overflow:hidden;transition:border-color .3s}
.card:hover{border-color:#1a1a40}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--cyan),var(--pink),var(--purple));animation:cardEdge 3s linear infinite;background-size:200% 100%}
@keyframes cardEdge{0%{background-position:0% 0%}100%{background-position:200% 0%}}
.card::after{content:'';position:absolute;top:0;left:0;right:0;height:8px;background:linear-gradient(90deg,var(--cyan),var(--pink),var(--purple));filter:blur(8px);opacity:.25;animation:cardEdge 3s linear infinite;background-size:200% 100%}
.card-t{font-family:'Orbitron',sans-serif;font-size:13px;font-weight:700;letter-spacing:2px;text-transform:uppercase;margin-bottom:2px}
.card-s{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--dim);margin-bottom:20px}

/* Bar Rows */
.brow{display:grid;grid-template-columns:32px 220px 1fr 80px;align-items:center;gap:8px;margin-bottom:5px;opacity:0;transform:translateX(-15px);animation:si .35s ease forwards;cursor:pointer;padding:2px 4px;transition:all .2s}
.brow:hover{background:linear-gradient(90deg,#ffffff08,transparent);box-shadow:inset 2px 0 0 var(--cyan)}
.brow.selected{background:linear-gradient(90deg,#00f0ff0a,transparent);box-shadow:inset 3px 0 0 var(--cyan)}
@media(max-width:600px){.brow{grid-template-columns:24px 140px 1fr 55px;gap:4px}}
.brow .rk{font-family:'Orbitron',sans-serif;font-size:11px;font-weight:800;color:var(--dim);text-align:center}
.brow .rk.r1{color:var(--gold);text-shadow:0 0 12px #ffd70050;animation:goldPulse 2s ease-in-out infinite}
.brow .rk.r2{color:var(--silver);text-shadow:0 0 8px #c0c0c030}
.brow .rk.r3{color:var(--bronze);text-shadow:0 0 8px #cd7f3230}
@keyframes goldPulse{0%,100%{text-shadow:0 0 12px #ffd70050}50%{text-shadow:0 0 20px #ffd70080}}
.brow .pi{overflow:hidden}
.brow .pn{font-weight:700;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:color .2s}
.brow:hover .pn{color:var(--cyan)}
.brow .tn{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:500;color:#94a3b8;white-space:nowrap;overflow:visible}
.bc{height:26px;background:#ffffff06;position:relative;overflow:hidden}
.bf{height:100%;position:relative;transition:width .8s cubic-bezier(.22,1,.36,1);min-width:3px}
.bf::after{content:'';position:absolute;right:0;top:0;bottom:0;width:2px;background:#fff;opacity:.8;box-shadow:0 0 8px currentColor,0 0 16px currentColor}
.bf::before{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(255,255,255,.1) 0%,transparent 50%,rgba(0,0,0,.1) 100%)}
.brow .val{font-family:'Orbitron',sans-serif;font-size:13px;font-weight:700;text-align:right;transition:text-shadow .3s}
.brow:hover .val{text-shadow:0 0 10px currentColor}
@keyframes si{to{opacity:1;transform:translateX(0)}}
.player-count{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--dim);margin-top:12px;padding-top:10px;border-top:1px solid var(--border);text-align:center}

/* Compare Dock */
.cmp-dock{background:var(--bg3);border:1px solid var(--border);padding:20px;margin-bottom:16px;position:relative;overflow:hidden;display:none}
.cmp-dock.active{display:block;animation:dockIn .4s ease}
@keyframes dockIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.cmp-dock::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--pink),var(--cyan),var(--purple));animation:cardEdge 3s linear infinite;background-size:200% 100%}
.cmp-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.cmp-title{font-family:'Orbitron',sans-serif;font-size:13px;font-weight:700;letter-spacing:2px;text-transform:uppercase}
.cmp-clear{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--pink);cursor:pointer;letter-spacing:1px;padding:4px 10px;border:1px solid var(--pink);background:transparent;transition:all .3s}
.cmp-clear:hover{background:#ff2d7b15;box-shadow:0 0 15px var(--pink-glow)}
.cmp-body{display:flex;gap:20px;align-items:flex-start}
@media(max-width:768px){.cmp-body{flex-direction:column;align-items:center}}
.cmp-radar{flex:0 0 280px;height:280px;position:relative}
@media(max-width:600px){.cmp-radar{flex:0 0 220px;height:220px}}
.cmp-cards{flex:1;display:flex;gap:12px;flex-wrap:wrap}
.cmp-card{flex:1;min-width:180px;max-width:280px;background:var(--bg2);border:1px solid var(--border);padding:14px;position:relative;transition:all .3s}
.cmp-card:hover{border-color:var(--dim);transform:translateY(-2px)}
.cmp-card .cmp-accent{position:absolute;top:0;left:0;right:0;height:2px}
.cmp-card .cmp-name{font-family:'Orbitron',sans-serif;font-size:12px;font-weight:700;margin-bottom:2px}
.cmp-card .cmp-sub{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim);margin-bottom:10px}
.cmp-card .cmp-stats{display:grid;grid-template-columns:1fr 1fr;gap:4px 12px}
.cmp-card .cmp-stat{display:flex;justify-content:space-between;font-size:12px}
.cmp-card .cmp-stat .cmp-label{color:var(--dim);font-family:'Share Tech Mono',monospace;font-size:9px}
.cmp-card .cmp-stat .cmp-val{font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700}
.cmp-card .cmp-remove{position:absolute;top:8px;right:8px;background:none;border:none;color:var(--dim);font-size:14px;cursor:pointer;line-height:1;padding:2px 6px;transition:all .2s}
.cmp-card .cmp-remove:hover{color:var(--pink);text-shadow:0 0 8px var(--pink-glow)}
.cmp-empty{flex:1;min-width:180px;max-width:280px;border:1px dashed var(--border);padding:30px 14px;text-align:center;font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--dim);letter-spacing:1px}
.cmp-hint{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--dim);text-align:center;margin-bottom:12px;letter-spacing:1px}

/* Teams */
.team-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:12px}
.team-card{background:var(--bg2);border:1px solid var(--border);padding:16px;position:relative;overflow:hidden;cursor:default;transition:all .3s}
.team-card:hover{border-color:var(--dim);transform:translateY(-2px);box-shadow:0 4px 20px rgba(0,0,0,.3)}
.team-card .tc-accent{position:absolute;top:0;left:0;right:0;height:3px}
.team-card .tc-name{font-family:'Orbitron',sans-serif;font-size:14px;font-weight:700;margin-bottom:2px}
.team-card .tc-record{font-family:'Share Tech Mono',monospace;font-size:11px;margin-bottom:10px}
.team-card .tc-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
.team-card .tc-stat{text-align:center}
.team-card .tc-stat-val{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:700}
.team-card .tc-stat-label{font-family:'Share Tech Mono',monospace;font-size:8px;color:var(--dim);letter-spacing:1px;text-transform:uppercase}
.team-card .tc-roster{margin-top:10px;padding-top:10px;border-top:1px solid var(--border);font-size:12px;color:var(--dim)}
.team-card .tc-roster span{color:var(--text);cursor:pointer;transition:all .2s}
.team-card .tc-roster span:hover{color:var(--cyan);text-shadow:0 0 6px var(--cyan-dim)}

/* Champions */
.champ-table{width:100%;border-collapse:collapse}
.champ-table th{font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--cyan);padding:8px 6px;text-align:left;border-bottom:1px solid var(--border);cursor:pointer;transition:all .2s;user-select:none;white-space:nowrap}
.champ-table th:hover{color:var(--text);text-shadow:0 0 6px var(--cyan-dim)}
.champ-table th.sorted{color:var(--pink);text-shadow:0 0 6px var(--pink-glow)}
.champ-table td{font-size:13px;padding:6px;border-bottom:1px solid #ffffff06;transition:background .2s}
.champ-table tr:hover td{background:#ffffff06}
.champ-table .champ-name{font-weight:700}
.champ-table .champ-bar{height:4px;background:#ffffff08;min-width:60px;position:relative;display:inline-block;vertical-align:middle;margin-left:6px}
.champ-table .champ-bar-fill{height:100%;position:absolute;left:0;top:0}

/* Records */
.records-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px}
.record-card{background:var(--bg2);border:1px solid var(--border);padding:16px;position:relative;overflow:hidden;transition:all .3s}
.record-card:hover{border-color:var(--dim);transform:translateY(-2px)}
.record-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),var(--cyan))}
.record-card::after{content:'';position:absolute;top:0;left:0;right:0;height:6px;background:linear-gradient(90deg,var(--gold),var(--cyan));filter:blur(6px);opacity:.3}
.record-card .rec-cat{font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--cyan);text-transform:uppercase;margin-bottom:8px}
.record-card .rec-val{font-family:'Orbitron',sans-serif;font-size:28px;font-weight:900;margin-bottom:4px}
.record-card .rec-player{font-weight:700;font-size:14px}
.record-card .rec-detail{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--dim);margin-top:4px}

/* MVP */
.mvp-section{margin-bottom:24px}
.mvp-crown{text-align:center;padding:36px 20px;background:linear-gradient(135deg,var(--bg2),var(--bg3));border:1px solid var(--border);position:relative;overflow:hidden;margin-bottom:16px}
.mvp-crown::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--gold),var(--cyan),var(--gold));animation:cardEdge 3s linear infinite;background-size:200% 100%}
.mvp-crown::after{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at center,#ffd70008 0%,transparent 70%)}
.mvp-crown .mvp-label{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--gold);letter-spacing:5px;text-transform:uppercase;text-shadow:0 0 10px #ffd70040}
.mvp-crown .mvp-name{font-family:'Orbitron',sans-serif;font-size:clamp(22px,4vw,38px);font-weight:900;color:var(--gold);margin:10px 0 4px;text-shadow:0 0 30px #ffd70030;animation:mvpGlow 3s ease-in-out infinite}
@keyframes mvpGlow{0%,100%{text-shadow:0 0 30px #ffd70020}50%{text-shadow:0 0 50px #ffd70050,0 0 80px #ffd70020}}
.mvp-crown .mvp-sub{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--dim)}
.mvp-crown .mvp-score{font-family:'Orbitron',sans-serif;font-size:52px;font-weight:900;background:linear-gradient(135deg,var(--gold),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:14px 0}
.mvp-weekly{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}
.mvp-week-card{background:var(--bg2);border:1px solid var(--border);padding:12px;text-align:center;transition:all .3s}
.mvp-week-card:hover{border-color:var(--dim);transform:translateY(-2px)}
.mvp-week-card .mwc-date{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim);letter-spacing:1px}
.mvp-week-card .mwc-name{font-family:'Orbitron',sans-serif;font-size:12px;font-weight:700;margin:4px 0}
.mvp-week-card .mwc-score{font-family:'Orbitron',sans-serif;font-size:18px;font-weight:900}
.mvp-week-card .mwc-line{font-size:11px;color:var(--dim)}

/* Power Rankings */
.pr-row{display:grid;grid-template-columns:40px 200px 1fr 70px;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid #ffffff06;opacity:0;transform:translateX(-15px);animation:si .35s ease forwards;transition:background .2s}
.pr-row:hover{background:#ffffff04}
.pr-row .pr-rank{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:900;text-align:center}
.pr-row .pr-info .pr-name{font-weight:700;font-size:14px;cursor:pointer;transition:all .2s}
.pr-row .pr-info .pr-name:hover{color:var(--cyan);text-shadow:0 0 8px var(--cyan-dim)}
.pr-row .pr-info .pr-detail{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--dim)}
.pr-row .pr-bar{height:30px;background:#ffffff06;position:relative;overflow:hidden}
.pr-row .pr-bar-fill{height:100%;position:relative;transition:width .8s cubic-bezier(.22,1,.36,1)}
.pr-row .pr-bar-fill::after{content:'';position:absolute;right:0;top:0;bottom:0;width:2px;background:#fff;opacity:.8;box-shadow:0 0 8px currentColor}
.pr-row .pr-bar-fill::before{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(255,255,255,.08) 0%,transparent 50%)}
.pr-row .pr-score{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:700;text-align:right}

/* Player Profile Modal */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:200;overflow-y:auto;backdrop-filter:blur(4px)}
.modal-overlay.active{display:flex;justify-content:center;align-items:flex-start;padding:40px 16px;animation:modalIn .3s ease}
@keyframes modalIn{from{opacity:0}to{opacity:1}}
.modal{background:var(--bg);border:1px solid var(--border);max-width:900px;width:100%;padding:24px;position:relative;margin-bottom:40px;animation:modalSlide .3s ease}
@keyframes modalSlide{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.modal::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--cyan),var(--pink),var(--purple));animation:cardEdge 3s linear infinite;background-size:200% 100%}
.modal-close{position:absolute;top:12px;right:16px;background:none;border:none;color:var(--dim);font-size:24px;cursor:pointer;transition:all .3s;z-index:1}
.modal-close:hover{color:var(--pink);text-shadow:0 0 10px var(--pink-glow);transform:rotate(90deg)}
.prof-header{display:flex;gap:20px;align-items:center;margin-bottom:20px;flex-wrap:wrap}
.prof-name{font-family:'Orbitron',sans-serif;font-size:24px;font-weight:900}
.prof-sub{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--dim)}
.prof-rating{font-family:'Orbitron',sans-serif;font-size:36px;font-weight:900;margin-left:auto}
.prof-section{margin-bottom:20px}
.prof-section-title{font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--cyan);margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border);text-shadow:0 0 6px var(--cyan-dim)}
.prof-stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px}
.prof-stat{background:var(--bg2);padding:10px;text-align:center;transition:all .3s;border:1px solid transparent}
.prof-stat:hover{border-color:var(--border);transform:translateY(-1px)}
.prof-stat-val{font-family:'Orbitron',sans-serif;font-size:18px;font-weight:700}
.prof-stat-label{font-family:'Share Tech Mono',monospace;font-size:8px;color:var(--dim);letter-spacing:1px;text-transform:uppercase;margin-top:2px}
.prof-stat-rank{font-family:'Share Tech Mono',monospace;font-size:9px;margin-top:2px}
.prof-champs{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px}
.prof-champ{background:var(--bg2);padding:10px;display:flex;justify-content:space-between;align-items:center;transition:all .3s;border:1px solid transparent}
.prof-champ:hover{border-color:var(--border);transform:translateY(-1px)}
.prof-champ-name{font-weight:700;font-size:13px}
.prof-champ-wr{font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700}
.prof-champ-games{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim)}
.prof-trend{position:relative;height:120px;margin-top:10px}
.prof-vs-avg{display:flex;flex-direction:column;gap:2px;margin-top:10px}
.prof-vs{background:var(--bg2);padding:8px 10px;display:flex;justify-content:space-between;align-items:center;font-size:12px;transition:all .3s;border:1px solid transparent}
.prof-vs:hover{border-color:var(--border)}
.prof-vs .pvl{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim)}
.prof-vs .pvv{font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700}
.prof-vs .pvd{font-family:'Share Tech Mono',monospace;font-size:9px}

/* Loading */
.loading{text-align:center;padding:80px 0}
.loading .spin-wrap{position:relative;display:inline-block;width:60px;height:60px}
.loading .spin{display:inline-block;width:60px;height:60px;border:2px solid var(--border);border-top-color:var(--cyan);border-radius:50%;animation:sp .8s linear infinite}
.loading .spin-inner{position:absolute;inset:8px;border:2px solid var(--border);border-bottom-color:var(--pink);border-radius:50%;animation:sp 1.2s linear infinite reverse}
.loading .spin-dot{position:absolute;top:50%;left:50%;width:6px;height:6px;margin:-3px;background:var(--cyan);border-radius:50%;animation:dotPulse 1.5s ease-in-out infinite;box-shadow:0 0 10px var(--cyan)}
@keyframes sp{to{transform:rotate(360deg)}}
@keyframes dotPulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.5);opacity:.5}}
.loading p{font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--cyan);margin-top:20px;letter-spacing:3px;animation:loadText 2s ease-in-out infinite}
@keyframes loadText{0%,100%{opacity:.5}50%{opacity:1}}
.loading .load-bar{width:200px;height:2px;background:var(--border);margin:12px auto 0;position:relative;overflow:hidden}
.loading .load-bar::after{content:'';position:absolute;left:0;top:0;height:100%;width:40%;background:linear-gradient(90deg,var(--cyan),var(--pink));animation:loadBar 1.5s ease-in-out infinite}
@keyframes loadBar{0%{left:-40%}100%{left:100%}}

.nodata{text-align:center;padding:50px 0;font-family:'Share Tech Mono',monospace;color:var(--dim);font-size:12px}
.load-error{text-align:center;padding:60px 0;font-family:'Share Tech Mono',monospace;color:var(--pink);font-size:12px}
.ftr{text-align:center;padding:30px 0 16px;font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim);letter-spacing:2px;opacity:.3;position:relative}
.ftr::before{content:'';position:absolute;top:0;left:20%;right:20%;height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent)}

/* Back to Top */
.btt{position:fixed;bottom:24px;right:24px;width:42px;height:42px;background:var(--bg3);border:1px solid var(--border);color:var(--cyan);font-size:18px;cursor:pointer;z-index:50;display:none;align-items:center;justify-content:center;transition:all .3s;font-family:'Orbitron',sans-serif}
.btt:hover{background:var(--cyan);color:var(--bg);box-shadow:0 0 25px var(--cyan-glow);border-color:var(--cyan)}
.btt.show{display:flex}

/* Toast */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--bg3);border:1px solid var(--cyan);padding:10px 20px;font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--cyan);z-index:300;transition:transform .3s ease;letter-spacing:1px;box-shadow:0 0 25px var(--cyan-glow)}
.toast.show{transform:translateX(-50%) translateY(0)}

/* Profile Share */
.prof-share{background:transparent;border:1px solid var(--cyan);color:var(--cyan);font-family:'Share Tech Mono',monospace;font-size:10px;padding:6px 14px;cursor:pointer;letter-spacing:1px;transition:all .3s;margin-left:12px;position:relative;overflow:hidden}
.prof-share::before{content:'';position:absolute;inset:0;background:var(--cyan);transform:translateX(-100%);transition:transform .3s}
.prof-share:hover{color:var(--bg)}
.prof-share:hover::before{transform:translateX(0)}
.prof-share span{position:relative;z-index:1}

::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--cyan)}

/* ─── HEX GRID OVERLAY ─── */
.hex-grid{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.03}
.hex-grid svg{width:100%;height:100%}

/* ─── NOISE/GRAIN TEXTURE ─── */
.noise-overlay{position:fixed;inset:0;z-index:99;pointer-events:none;opacity:.035;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");background-repeat:repeat;background-size:128px 128px}

/* ─── GLITCH FLICKER ─── */
.glitch-flicker{position:fixed;inset:0;z-index:98;pointer-events:none;opacity:0;background:linear-gradient(0deg,transparent 40%,rgba(0,240,255,.03) 40.5%,transparent 41%);animation:glitchFlick 8s step-end infinite}
@keyframes glitchFlick{0%,96%,100%{opacity:0}96.5%{opacity:1;transform:translateY(-5px)}97%{opacity:1;transform:translateY(3px)}97.5%{opacity:0}}

/* ─── ESPN-STYLE STAT TICKER ─── */
.stat-ticker{width:100%;overflow:hidden;background:linear-gradient(90deg,var(--bg2),var(--bg3),var(--bg2));border:1px solid var(--border);margin:0 0 8px;padding:0;position:relative;height:28px}
.stat-ticker::before{content:'';position:absolute;left:0;top:0;bottom:0;width:40px;background:linear-gradient(90deg,var(--bg2),transparent);z-index:2}
.stat-ticker::after{content:'';position:absolute;right:0;top:0;bottom:0;width:40px;background:linear-gradient(90deg,transparent,var(--bg2));z-index:2}
.ticker-track{display:flex;gap:30px;animation:tickerScroll 40s linear infinite;white-space:nowrap;align-items:center;height:100%;padding:0 10px}
.ticker-track:hover{animation-play-state:paused}
@keyframes tickerScroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
.ticker-item{font-family:'Share Tech Mono',monospace;font-size:10px;letter-spacing:1px;color:var(--dim);display:flex;align-items:center;gap:6px;flex-shrink:0}
.ticker-item .ti-label{color:var(--dim)}
.ticker-item .ti-val{color:var(--cyan);font-weight:700}
.ticker-item .ti-player{color:var(--text)}
.ticker-sep{color:var(--border);font-size:8px;flex-shrink:0}

/* ─── LIVE INDICATOR ─── */
.live-dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--green);margin-right:4px;animation:livePulse 2s ease-in-out infinite;box-shadow:0 0 6px var(--green)}
@keyframes livePulse{0%,100%{opacity:1;box-shadow:0 0 6px var(--green)}50%{opacity:.4;box-shadow:0 0 2px var(--green)}}

/* ─── BAR HOVER EXPAND ─── */
.brow:hover .bc{height:32px;transition:height .2s}
.bc{transition:height .2s}
.brow:hover .bf{box-shadow:0 0 12px currentColor}

/* ─── HOLOGRAPHIC SHIMMER ON RECORD CARDS ─── */
.record-card{--mx:50%;--my:50%}
.record-card .holo-sheen{position:absolute;inset:0;background:linear-gradient(135deg,transparent 20%,rgba(0,240,255,.04) 40%,rgba(255,45,123,.04) 60%,transparent 80%);opacity:0;transition:opacity .3s;pointer-events:none;mix-blend-mode:screen}
.record-card:hover .holo-sheen{opacity:1}

/* ─── GLASSMORPHISM ON TEAM CARDS ─── */
.team-card:hover{background:rgba(12,12,22,.7);backdrop-filter:blur(12px);border-color:rgba(0,240,255,.15)}

/* ─── #1 ROW PULSE ─── */
.brow-hero{position:relative}
.brow-hero::before{content:'';position:absolute;inset:-2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);opacity:0;animation:heroPulse 3s ease-in-out infinite;pointer-events:none;z-index:-1}
@keyframes heroPulse{0%,100%{opacity:0}50%{opacity:.08}}

/* ─── COUNTING ANIMATION ─── */
.count-up{display:inline-block}

/* ─── ROLE ICON BADGES ─── */
.role-icon{display:inline-block;width:16px;height:16px;text-align:center;font-size:11px;line-height:16px;margin-right:3px;vertical-align:middle;opacity:.7}

/* ─── CONFETTI CANVAS ─── */
#confettiCanvas{position:fixed;inset:0;z-index:250;pointer-events:none}

/* ─── SPARKLINE ─── */
.sparkline{display:inline-block;vertical-align:middle;margin-left:6px}

/* ─── PROFILE STAGGER ─── */
.prof-stat-anim{opacity:0;transform:translateY(8px);animation:statReveal .3s ease forwards}
@keyframes statReveal{to{opacity:1;transform:translateY(0)}}

/* ─── BEST GAME CARD ─── */
.best-game{background:linear-gradient(135deg,var(--bg2),var(--bg3));border:1px solid var(--border);padding:14px;position:relative;overflow:hidden;margin-top:10px}
.best-game::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),var(--cyan),var(--gold));animation:cardEdge 3s linear infinite;background-size:200% 100%}
.best-game .bg-label{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px}
.best-game .bg-stats{display:flex;gap:16px;flex-wrap:wrap}
.best-game .bg-stat{text-align:center}
.best-game .bg-stat-val{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:700}
.best-game .bg-stat-label{font-family:'Share Tech Mono',monospace;font-size:8px;color:var(--dim);letter-spacing:1px}

/* ─── TYPING EFFECT ON LOAD ─── */
.typing{overflow:hidden;white-space:nowrap;border-right:2px solid var(--cyan);animation:typing 1.5s steps(22,end),blinkCaret .5s step-end infinite}
@keyframes typing{from{width:0}to{width:100%}}
@keyframes blinkCaret{50%{border-color:transparent}}

/* ─── CHAMPION PORTRAITS ─── */
.champ-icon{width:24px;height:24px;border-radius:4px;object-fit:cover;vertical-align:middle;margin-right:6px;border:1px solid var(--border);background:var(--bg2);transition:all .3s}
.champ-icon:hover{transform:scale(1.3);border-color:var(--cyan);box-shadow:0 0 10px var(--cyan-dim);z-index:10;position:relative}
.champ-icon-lg{width:36px;height:36px;border-radius:5px;object-fit:cover;border:1px solid var(--border);background:var(--bg2);flex-shrink:0}
.champ-icon-sm{width:18px;height:18px;border-radius:3px;object-fit:cover;vertical-align:middle;margin-right:3px;border:1px solid var(--border);background:var(--bg2)}
.champ-icon-xl{width:48px;height:48px;border-radius:6px;object-fit:cover;border:2px solid var(--border);background:var(--bg2);transition:all .3s}

/* Champion pool grid with portraits */
.prof-champ-icon{display:flex;align-items:center;gap:10px}
.prof-champ{gap:8px}

/* Leaderboard row champion icon */
.brow .champ-mini{width:22px;height:22px;border-radius:3px;object-fit:cover;border:1px solid var(--border);flex-shrink:0;margin-right:4px;vertical-align:middle}

/* ─── SVG RANK BADGES ─── */
.rank-badge{display:inline-flex;align-items:center;justify-content:center;width:32px;height:32px;position:relative}
.rank-badge svg{position:absolute;inset:0;width:100%;height:100%}
.rank-badge .rank-num{position:relative;z-index:1;font-family:'Orbitron',sans-serif;font-size:11px;font-weight:900;margin-top:1px}

/* ─── PLAYER HOVER PREVIEW ─── */
.player-preview{position:fixed;z-index:300;background:var(--bg);border:1px solid var(--border);padding:14px;min-width:240px;max-width:300px;pointer-events:none;opacity:0;transition:opacity .15s;box-shadow:0 8px 32px rgba(0,0,0,.6)}
.player-preview.visible{opacity:1}
.player-preview::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--cyan),var(--pink),var(--purple));animation:cardEdge 3s linear infinite;background-size:200% 100%}
.player-preview .pp-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.player-preview .pp-champs{display:flex;gap:3px;margin-bottom:8px}
.player-preview .pp-name{font-family:'Orbitron',sans-serif;font-size:13px;font-weight:700}
.player-preview .pp-sub{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim)}
.player-preview .pp-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:4px}
.player-preview .pp-stat{text-align:center;background:var(--bg2);padding:6px 4px}
.player-preview .pp-stat-val{font-family:'Orbitron',sans-serif;font-size:12px;font-weight:700}
.player-preview .pp-stat-label{font-family:'Share Tech Mono',monospace;font-size:7px;color:var(--dim);letter-spacing:1px}

/* ─── PLAYER TRADING CARD ─── */
.trading-card-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:350;align-items:center;justify-content:center;backdrop-filter:blur(6px)}
.trading-card-overlay.active{display:flex}
.trading-card{width:320px;background:var(--bg);border:2px solid var(--border);position:relative;overflow:hidden;padding:0;box-shadow:0 0 60px rgba(0,0,0,.8)}
.trading-card .tc-top{position:relative;padding:20px 20px 16px;text-align:center;overflow:hidden}
.trading-card .tc-top::before{content:'';position:absolute;inset:0;opacity:.08}
.trading-card .tc-glow{position:absolute;top:0;left:0;right:0;height:4px;animation:cardEdge 3s linear infinite;background-size:200% 100%}
.trading-card .tc-team-bg{position:absolute;inset:0;opacity:.06}
.trading-card .tc-role-badge{font-size:28px;margin-bottom:4px;position:relative}
.trading-card .tc-player-name{font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;position:relative;letter-spacing:1px}
.trading-card .tc-team-name{font-family:'Share Tech Mono',monospace;font-size:10px;letter-spacing:3px;position:relative;opacity:.6;margin-top:2px}
.trading-card .tc-rating{position:absolute;top:16px;right:16px;font-family:'Orbitron',sans-serif;font-size:28px;font-weight:900;opacity:.9}
.trading-card .tc-mid{padding:0 20px 12px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px}
.trading-card .tc-stat{text-align:center;padding:8px 4px;background:var(--bg2);border:1px solid var(--border)}
.trading-card .tc-stat-val{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:700}
.trading-card .tc-stat-label{font-family:'Share Tech Mono',monospace;font-size:7px;color:var(--dim);letter-spacing:1px;text-transform:uppercase}
.trading-card .tc-champs{display:flex;justify-content:center;gap:4px;padding:10px 20px;border-top:1px solid var(--border)}
.trading-card .tc-bottom{padding:8px 20px 12px;text-align:center;border-top:1px solid var(--border)}
.trading-card .tc-bottom-text{font-family:'Share Tech Mono',monospace;font-size:8px;color:var(--dim);letter-spacing:2px}
.trading-card .tc-close{position:absolute;top:8px;left:12px;background:none;border:none;color:var(--dim);font-size:18px;cursor:pointer;z-index:1;transition:all .2s}
.trading-card .tc-close:hover{color:var(--pink)}
.trading-card .tc-save{position:absolute;top:8px;left:36px;background:none;border:1px solid var(--dim);color:var(--dim);font-family:'Share Tech Mono',monospace;font-size:8px;padding:2px 8px;cursor:pointer;z-index:1;transition:all .2s;letter-spacing:1px}
.trading-card .tc-save:hover{border-color:var(--cyan);color:var(--cyan)}
/* ─── PLAYER LOOKUP ─── */
.lookup-suggestions{display:flex;gap:6px;flex-wrap:wrap}
.lookup-sug{background:var(--bg2);border:1px solid var(--border);padding:6px 12px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:600;transition:all .2s;display:flex;align-items:center;gap:6px}
.lookup-sug:hover{border-color:var(--cyan);color:var(--cyan);transform:translateY(-1px)}
.lookup-sug .ls-team{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim)}

.lookup-profile{animation:pageIn .4s ease}
.lookup-header{display:flex;gap:20px;align-items:center;padding:20px;background:var(--bg2);border:1px solid var(--border);margin-bottom:16px;flex-wrap:wrap;position:relative;overflow:hidden}
.lookup-header::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;animation:cardEdge 3s linear infinite;background-size:200% 100%}
.lookup-header .lh-icon{font-size:32px}
.lookup-header .lh-name{font-family:'Orbitron',sans-serif;font-size:22px;font-weight:900}
.lookup-header .lh-sub{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--dim)}
.lookup-header .lh-rating{font-family:'Orbitron',sans-serif;font-size:40px;font-weight:900;margin-left:auto}
.lookup-header .lh-rating-label{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim);letter-spacing:2px;text-align:right}

.lookup-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}
@media(max-width:768px){.lookup-grid{grid-template-columns:1fr}}
.lookup-card{background:var(--bg2);border:1px solid var(--border);padding:16px;position:relative;overflow:hidden}
.lookup-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--cyan),var(--pink));animation:cardEdge 3s linear infinite;background-size:200% 100%}
.lookup-card .lc-title{font-family:'Orbitron',sans-serif;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--cyan);margin-bottom:10px;text-shadow:0 0 6px var(--cyan-dim)}

.lookup-game-row{display:grid;grid-template-columns:26px 100px 1fr 60px 50px;gap:8px;align-items:center;padding:6px 4px;border-bottom:1px solid #ffffff06;font-size:12px;transition:background .2s}
.lookup-game-row:hover{background:#ffffff06}
.lookup-game-row .lgr-result{font-family:'Orbitron',sans-serif;font-size:9px;font-weight:700;padding:2px 6px;text-align:center}
.lookup-game-row .lgr-champ{font-weight:600;display:flex;align-items:center;gap:4px}
.lookup-game-row .lgr-kda{font-family:'Share Tech Mono',monospace;font-size:11px}
.lookup-game-row .lgr-date{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim)}

.lookup-actions{display:flex;gap:8px;margin-top:16px;flex-wrap:wrap}
.lookup-actions button{background:transparent;border:1px solid var(--border);color:var(--text);font-family:'Share Tech Mono',monospace;font-size:10px;padding:8px 14px;cursor:pointer;letter-spacing:1px;transition:all .3s}
.lookup-actions button:hover{border-color:var(--cyan);color:var(--cyan);box-shadow:0 0 12px var(--cyan-dim)}
/* ─── ADMIN PANEL ─── */









/* ACHIEVEMENT BADGES */
.ach-row{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
.ach-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:1px;font-weight:600;border:1px solid;animation:badgePop .4s ease backwards}
.ach-badge .ach-icon{font-size:13px}
@keyframes badgePop{0%{transform:scale(0);opacity:0}60%{transform:scale(1.2)}100%{transform:scale(1);opacity:1}}

/* CHAMPION MASTERY BORDERS */
.champ-mastery{position:relative;display:inline-block}
.champ-mastery img{border-radius:6px}
.champ-mastery.mastery-bronze{box-shadow:0 0 8px #cd7f32,inset 0 0 4px #cd7f3240;border-radius:8px}
.champ-mastery.mastery-silver{box-shadow:0 0 10px #c0c0c0,inset 0 0 4px #c0c0c040;border-radius:8px}
.champ-mastery.mastery-gold{box-shadow:0 0 12px #ffd700,inset 0 0 6px #ffd70040;border-radius:8px;animation:goldPulse 2s ease infinite}
.champ-mastery.mastery-diamond{box-shadow:0 0 16px #b9f2ff,0 0 30px #b9f2ff40;border-radius:8px;animation:diamondPulse 1.5s ease infinite}
.mastery-tag{position:absolute;bottom:-4px;right:-4px;font-size:7px;font-family:'Orbitron',sans-serif;font-weight:900;padding:1px 4px;border-radius:3px;letter-spacing:1px}
@keyframes goldPulse{0%,100%{box-shadow:0 0 12px #ffd700,inset 0 0 6px #ffd70040}50%{box-shadow:0 0 20px #ffd700,inset 0 0 10px #ffd70060}}
@keyframes diamondPulse{0%,100%{box-shadow:0 0 16px #b9f2ff,0 0 30px #b9f2ff40}50%{box-shadow:0 0 24px #b9f2ff,0 0 40px #b9f2ff60}}

/* HEAD TO HEAD */
.h2h-card{background:var(--bg2);border:1px solid var(--border);padding:16px;margin-top:12px}
.h2h-header{text-align:center;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;margin-bottom:12px;color:var(--dim)}
.h2h-vs{display:flex;align-items:center;justify-content:center;gap:20px;margin-bottom:14px}
.h2h-player{text-align:center;flex:1}
.h2h-player .name{font-family:'Orbitron',sans-serif;font-size:13px;font-weight:700}
.h2h-player .score{font-size:28px;font-family:'Orbitron',sans-serif;font-weight:900}
.h2h-divider{font-family:'Orbitron',sans-serif;font-size:10px;color:var(--dim);letter-spacing:2px}
.h2h-stats{display:grid;grid-template-columns:1fr auto 1fr;gap:6px;font-family:'Share Tech Mono',monospace;font-size:10px}
.h2h-stats .label{text-align:center;color:var(--dim);padding:4px 8px}
.h2h-stats .val{padding:4px 8px;text-align:center}
.h2h-stats .val.left{text-align:right}
.h2h-stats .val.right{text-align:left}
.h2h-stats .val.winner{font-weight:700}

/* BROADCAST INTRO */
.intro-overlay{position:fixed;inset:0;background:#000;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:1;transition:opacity .8s ease}
.intro-overlay.done{opacity:0;pointer-events:none}
.intro-logo{font-family:'Orbitron',sans-serif;font-size:36px;font-weight:900;letter-spacing:6px;opacity:0;transform:translateY(30px);animation:introUp 1s ease .3s forwards}
.intro-logo span{background:linear-gradient(135deg,var(--cyan),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.intro-sub{font-family:'Share Tech Mono',monospace;font-size:11px;letter-spacing:4px;color:var(--dim);opacity:0;animation:introFade .6s ease 1s forwards}
.intro-line{width:0;height:2px;background:linear-gradient(90deg,var(--cyan),var(--pink));margin:14px 0;animation:introLine .8s ease .6s forwards}
.intro-stats{display:flex;gap:30px;opacity:0;animation:introFade .6s ease 1.4s forwards}
.intro-stat{text-align:center}
.intro-stat .num{font-family:'Orbitron',sans-serif;font-size:22px;font-weight:900;color:var(--cyan)}
.intro-stat .lbl{font-family:'Share Tech Mono',monospace;font-size:8px;letter-spacing:2px;color:var(--dim);margin-top:2px}
@keyframes introUp{to{opacity:1;transform:translateY(0)}}
@keyframes introFade{to{opacity:1}}
@keyframes introLine{to{width:200px}}
/* PLAYER OF THE WEEK SPOTLIGHT */
.potw{background:linear-gradient(135deg,var(--bg2),var(--bg));border:1px solid var(--border);padding:16px 20px;margin-bottom:16px;position:relative;overflow:hidden}
.potw::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--cyan),var(--pink),var(--purple));animation:cardEdge 3s linear infinite;background-size:200% 100%}
.potw-label{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:var(--dim);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.potw-label .star{color:var(--gold);font-size:14px;animation:starPulse 1.5s ease infinite}
@keyframes starPulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.2)}}
.potw-main{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.potw-champ{width:48px;height:48px;border-radius:8px;border:2px solid var(--cyan)}
.potw-info{flex:1;min-width:180px}
.potw-name{font-family:'Orbitron',sans-serif;font-size:18px;font-weight:900;cursor:pointer;transition:text-shadow .3s}
.potw-name:hover{text-shadow:0 0 20px currentColor}
.potw-team{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--dim);letter-spacing:1px;margin-top:2px}
.potw-stats{display:flex;gap:16px;flex-wrap:wrap}
.potw-stat{text-align:center}
.potw-stat-val{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:700}
.potw-stat-lbl{font-family:'Share Tech Mono',monospace;font-size:7px;color:var(--dim);letter-spacing:1px;margin-top:1px}
.potw-date{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim);margin-left:auto}

/* ANIMATED VS LEAGUE AVERAGE BARS */
.vs-bar-row{display:flex;align-items:center;gap:10px;padding:6px 0;border-bottom:1px solid #ffffff06}
.vs-bar-label{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim);letter-spacing:1px;min-width:90px;text-align:right}
.vs-bar-val{font-family:'Orbitron',sans-serif;font-size:12px;font-weight:700;min-width:55px;text-align:right}
.vs-bar-track{flex:1;height:16px;background:var(--bg);border-radius:2px;position:relative;overflow:hidden;border:1px solid #ffffff08}
.vs-bar-fill{height:100%;border-radius:2px;transition:width 1s cubic-bezier(.2,.8,.3,1);width:0}
.vs-bar-avg-mark{position:absolute;top:0;bottom:0;width:2px;background:var(--dim);opacity:.5;z-index:2}
.vs-bar-avg-label{position:absolute;top:-12px;font-family:'Share Tech Mono',monospace;font-size:7px;color:var(--dim);transform:translateX(-50%)}
.vs-bar-diff{font-family:'Share Tech Mono',monospace;font-size:10px;font-weight:700;min-width:50px}
/* GAME NIGHT TIMELINE */
.tl-wrap{position:relative;padding:20px 0 20px 40px}
.tl-line{position:absolute;left:18px;top:0;bottom:0;width:2px;background:linear-gradient(180deg,var(--cyan),var(--pink),var(--purple))}
.tl-node{position:relative;margin-bottom:24px;animation:statReveal .4s ease backwards}
.tl-dot{position:absolute;left:-30px;top:8px;width:14px;height:14px;border-radius:50%;border:2px solid var(--cyan);background:var(--bg);z-index:2;transition:all .3s}
.tl-node:hover .tl-dot{transform:scale(1.3);box-shadow:0 0 12px var(--cyan)}
.tl-dot.big-night{background:var(--cyan);box-shadow:0 0 10px var(--cyan)}
.tl-card{background:var(--bg2);border:1px solid var(--border);padding:14px 16px;transition:all .3s;cursor:pointer}
.tl-card:hover{border-color:var(--cyan);transform:translateX(4px)}
.tl-date{font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700;letter-spacing:1px;margin-bottom:6px}
.tl-summary{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--dim);letter-spacing:.5px;margin-bottom:8px}
.tl-highlights{display:flex;flex-wrap:wrap;gap:6px}
.tl-tag{font-family:'Share Tech Mono',monospace;font-size:9px;padding:3px 8px;border-radius:3px;border:1px solid;letter-spacing:.5px}
.tl-mvp-tag{background:#ffd70010;color:var(--gold);border-color:#ffd70030}
.tl-record-tag{background:#00f0ff10;color:var(--cyan);border-color:#00f0ff30}
.tl-kill-tag{background:#ef444410;color:#ef4444;border-color:#ef444430}
.tl-penta-tag{background:#b9f2ff10;color:#b9f2ff;border-color:#b9f2ff30}
.tl-match-tag{background:#a855f710;color:var(--purple);border-color:#a855f730}
.tl-streak-tag{background:#22c55e10;color:var(--green);border-color:#22c55e30}
.tl-expand{display:none;margin-top:10px;padding-top:10px;border-top:1px solid var(--border)}
.tl-expand.open{display:block}
.tl-game{display:flex;align-items:center;gap:10px;padding:5px 0;font-family:'Share Tech Mono',monospace;font-size:10px;border-bottom:1px solid #ffffff04}
.tl-game .win{color:var(--green)}
.tl-game .loss{color:var(--pink)}
.tl-game .champ{min-width:80px}
.tl-game .player{min-width:100px;cursor:pointer}
.tl-game .player:hover{text-decoration:underline}
.tl-game .kda{min-width:70px}
/* SCOUTING — PLAYSTYLE TAGS */
.playstyle-row{display:flex;flex-wrap:wrap;gap:6px;margin:10px 0}
.playstyle-tag{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:4px;font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:.8px;border:1px solid}

/* SCOUTING — CONSISTENCY & FORM */
.scout-metrics{display:flex;gap:12px;flex-wrap:wrap;margin:10px 0}
.scout-metric{background:var(--bg2);border:1px solid var(--border);padding:10px 14px;text-align:center;min-width:100px;flex:1}
.scout-metric-val{font-family:'Orbitron',sans-serif;font-size:18px;font-weight:700}
.scout-metric-label{font-family:'Share Tech Mono',monospace;font-size:8px;color:var(--dim);letter-spacing:1px;margin-top:2px}
.scout-metric-sub{font-family:'Share Tech Mono',monospace;font-size:9px;margin-top:4px}
.form-bar{display:flex;gap:2px;justify-content:center;margin-top:6px}
.form-dot{width:8px;height:8px;border-radius:2px}

/* SCOUTING TAB */
.scout-search{display:flex;gap:12px;margin-bottom:16px;align-items:center}
.scout-search input{background:var(--bg2);border:1px solid var(--border);color:var(--text);font-family:'Share Tech Mono',monospace;font-size:13px;padding:10px 16px;flex:1;outline:none;letter-spacing:.5px}
.scout-search input:focus{border-color:var(--cyan)}
.scout-profile{display:none}
.scout-profile.active{display:block}
.scout-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:12px}
.scout-name{font-family:'Orbitron',sans-serif;font-size:22px;font-weight:700}
.scout-sub{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--dim);letter-spacing:1px}
.scout-actions{display:flex;gap:8px}
.scout-btn{background:transparent;border:1px solid var(--border);color:var(--dim);font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:1px;padding:8px 14px;cursor:pointer;transition:all .3s;display:inline-flex;align-items:center;gap:6px}
.scout-btn:hover{border-color:var(--cyan);color:var(--cyan)}
.scout-btn.primary{border-color:var(--cyan);color:var(--cyan)}
.scout-btn.primary:hover{background:var(--cyan);color:var(--bg)}
.scout-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;margin-bottom:16px}
.scout-card{background:var(--bg2);border:1px solid var(--border);padding:14px;position:relative;overflow:hidden}
.scout-card-title{font-family:'Orbitron',sans-serif;font-size:10px;font-weight:700;letter-spacing:2px;color:var(--cyan);margin-bottom:10px;text-transform:uppercase}
.scout-row{display:flex;justify-content:space-between;align-items:center;padding:4px 0;border-bottom:1px solid #ffffff04;font-family:'Share Tech Mono',monospace;font-size:11px}
.scout-row-label{color:var(--dim)}
.scout-row-val{font-weight:700;min-width:64px;text-align:right}
.scout-bar-wrap{display:flex;align-items:center;gap:8px;flex:1;margin-left:12px;margin-right:10px}
.scout-bar-track{flex:1;height:6px;background:#ffffff08;position:relative}
.scout-bar-fill{height:100%;transition:width .8s cubic-bezier(.2,.8,.3,1)}
.scout-bar-pct{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim);min-width:36px;text-align:right}
.scout-laning{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px}
.scout-lane-cell{text-align:center;padding:8px 4px;background:var(--bg);border:1px solid #ffffff04}
.scout-lane-min{font-family:'Share Tech Mono',monospace;font-size:8px;color:var(--dim);letter-spacing:1px}
.scout-lane-val{font-family:'Orbitron',sans-serif;font-size:14px;font-weight:700;margin-top:2px}
.scout-radar-wrap{display:flex;justify-content:center;padding:10px 0}
.scout-suggestions{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
.scout-suggest{background:var(--bg2);border:1px solid var(--border);color:var(--text);font-family:'Share Tech Mono',monospace;font-size:10px;padding:6px 12px;cursor:pointer;transition:all .2s}
.scout-suggest:hover{border-color:var(--cyan);color:var(--cyan)}

/* SCOUTING REPORT EXPORT */
.scout-export-btn{background:transparent;border:1px solid var(--cyan);color:var(--cyan);font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:1px;padding:6px 14px;cursor:pointer;transition:all .3s;display:inline-flex;align-items:center;gap:6px}
.scout-export-btn:hover{background:var(--cyan);color:var(--bg)}
.scout-toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:var(--cyan);color:var(--bg);font-family:'Share Tech Mono',monospace;font-size:11px;padding:10px 24px;border-radius:4px;z-index:999;opacity:0;transition:opacity .3s;letter-spacing:1px}
.scout-toast.show{opacity:1}
</style>
</head>
<body>
<div class="ambient-orb o1"></div>
<div class="ambient-orb o2"></div>
<div class="ambient-orb o3"></div>
<canvas id="particleCanvas"></canvas>
<canvas id="confettiCanvas"></canvas>
<div class="noise-overlay"></div>
<div class="glitch-flicker"></div>
<div class="hex-grid"><svg width="100%" height="100%"><defs><pattern id="hexPattern" width="56" height="49" patternUnits="userSpaceOnUse" patternTransform="scale(1.5)"><path d="M28,0 L56,14 L56,35 L28,49 L0,35 L0,14 Z" fill="none" stroke="rgba(0,240,255,0.08)" stroke-width="0.5"/></pattern></defs><rect width="100%" height="100%" fill="url(#hexPattern)"/></svg></div>
<div class="wrap" style="visibility:hidden" id="mainWrap">
  <header class="hdr">
    <div class="badge">Season 3 // Official Stats</div>
    <h1 data-text="FRANCHISE PREMIER LEAGUE">FRANCHISE PREMIER LEAGUE</h1>
    <div class="sub">PLAYER PERFORMANCE DASHBOARD</div>
    <div class="cred">Stats compiled by Drib x Lizzo Mukkbang</div>
    <div class="meta-bar">
      <div class="meta-item"><span id="mPlayers">—</span> Players</div>
      <div class="meta-item"><span id="mMatches">—</span> Matches</div>
      <div class="meta-item"><span id="mTeams">12</span> Teams</div>
      <div class="meta-item"><span id="mNights">—</span> Game Nights</div>
      <div class="meta-item" id="mDates">Loading…</div>
      <div class="meta-item">Updated: <span class="live-dot"></span><span id="mUpdated">—</span></div>
    </div>
  </header>
  <div class="stat-ticker" id="statTicker" style="display:none"><div class="ticker-track" id="tickerTrack"></div></div>
  <div class="gfilters">
    <div class="ctrl"><label>Season</label><select id="seasonSel" onchange="onGlobalFilter()"><option value="All">All Seasons</option></select></div>
    <div class="ctrl"><label>Phase</label><select id="phaseSel" onchange="onGlobalFilter()"><option value="All">All</option><option value="Regular">Regular</option><option value="Playoffs">Playoffs</option></select></div>
  </div>
  <nav class="tab-nav" id="tabNav">
    <button class="tab-btn active" data-tab="leaderboard">Leaderboard</button>
    <button class="tab-btn" data-tab="teams">Teams</button>
    <button class="tab-btn" data-tab="champions">Champions</button>
    <button class="tab-btn" data-tab="records">Records</button>
    <button class="tab-btn" data-tab="mvp">MVP</button>
    <button class="tab-btn" data-tab="power">Power Rankings</button>
    <button class="tab-btn" data-tab="timeline">📅 Timeline</button>
    <button class="tab-btn" data-tab="scouting">🔍 Scouting</button>
    <button class="tab-btn" data-tab="lookup">🔍 Player Lookup</button>
  </nav>
  <div class="loading" id="loadingEl"><div class="spin-wrap"><div class="spin"></div><div class="spin-inner"></div><div class="spin-dot"></div></div><p class="typing" style="display:inline-block">LOADING MATCH DATA...</p><div class="load-bar"></div></div>
  <div id="potwBanner"></div>
  <div class="tab-page active" id="pg-leaderboard" style="display:none">
    <div class="ctrls" id="ctrlsWrap">
      <div class="ctrl"><label>Stat</label><select id="statSel" onchange="renderLeaderboard()"></select></div>
      <div class="ctrl"><label>View</label><div class="tog"><button class="tbtn ah" id="bHigh" onclick="setType('top10')">▲ TOP 10</button><button class="tbtn" id="bLow" onclick="setType('bot10')">▼ BOT 10</button><button class="tbtn" id="bAll" onclick="setType('all')">ALL</button></div></div>
      <div class="ctrl"><label>&nbsp;</label><div></div></div>
      <div class="ctrl"><label>&nbsp;</label><div></div></div>
      <div class="ctrl"><label>Min Games</label><select id="minGSel" onchange="renderLeaderboard()"><option value="1">1+</option><option value="3">3+</option><option value="5" selected>5+</option><option value="8">8+</option><option value="10">10+</option></select></div>
    </div>
    <div class="ctrls2">
      <div class="ctrl"><label>Role</label><div class="role-checks" id="roleChecks"><label class="rc"><input type="checkbox" value="TOP" checked onchange="renderLeaderboard()"><span class="rb" style="--rc:#ef4444">Top</span></label><label class="rc"><input type="checkbox" value="JUNGLE" checked onchange="renderLeaderboard()"><span class="rb" style="--rc:#22c55e">Jng</span></label><label class="rc"><input type="checkbox" value="MIDDLE" checked onchange="renderLeaderboard()"><span class="rb" style="--rc:#3b82f6">Mid</span></label><label class="rc"><input type="checkbox" value="BOTTOM" checked onchange="renderLeaderboard()"><span class="rb" style="--rc:#f59e0b">Adc</span></label><label class="rc"><input type="checkbox" value="UTILITY" checked onchange="renderLeaderboard()"><span class="rb" style="--rc:#a855f7">Sup</span></label></div></div>
      <div class="ctrl"><label>Team</label><select id="teamSel" onchange="renderLeaderboard()"></select></div>
      <div class="ctrl"><label>Search Player</label><input type="text" id="searchBar" placeholder="Type a name..." oninput="renderLeaderboard()" style="width:100%;background:var(--bg2);border:1px solid var(--border);color:var(--text);font-family:'Rajdhani',sans-serif;font-size:14px;font-weight:600;padding:8px 12px;transition:all .3s;outline:none" onfocus="this.style.borderColor='var(--cyan)';this.style.boxShadow='0 0 20px #00f0ff15'" onblur="this.style.borderColor='var(--border)';this.style.boxShadow='none'"></div>
    </div>
    <div class="card"><div class="card-t" id="chartTitle"></div><div class="card-s" id="chartSub"></div><div id="bars"></div><div class="player-count" id="playerCount"></div></div>
    <div class="cmp-dock" id="cmpDock"><div class="cmp-header"><div class="cmp-title">⚔ Player Comparison</div><button class="cmp-clear" onclick="clearCompare()">CLEAR ALL</button></div><div class="cmp-hint">Click players on the leaderboard to compare (up to 3)</div><div class="cmp-body"><div class="cmp-radar"><canvas id="radarCanvas" width="280" height="280"></canvas></div><div class="cmp-cards" id="cmpCards"></div></div></div>
  </div>
  <div class="tab-page" id="pg-teams"><div class="card"><div class="card-t">Team Standings</div><div class="card-s">Win/Loss Records & Team Stats</div><div id="teamGrid" class="team-grid"></div></div></div>
  <div class="tab-page" id="pg-champions"><div class="card"><div class="card-t">Champion Statistics</div><div class="card-s">League-wide champion performance</div><div id="champContent"></div></div></div>
  <div class="tab-page" id="pg-records"><div class="card"><div class="card-t">League Records</div><div class="card-s">All-time single-game records</div><div id="recordsGrid" class="records-grid"></div></div></div>
  <div class="tab-page" id="pg-mvp"><div id="mvpContent"></div></div>
  <div class="tab-page" id="pg-power"><div class="card"><div class="card-t">Power Rankings</div><div class="card-s">Composite player rating based on weighted stats</div><div style="margin-bottom:12px"><div class="ctrl" style="max-width:200px"><label>Min Games</label><select id="prMinG" onchange="renderPower()"><option value="1">1+</option><option value="3">3+</option><option value="5" selected>5+</option><option value="8">8+</option></select></div></div><div id="powerContent"></div></div></div>
  <div class="tab-page" id="pg-scouting"><div class="card"><div class="card-t">🔍 Player Scouting Report</div><div class="card-s">Deep-dive analytics with laning, team impact, and advanced stats</div><div class="scout-search"><input type="text" id="scoutInput" placeholder="Type a player name..." oninput="onScoutSearch(this.value)"><button class="scout-btn primary" onclick="runScoutReport()">GENERATE REPORT</button></div><div class="scout-suggestions" id="scoutSuggestions"></div><div id="scoutReport" class="scout-profile"></div></div></div>
  <div class="tab-page" id="pg-timeline"><div class="card"><div class="card-t">Game Night Timeline</div><div class="card-s">The story of the season, night by night</div><div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px"><div class="ctrl"><label>From</label><input type="date" id="tlFrom" onchange="renderTimeline()" style="background:var(--bg2);color:var(--text);border:1px solid var(--border);padding:6px 10px;font-family:'Share Tech Mono',monospace;font-size:11px"></div><div class="ctrl"><label>To</label><input type="date" id="tlTo" onchange="renderTimeline()" style="background:var(--bg2);color:var(--text);border:1px solid var(--border);padding:6px 10px;font-family:'Share Tech Mono',monospace;font-size:11px"></div><button onclick="document.getElementById('tlFrom').value='';document.getElementById('tlTo').value='';renderTimeline()" style="background:transparent;border:1px solid var(--border);color:var(--dim);font-family:'Share Tech Mono',monospace;font-size:9px;padding:6px 12px;cursor:pointer;letter-spacing:1px;margin-top:18px">CLEAR</button></div><div id="timelineContent"></div></div></div>
  <div class="tab-page" id="pg-lookup">
    <div class="card">
      <div class="card-t">🔍 Player Lookup</div>
      <div class="card-s">Search any player for a deep-dive stat breakdown</div>
      <div style="display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;align-items:end">
        <div class="ctrl" style="flex:1;min-width:220px"><label>Player Name</label><input type="text" id="lookupInput" placeholder="Start typing a name..." style="width:100%;background:var(--bg2);border:1px solid var(--border);color:var(--text);font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:600;padding:10px 14px;transition:all .3s;outline:none" onfocus="this.style.borderColor='var(--cyan)';this.style.boxShadow='0 0 20px #00f0ff15'" onblur="this.style.borderColor='var(--border)';this.style.boxShadow='none'" oninput="renderLookupSuggestions()"></div>
        <button onclick="executeLookup()" style="background:var(--cyan);border:none;color:var(--bg);font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700;padding:10px 20px;cursor:pointer;letter-spacing:1px;transition:all .3s;height:40px" onmouseover="this.style.boxShadow='0 0 20px var(--cyan-glow)'" onmouseout="this.style.boxShadow='none'">LOOKUP</button>
      </div>
      <div id="lookupSuggestions" style="margin-bottom:16px"></div>
      <div id="lookupResult"></div>
    </div>
  </div>
  <div class="modal-overlay" id="profileModal"><div class="modal"><button class="modal-close" onclick="closeProfile()">✕</button><div id="profileContent"></div></div></div>
  <div class="ftr">FPL SEASON 3 — FRANCHISE PREMIER LEAGUE — POWERED BY RIOT API — LIVE FROM GOOGLE SHEETS</div>
</div>
<button class="btt" id="bttBtn" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Back to top">▲</button>
<div class="player-preview" id="playerPreview"></div>
<div class="trading-card-overlay" id="tradingCardOverlay"></div>
<div class="toast" id="toast"></div>
<script>
// PARTICLE SYSTEM
(function(){
const cv=document.getElementById('particleCanvas'),cx=cv.getContext('2d');let W,H,pts=[];
function rs(){W=cv.width=innerWidth;H=cv.height=innerHeight}rs();addEventListener('resize',rs);
class P{constructor(){this.reset()}reset(){this.x=Math.random()*W;this.y=Math.random()*H;this.vx=(Math.random()-.5)*.15;this.vy=(Math.random()-.5)*.15;this.sz=Math.random()*1.5+.5;this.a=Math.random()*.3+.05;this.c=Math.random()>.7?'0,240,255':'255,45,123';this.life=Math.random()*400+200;this.ml=this.life}update(){this.x+=this.vx;this.y+=this.vy;this.life--;if(this.life<=0||this.x<0||this.x>W||this.y<0||this.y>H)this.reset()}draw(){const f=Math.min(this.life/50,(this.ml-this.life)/50,1);cx.beginPath();cx.arc(this.x,this.y,this.sz,0,Math.PI*2);cx.fillStyle=`rgba(${this.c},${this.a*f})`;cx.fill()}}
for(let i=0;i<60;i++)pts.push(new P);
function anim(){cx.clearRect(0,0,W,H);for(let i=0;i<pts.length;i++)for(let j=i+1;j<pts.length;j++){const dx=pts[i].x-pts[j].x,dy=pts[i].y-pts[j].y,d=Math.sqrt(dx*dx+dy*dy);if(d<120){cx.beginPath();cx.moveTo(pts[i].x,pts[i].y);cx.lineTo(pts[j].x,pts[j].y);cx.strokeStyle=`rgba(0,240,255,${.03*(1-d/120)})`;cx.lineWidth=.5;cx.stroke()}}pts.forEach(p=>{p.update();p.draw()});requestAnimationFrame(anim)}anim()})();

// DATA CONFIG
const SHEET_ID='13AS2PQUOGFKHosSwmQqPlxsSXoUKTO33FOOP21gfm2A';

// XSS Protection — sanitize all sheet data before rendering
function esc(s){if(typeof s!=='string')return s;return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}

function loadSheetJSONP(sheet){return new Promise((resolve,reject)=>{const cb='_gviz_cb_'+Math.random().toString(36).slice(2);const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=responseHandler:${cb}&sheet=${encodeURIComponent(sheet)}`;window[cb]=function(r){delete window[cb];document.body.removeChild(s);try{const cols=r.table.cols.map(c=>c.label||c.id);const rows=r.table.rows.map(r=>{const o={};r.c.forEach((cell,i)=>{o[cols[i]]=cell?(cell.v!==null&&cell.v!==undefined?esc(String(cell.v)):''):''});return o});resolve(rows.map(function(r){if(r['FPL Team']!==undefined&&r['Teams']===undefined)r['Teams']=r['FPL Team'];if(r['Season Phase']!==undefined&&r['Season']===undefined)r['Season']=r['Season Phase'];if(r['First Blood Kill']!==undefined&&r['First Blood']===undefined)r['First Blood']=r['First Blood Kill'];return r}))}catch(e){reject(e)}};const s=document.createElement('script');s.src=url;s.onerror=()=>{delete window[cb];reject(new Error('Failed'))};document.body.appendChild(s)})}

const NAME_MERGES={"Imthegeoff":"JellyBeanGeoff","Reindeer Smolder":"luci","Flying Squirtle":"Flyinq squirtle"};
const STATS=[{name:"KDA",key:"kda",fmt:"dec"},{name:"Kills/Game",key:"killsPerGame",fmt:"dec"},{name:"Deaths/Game",key:"deathsPerGame",fmt:"dec",invert:true},{name:"Assists/Game",key:"assistsPerGame",fmt:"dec"},{name:"CS/Min",key:"csPerMin",fmt:"dec"},{name:"Gold/Min",key:"goldPerMin",fmt:"dec"},{name:"Damage/Min",key:"damagePerMin",fmt:"num"},{name:"Vision Score/Min",key:"visionPerMin",fmt:"dec"},{name:"Damage Taken/Game",key:"damageTakenPerGame",fmt:"num"},{name:"Damage Mitigated/Game",key:"damageMitigatedPerGame",fmt:"num"},{name:"Win Rate %",key:"winRate",fmt:"pct"},{name:"Wards Placed/Game",key:"wardsPlacedPerGame",fmt:"dec"},{name:"Wards Killed/Game",key:"wardsKilledPerGame",fmt:"dec"},{name:"Control Wards/Game",key:"controlWardsPerGame",fmt:"dec"},{name:"Turret Kills/Game",key:"turretKillsPerGame",fmt:"dec"},{name:"Turret Damage/Game",key:"turretDamagePerGame",fmt:"num"},{name:"Objective Damage/Game",key:"objectiveDamagePerGame",fmt:"num"},{name:"Team Dragons/Game",key:"teamDragonsPerGame",fmt:"dec"},{name:"Team Barons/Game",key:"teamBaronsPerGame",fmt:"dec"},{name:"Team Heralds/Game",key:"teamHeraldsPerGame",fmt:"dec"},{name:"Team Grubs/Game",key:"teamGrubsPerGame",fmt:"dec"},{name:"Team Towers/Game",key:"teamTowersPerGame",fmt:"dec"},{name:"First Blood Rate %",key:"firstBloodRate",fmt:"pct"},{name:"Total Kills",key:"totalKills",fmt:"int"},{name:"Total Deaths",key:"totalDeaths",fmt:"int",invert:true},{name:"Total Assists",key:"totalAssists",fmt:"int"},{name:"Double Kills",key:"doubleKills",fmt:"int"},{name:"Triple Kills",key:"tripleKills",fmt:"int"},{name:"Quadra Kills",key:"quadraKills",fmt:"int"},{name:"Penta Kills",key:"pentaKills",fmt:"int"},{name:"Games Played",key:"games",fmt:"int"}];
const TC={"Literal Monkeys":"#f472b6","TFF":"#38bdf8","XSV":"#fb923c","Dorado Gaming":"#a3e635","To The Moon":"#c084fc","Iridescent Dawn":"#fbbf24","Definitely Not Esports":"#f87171","Legacy Esports":"#fb7185","Silversong":"#2dd4bf","Final Boss":"#e879f9","MINT":"#34d399","Flannel Esports":"#818cf8","Flannel Equinox":"#6366f1","Astronauts":"#ef4444","Gladiators":"#f59e0b","Womenphobia":"#8b5cf6","TD Phoenix":"#ec4899","Rising Tide Raiders":"#22c55e","Flannel Banana Bandits":"#f97316","Dota Enjoyers":"#64748b","The Everstone Elite":"#a855f7","Gamblers":"#eab308","MetaShift":"#3b82f6","Divine Ascension":"#14b8a6","Sub":"#475569"};
const ROLE_MAP={TOP:'Top',JUNGLE:'Jng',MIDDLE:'Mid',BOTTOM:'ADC',UTILITY:'Sup'};
let PD=[],RAW=[],ROSTER={},curType='top10',comparePlayers=[],curTab='leaderboard';

// TAB NAV
function switchTab(t,s){curTab=t;document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));const ab=document.querySelector(`.tab-btn[data-tab="${t}"]`);if(ab)ab.classList.add('active');document.querySelectorAll('.tab-page').forEach(p=>p.classList.remove('active'));const pg=document.getElementById('pg-'+t);if(pg)pg.classList.add('active');history.replaceState(null,'','#'+t);renderCurrentTab();if(s)setTimeout(()=>pg.scrollIntoView({behavior:'smooth',block:'start'}),50)}
document.querySelectorAll('.tab-btn').forEach(b=>{b.addEventListener('click',()=>switchTab(b.dataset.tab,true))});
function renderCurrentTab(){if(curTab==='leaderboard')renderLeaderboard();else if(curTab==='teams')renderTeams();else if(curTab==='champions')renderChampions();else if(curTab==='records')renderRecords();else if(curTab==='mvp')renderMVP();else if(curTab==='power')renderPower()}

// HELPERS
function parseDate(d){if(!d)return'';const m=d.match(/Date\((\d+),(\d+),(\d+)/);if(m)return`${m[1]}-${String(parseInt(m[2])+1).padStart(2,'0')}-${String(parseInt(m[3])).padStart(2,'0')}`;if(d.includes('/')){const p=d.split('/');return`${p[2]}-${p[0].padStart(2,'0')}-${p[1].padStart(2,'0')}`}return d.substring(0,10)}
function formatDate(d){if(!d)return'';const M=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];const p=d.split('-');return p.length===3?M[parseInt(p[1])-1]+' '+parseInt(p[2])+', '+p[0]:d}
function fmtVal(v,f){if(v===null||v===undefined)return'-';if(f==='pct')return v.toFixed(1)+'%';if(f==='num'||f==='int')return Math.round(v).toLocaleString('en-US');if(f==='dec')return v.toFixed(2);return v.toString()}

// GLOBAL FILTER
function getFilteredRows(){let r=RAW;const ph=document.getElementById('phaseSel').value;const se=document.getElementById('seasonSel').value;if(ph!=='All')r=r.filter(x=>(x['Season Phase']||'')===ph);if(se!=='All')r=r.filter(x=>(x['Season']||'')===se);return r}
function onGlobalFilter(){const r=getFilteredRows();const res=aggregate(r,ROSTER);PD=res.players;document.getElementById('mPlayers').textContent=PD.length;document.getElementById('mMatches').textContent=res.totalMatches;document.getElementById('mNights').textContent=res.gameNights;document.getElementById('mDates').textContent=res.dateRange||'—';renderCurrentTab()}

// AGGREGATE
function aggregate(matchRows,rosterMap){
const ps={},mids=new Set(),dates=new Set(),ptd={};
for(const r of matchRows){let name=r['Summoner Name']||'';if(NAME_MERGES[name])name=NAME_MERGES[name];if(!name)continue;const team=(r['Teams']||'').trim();const ds=parseDate(r['Date']||'');if(name&&team){if(!ptd[name]||ds>ptd[name].date)ptd[name]={team,date:ds}}mids.add(r['Match ID']||'');dates.add(ds);
if(!ps[name])ps[name]={games:0,kills:0,deaths:0,assists:0,cs:0,gold:0,damage:0,damageTaken:0,vision:0,duration:0,wins:0,doubles:0,triples:0,quadras:0,pentas:0,wardsPlaced:0,wardsKilled:0,controlWards:0,turretKills:0,turretDamage:0,objectiveDamage:0,damageMitigated:0,teamDragons:0,teamBarons:0,teamHeralds:0,teamGrubs:0,teamTowers:0,firstBloods:0,roles:[],champions:[]};
const p=ps[name],n=k=>parseFloat(r[k])||0;p.games++;p.kills+=n('Kills');p.deaths+=n('Deaths');p.assists+=n('Assists');p.cs+=n('CS');p.gold+=n('Gold Earned');p.damage+=n('Total Damage to Champions');p.damageTaken+=n('Damage Taken');p.vision+=n('Vision Score');p.duration+=n('Game Duration (min)');p.wins+=(r['Win']==='Win'?1:0);p.doubles+=n('Double Kills');p.triples+=n('Triple Kills');p.quadras+=n('Quadra Kills');p.pentas+=n('Penta Kills');p.wardsPlaced+=n('Wards Placed');p.wardsKilled+=n('Wards Killed');p.controlWards+=n('Control Wards Bought');p.turretKills+=n('Turret Kills');p.turretDamage+=n('Turret Damage');p.objectiveDamage+=n('Objective Damage');p.damageMitigated+=n('Damage Mitigated');p.teamDragons+=n('Team Dragons');p.teamBarons+=n('Team Barons');p.teamHeralds+=n('Team Heralds');p.teamGrubs+=n('Team Grubs');p.teamTowers+=n('Team Towers');p.firstBloods+=(r['Team First Blood']==='Yes'?1:0);p.roles.push(r['Role']||'MIDDLE');p.champions.push({champ:r['Champion']||'Unknown',win:r['Win']==='Win',kills:n('Kills'),deaths:n('Deaths'),assists:n('Assists'),cs:n('CS'),damage:n('Total Damage to Champions'),duration:n('Game Duration (min)'),date:ds})}
const players=[];for(const[name,s]of Object.entries(ps)){const g=s.games,d=s.duration||1,team=(ptd[name]?ptd[name].team:null)||rosterMap[name]||'Sub';const mainRole=s.roles.length?[...new Set(s.roles)].sort((a,b)=>s.roles.filter(x=>x===b).length-s.roles.filter(x=>x===a).length)[0]:'MIDDLE';
players.push({player:name,team,games:g,wins:s.wins,losses:g-s.wins,winRate:+(s.wins/g*100).toFixed(1),kda:+((s.kills+s.assists)/Math.max(s.deaths,1)).toFixed(2),killsPerGame:+(s.kills/g).toFixed(2),deathsPerGame:+(s.deaths/g).toFixed(2),assistsPerGame:+(s.assists/g).toFixed(2),csPerMin:+(s.cs/d).toFixed(2),goldPerMin:+(s.gold/d).toFixed(1),damagePerMin:+(s.damage/d).toFixed(1),visionPerMin:+(s.vision/d).toFixed(2),damageTakenPerGame:Math.round(s.damageTaken/g),damageMitigatedPerGame:Math.round(s.damageMitigated/g),totalKills:s.kills,totalDeaths:s.deaths,totalAssists:s.assists,doubleKills:s.doubles,tripleKills:s.triples,quadraKills:s.quadras,pentaKills:s.pentas,wardsPlacedPerGame:+(s.wardsPlaced/g).toFixed(1),wardsKilledPerGame:+(s.wardsKilled/g).toFixed(1),controlWardsPerGame:+(s.controlWards/g).toFixed(1),turretKillsPerGame:+(s.turretKills/g).toFixed(1),turretDamagePerGame:Math.round(s.turretDamage/g),objectiveDamagePerGame:Math.round(s.objectiveDamage/g),teamDragonsPerGame:+(s.teamDragons/g).toFixed(1),teamBaronsPerGame:+(s.teamBarons/g).toFixed(1),teamHeraldsPerGame:+(s.teamHeralds/g).toFixed(1),teamGrubsPerGame:+(s.teamGrubs/g).toFixed(1),teamTowersPerGame:+(s.teamTowers/g).toFixed(1),firstBloodRate:+(s.firstBloods/g*100).toFixed(1),mainRole,champData:s.champions})}
players.sort((a,b)=>b.games-a.games);mids.delete('');dates.delete('');const sd=[...dates].sort();const dr=sd.length?formatDate(sd[0])+' — '+formatDate(sd[sd.length-1]):'';return{players,totalMatches:mids.size,gameNights:dates.size,dateRange:dr}}
// LOAD DATA
async function loadData(){try{const mr=await loadSheetJSONP('Sheet1');RAW=mr;ROSTER={};for(const r of mr){let n=(r['Summoner Name']||'').trim();const t=(r['Teams']||'').trim();if(NAME_MERGES[n])n=NAME_MERGES[n];if(n&&t)ROSTER[n]=t}const res=aggregate(mr,ROSTER);PD=res.players;document.getElementById('mPlayers').textContent=PD.length;document.getElementById('mMatches').textContent=res.totalMatches;document.getElementById('mNights').textContent=res.gameNights;document.getElementById('mDates').textContent=res.dateRange;const ss=document.getElementById('statSel');STATS.forEach(s=>{const o=document.createElement('option');o.value=s.key;o.textContent=s.name;ss.appendChild(o)});const ts=[...new Set(PD.map(p=>p.team))].sort();const tS=document.getElementById('teamSel');tS.innerHTML='<option value="All">All Teams</option>';ts.forEach(t=>{const o=document.createElement('option');o.value=t;o.textContent=t;tS.appendChild(o)});document.getElementById('mTeams').textContent=ts.filter(t=>t!=='Sub').length;const now=new Date();document.getElementById('mUpdated').textContent=now.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})+' '+now.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});document.getElementById('loadingEl').style.display='none';document.getElementById('pg-leaderboard').style.removeProperty('display');const h=location.hash.replace('#','');const vt=['leaderboard','teams','champions','records','mvp','power','timeline','scouting','lookup'];if(h&&vt.includes(h))switchTab(h,false);else renderLeaderboard();const up=new URLSearchParams(location.search);const pp=up.get('player');if(pp)setTimeout(()=>openProfile(esc(decodeURIComponent(pp))),200)}catch(e){document.getElementById('loadingEl').innerHTML='<div class="load-error">⚠ FAILED TO LOAD<br><span style="font-size:10px;color:var(--dim)">'+e.message+'</span></div>'}}

// LEADERBOARD
function setType(t){curType=t;document.getElementById('bHigh').className='tbtn'+(t==='top10'?' ah':'');document.getElementById('bLow').className='tbtn'+(t==='bot10'?' al':'');document.getElementById('bAll').className='tbtn'+(t==='all'?' aa':'');renderLeaderboard()}
function renderLeaderboard(){const rows=getFilteredRows();const res=aggregate(rows,ROSTER);PD=res.players;document.getElementById('mPlayers').textContent=PD.length;document.getElementById('mMatches').textContent=res.totalMatches;document.getElementById('mNights').textContent=res.gameNights;document.getElementById('mDates').textContent=res.dateRange||'—';const pt=document.getElementById('teamSel').value;const ts=[...new Set(PD.map(p=>p.team))].sort();const tS=document.getElementById('teamSel');tS.innerHTML='<option value="All">All Teams</option>';ts.forEach(t=>{const o=document.createElement('option');o.value=t;o.textContent=t;tS.appendChild(o)});if(ts.includes(pt))tS.value=pt;else tS.value='All';document.getElementById('mTeams').textContent=ts.filter(t=>t!=='Sub').length;if(!PD.length){document.getElementById('bars').innerHTML='<div class="nodata">NO DATA</div>';return}const sk=document.getElementById('statSel').value;const sc=STATS.find(s=>s.key===sk);const team=document.getElementById('teamSel').value;const mg=parseInt(document.getElementById('minGSel').value);const cr=[...document.querySelectorAll('#roleChecks input:checked')].map(c=>c.value);let data=PD.filter(p=>p.games>=mg).filter(p=>cr.includes(p.mainRole));if(team!=='All')data=data.filter(p=>p.team===team);const inv=sc&&sc.invert;data.sort((a,b)=>inv?a[sk]-b[sk]:b[sk]-a[sk]);data.forEach((d,i)=>d._rank=i+1);const srch=document.getElementById('searchBar').value.toLowerCase();if(srch)data=data.filter(p=>p.player.toLowerCase().includes(srch));else{if(curType==='top10')data=data.slice(0,10);else if(curType==='bot10'){data=data.reverse().slice(0,10)}}const ar={top10:'▲ TOP 10',bot10:'▼ BOTTOM 10',all:'ALL PLAYERS'};document.getElementById('chartTitle').textContent=(sc?sc.name:sk)+' — '+ar[curType];const fl=[];if(team!=='All')fl.push(team.toUpperCase());if(cr.length<5)fl.push(cr.map(r=>ROLE_MAP[r]||r).join(', '));if(mg>1)fl.push(mg+'+ GAMES');const sl=document.getElementById('seasonSel').value==='All'?'ALL SEASONS':document.getElementById('seasonSel').value.toUpperCase();document.getElementById('chartSub').textContent=(fl.length?fl.join(' // ')+' // ':'')+sl;const bd=document.getElementById('bars');if(!data.length){bd.innerHTML='<div class="nodata">NO PLAYERS MATCH FILTERS</div>';document.getElementById('playerCount').textContent='';return}const mx=Math.max(...data.map(d=>Math.abs(d[sk])));bd.innerHTML=data.map((d,i)=>{const pct=(Math.abs(d[sk])/mx*100).toFixed(1);const color=TC[d.team]||'#6366f1';const delay=Math.min(i*0.03,1.5);const role=ROLE_MAP[d.mainRole]||d.mainRole;const sub=d.team+' · '+role+' · '+d.games+'g · '+d.winRate+'% WR';const rank=d._rank||i+1;const rc2=rank===1?'r1':rank===2?'r2':rank===3?'r3':'';const sel=comparePlayers.includes(d.player)?' selected':'';return'<div class="brow'+sel+'" style="animation-delay:'+delay+'s" onclick="toggleCompare(\''+d.player.replace(/'/g,"\\'")+'\')" ondblclick="event.stopPropagation();openProfile(\''+d.player.replace(/'/g,"\\'")+'\')">'+'<div class="rk '+rc2+'">'+rank+'</div>'+'<div class="pi"><div class="pn">'+d.player+'</div><div class="tn">'+sub+'</div></div>'+'<div class="bc"><div class="bf" style="width:'+pct+'%;background:'+color+';color:'+color+'"></div></div>'+'<div class="val" style="color:'+color+'">'+fmtVal(d[sk],sc?sc.fmt:'dec')+'</div></div>'}).join('');document.getElementById('playerCount').textContent='Showing '+data.length+' of '+PD.length+' players · Double-click for profile · Right-click for player card'}

// COMPARE
const RADAR_STATS=[{key:'kda',label:'KDA',max:12},{key:'csPerMin',label:'CS/Min',max:10},{key:'goldPerMin',label:'Gold/Min',max:500},{key:'damagePerMin',label:'DMG/Min',max:800},{key:'visionPerMin',label:'Vision/Min',max:2},{key:'winRate',label:'Win Rate',max:100}];
const COMPARE_STATS=[{key:'kda',label:'KDA',fmt:'dec'},{key:'killsPerGame',label:'K/G',fmt:'dec'},{key:'deathsPerGame',label:'D/G',fmt:'dec'},{key:'assistsPerGame',label:'A/G',fmt:'dec'},{key:'csPerMin',label:'CS/M',fmt:'dec'},{key:'goldPerMin',label:'G/M',fmt:'dec'},{key:'damagePerMin',label:'DMG/M',fmt:'num'},{key:'visionPerMin',label:'VIS/M',fmt:'dec'},{key:'winRate',label:'WR%',fmt:'pct'},{key:'games',label:'Games',fmt:'int'}];
function toggleCompare(n){const i=comparePlayers.indexOf(n);if(i>=0)comparePlayers.splice(i,1);else if(comparePlayers.length<3)comparePlayers.push(n);renderCompare();document.querySelectorAll('.brow').forEach(r=>{const nm=r.querySelector('.pn')?.textContent;r.classList.toggle('selected',comparePlayers.includes(nm))})}
function clearCompare(){comparePlayers=[];renderCompare();document.querySelectorAll('.brow.selected').forEach(r=>r.classList.remove('selected'))}
function renderCompare(){const dk=document.getElementById('cmpDock'),cd=document.getElementById('cmpCards');if(!comparePlayers.length){dk.classList.remove('active');return}dk.classList.add('active');const pls=comparePlayers.map(n=>PD.find(p=>p.player===n)).filter(Boolean);if(!pls.length){dk.classList.remove('active');return}let h='';pls.forEach(p=>{const c=TC[p.team]||'#6366f1',rl=ROLE_MAP[p.mainRole]||p.mainRole;let st='';COMPARE_STATS.forEach(s=>{const vs=pls.map(pl=>pl[s.key]);const best=s.key==='deathsPerGame'?Math.min(...vs):Math.max(...vs);const ib=pls.length>1&&p[s.key]===best;st+=`<div class="cmp-stat"><span class="cmp-label">${s.label}</span><span class="cmp-val" style="color:${ib?c:'var(--text)'}">${fmtVal(p[s.key],s.fmt)}</span></div>`});h+=`<div class="cmp-card"><div class="cmp-accent" style="background:${c}"></div><button class="cmp-remove" onclick="toggleCompare('${p.player.replace(/'/g,"\\'")}')" title="Remove">✕</button><div class="cmp-name" style="color:${c}">${p.player}</div><div class="cmp-sub">${p.team} · ${rl} · ${p.games}g</div><div class="cmp-stats">${st}</div></div>`});for(let i=pls.length;i<3;i++)h+='<div class="cmp-empty">Click a player<br>to add</div>';cd.innerHTML=h;drawRadar(pls);
  // H2H — show when exactly 2 players selected
  var h2hEl=document.getElementById('cmpH2H');
  if(!h2hEl){h2hEl=document.createElement('div');h2hEl.id='cmpH2H';dk.querySelector('.cmp-body').appendChild(h2hEl)}
  if(pls.length===2){
    var c1=TC[pls[0].team]||'#6366f1',c2=TC[pls[1].team]||'#6366f1';
    h2hEl.innerHTML=renderH2H(pls[0].player,pls[1].player,c1,c2);
    if(!h2hEl.innerHTML)h2hEl.innerHTML='<div class="h2h-card"><div class="h2h-header">NO HEAD-TO-HEAD GAMES FOUND</div></div>';
  }else{h2hEl.innerHTML=''}
}
function drawRadar(pls){const cv=document.getElementById('radarCanvas'),cx=cv.getContext('2d');const W=cv.width,H=cv.height,cX=W/2,cY=H/2,R=Math.min(W,H)*.35,n=RADAR_STATS.length;cx.clearRect(0,0,W,H);for(let ring=1;ring<=4;ring++){const r=R*ring/4;cx.beginPath();for(let i=0;i<=n;i++){const a=Math.PI*2*i/n-Math.PI/2,x=cX+r*Math.cos(a),y=cY+r*Math.sin(a);i===0?cx.moveTo(x,y):cx.lineTo(x,y)}cx.strokeStyle='#1a1a3060';cx.lineWidth=1;cx.stroke()}for(let i=0;i<n;i++){const a=Math.PI*2*i/n-Math.PI/2;cx.beginPath();cx.moveTo(cX,cY);cx.lineTo(cX+R*Math.cos(a),cY+R*Math.sin(a));cx.strokeStyle='#1a1a3080';cx.stroke();cx.font='9px "Share Tech Mono",monospace';cx.fillStyle='#4a5568';cx.textAlign='center';cx.textBaseline='middle';cx.fillText(RADAR_STATS[i].label,cX+(R+18)*Math.cos(a),cY+(R+18)*Math.sin(a))}pls.forEach(p=>{const c=TC[p.team]||'#6366f1';cx.beginPath();for(let i=0;i<=n;i++){const si=i%n,v=Math.min(p[RADAR_STATS[si].key]/RADAR_STATS[si].max,1),r=v*R,a=Math.PI*2*si/n-Math.PI/2;i===0?cx.moveTo(cX+r*Math.cos(a),cY+r*Math.sin(a)):cx.lineTo(cX+r*Math.cos(a),cY+r*Math.sin(a))}cx.closePath();cx.fillStyle=c+'20';cx.fill();cx.strokeStyle=c;cx.lineWidth=2;cx.stroke();for(let i=0;i<n;i++){const v=Math.min(p[RADAR_STATS[i].key]/RADAR_STATS[i].max,1),r=v*R,a=Math.PI*2*i/n-Math.PI/2;cx.beginPath();cx.arc(cX+r*Math.cos(a),cY+r*Math.sin(a),3,0,Math.PI*2);cx.fillStyle=c;cx.fill()}})}

// TEAMS
function renderTeams(){const rows=getFilteredRows();const tms={};for(const r of rows){const tm=(r['Teams']||'').trim();if(!tm)continue;if(!tms[tm])tms[tm]={wins:0,losses:0,kills:0,deaths:0,assists:0,damage:0,duration:0,games:0,players:new Set()};const t=tms[tm];t.games++;t.wins+=(r['Win']==='Win'?1:0);t.losses+=(r['Win']==='Loss'?1:0);t.kills+=(parseFloat(r['Kills'])||0);t.deaths+=(parseFloat(r['Deaths'])||0);t.assists+=(parseFloat(r['Assists'])||0);t.damage+=(parseFloat(r['Total Damage to Champions'])||0);t.duration+=(parseFloat(r['Game Duration (min)'])||0);let n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];t.players.add(n)}const sorted=Object.entries(tms).filter(([t])=>t!=='Sub'&&t).sort((a,b)=>{const wa=a[1].wins/(a[1].wins+a[1].losses)||0,wb=b[1].wins/(b[1].wins+b[1].losses)||0;return wb-wa});document.getElementById('teamGrid').innerHTML=sorted.map(([name,t])=>{const c=TC[name]||'#6366f1';const mw=Math.round(t.wins/5),ml=Math.round(t.losses/5);const wr=((mw/(mw+ml))*100||0).toFixed(1);const ak=(t.kills/t.games).toFixed(1);const ad=(t.deaths/t.games).toFixed(1);const dp=(t.damage/t.duration).toFixed(0);const ros=[...t.players].map(p=>`<span onclick="openProfile('${p.replace(/'/g,"\\'")}')">${p}</span>`).join(', ');return`<div class="team-card"><div class="tc-accent" style="background:${c}"></div><div class="tc-name" style="color:${c}">${name}</div><div class="tc-record"><span style="color:var(--green)">${mw}W</span> - <span style="color:var(--pink)">${ml}L</span> · ${wr}% WR</div><div class="tc-stats"><div class="tc-stat"><div class="tc-stat-val" style="color:${c}">${ak}</div><div class="tc-stat-label">Avg K/G</div></div><div class="tc-stat"><div class="tc-stat-val" style="color:${c}">${ad}</div><div class="tc-stat-label">Avg D/G</div></div><div class="tc-stat"><div class="tc-stat-val" style="color:${c}">${dp}</div><div class="tc-stat-label">DMG/Min</div></div></div><div class="tc-roster">${ros}</div></div>`}).join('')}

// CHAMPIONS
let champSort={key:'games',asc:false};
function renderChampions(){const rows=getFilteredRows();const ch={};for(const r of rows){const c=r['Champion']||'Unknown';if(!ch[c])ch[c]={games:0,wins:0,kills:0,deaths:0,assists:0,players:new Set()};const x=ch[c];x.games++;x.wins+=(r['Win']==='Win'?1:0);x.kills+=(parseFloat(r['Kills'])||0);x.deaths+=(parseFloat(r['Deaths'])||0);x.assists+=(parseFloat(r['Assists'])||0);let n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];x.players.add(n)}const tg=rows.length;let data=Object.entries(ch).map(([n,c])=>({name:n,games:c.games,wins:c.wins,wr:+(c.wins/c.games*100).toFixed(1),kda:+((c.kills+c.assists)/Math.max(c.deaths,1)).toFixed(2),avgKills:+(c.kills/c.games).toFixed(1),avgDeaths:+(c.deaths/c.games).toFixed(1),avgAssists:+(c.assists/c.games).toFixed(1),pickRate:+(c.games/tg*100).toFixed(1),players:c.players.size}));data.sort((a,b)=>champSort.asc?a[champSort.key]-b[champSort.key]:b[champSort.key]-a[champSort.key]);if(champSort.key==='name')data.sort((a,b)=>champSort.asc?a.name.localeCompare(b.name):b.name.localeCompare(a.name));const mg=Math.max(...data.map(d=>d.games));const cols=[{key:'name',label:'Champion'},{key:'games',label:'Games'},{key:'wr',label:'Win Rate'},{key:'kda',label:'KDA'},{key:'avgKills',label:'K/G'},{key:'avgDeaths',label:'D/G'},{key:'avgAssists',label:'A/G'},{key:'pickRate',label:'Pick %'},{key:'players',label:'Players'}];let h='<table class="champ-table"><thead><tr>';cols.forEach(c=>{const s=champSort.key===c.key?'sorted':'';h+=`<th class="${s}" onclick="sortChamps('${c.key}')">${c.label}${s?(champSort.asc?' ▲':' ▼'):''}</th>`});h+='</tr></thead><tbody>';data.forEach(d=>{const bw=(d.games/mg*100).toFixed(0);const wc=d.wr>=55?'var(--green)':d.wr<=45?'var(--pink)':'var(--text)';h+=`<tr><td class="champ-name">${d.name}</td><td>${d.games}<span class="champ-bar"><span class="champ-bar-fill" style="width:${bw}%;background:var(--cyan)"></span></span></td><td style="color:${wc}">${d.wr}%</td><td>${d.kda}</td><td>${d.avgKills}</td><td>${d.avgDeaths}</td><td>${d.avgAssists}</td><td>${d.pickRate}%</td><td>${d.players}</td></tr>`});h+='</tbody></table>';document.getElementById('champContent').innerHTML=h}
function sortChamps(k){if(champSort.key===k)champSort.asc=!champSort.asc;else{champSort.key=k;champSort.asc=false}renderChampions()}

// RECORDS
function renderRecords(){const rows=getFilteredRows();const recs=[{label:'Most Kills (Single Game)',key:'Kills'},{label:'Most Deaths (Single Game)',key:'Deaths'},{label:'Most Assists (Single Game)',key:'Assists'},{label:'Highest KDA (Single Game)',key:'_kda',calc:r=>{const k=parseFloat(r['Kills'])||0,d=parseFloat(r['Deaths'])||0,a=parseFloat(r['Assists'])||0;return(k+a)/Math.max(d,1)}},{label:'Most CS (Single Game)',key:'CS'},{label:'Most Damage (Single Game)',key:'Total Damage to Champions'},{label:'Most Vision Score (Single Game)',key:'Vision Score'},{label:'Most Gold (Single Game)',key:'Gold Earned'},{label:'Most Turret Kills (Single Game)',key:'Turret Kills'},{label:'Most Wards Placed (Single Game)',key:'Wards Placed'},{label:'Fastest Win (Minutes)',key:'_fastest',calc:r=>r['Win']==='Win'?(parseFloat(r['Game Duration (min)'])||999):999,invert:true},{label:'Longest Game (Minutes)',key:'Game Duration (min)'}];let h='';recs.forEach(rec=>{let best=null,bv=rec.invert?Infinity:-Infinity,br=null;rows.forEach(r=>{let n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];const v=rec.calc?rec.calc(r):(parseFloat(r[rec.key])||0);if(rec.invert?(v<bv):(v>bv)){bv=v;br=r;best=n}});if(!best||bv===Infinity||bv===-Infinity)return;const ch=br?br['Champion']:'';const dt=br?parseDate(br['Date']||''):'';const tm=br?(br['Teams']||''):'';const c=TC[tm]||'var(--cyan)';const dv=rec.key==='_kda'?bv.toFixed(2):rec.key==='_fastest'?bv.toFixed(1):Math.round(bv).toLocaleString();h+=`<div class="record-card"><div class="rec-cat">${rec.label}</div><div class="rec-val" style="color:${c}">${dv}</div><div class="rec-player" style="cursor:pointer" onclick="openProfile('${best.replace(/'/g,"\\'")}')">${best}</div><div class="rec-detail">${ch} · ${tm} · ${formatDate(dt)}</div></div>`});document.getElementById('recordsGrid').innerHTML=h}

// MVP
function calcMVPScore(p){return+(p.kda*2+p.winRate*0.3+p.damagePerMin*0.02+p.csPerMin*3+p.visionPerMin*10+(p.killsPerGame-p.deathsPerGame)*2).toFixed(1)}
function renderMVP(){const mg=5;const el=PD.filter(p=>p.games>=mg);if(!el.length){document.getElementById('mvpContent').innerHTML='<div class="nodata">Not enough data</div>';return}el.forEach(p=>p.mvpScore=calcMVPScore(p));el.sort((a,b)=>b.mvpScore-a.mvpScore);const mvp=el[0];const c=TC[mvp.team]||'#6366f1';const rows=getFilteredRows();const bd={};for(const r of rows){const d=parseDate(r['Date']||'');if(!bd[d])bd[d]=[];bd[d].push(r)}const wm=[];for(const[date,gr]of Object.entries(bd)){const ag=aggregate(gr,ROSTER);if(!ag.players.length)continue;ag.players.forEach(p=>p.mvpScore=calcMVPScore(p));ag.players.sort((a,b)=>b.mvpScore-a.mvpScore);const t=ag.players[0];wm.push({date,player:t.player,team:t.team,score:t.mvpScore,kda:t.kda,wr:t.winRate,games:t.games})}wm.sort((a,b)=>a.date.localeCompare(b.date));let h=`<div class="mvp-crown"><div class="mvp-label">★ Season MVP ★</div><div class="mvp-name" style="color:${c};cursor:pointer" onclick="openProfile('${mvp.player.replace(/'/g,"\\'")}')">${mvp.player}</div><div class="mvp-sub">${mvp.team} · ${ROLE_MAP[mvp.mainRole]||mvp.mainRole} · ${mvp.games} Games · ${mvp.winRate}% WR</div><div class="mvp-score">${mvp.mvpScore}</div><div class="mvp-sub">MVP RATING</div></div>`;h+='<div class="card"><div class="card-t">Top 5 Overall</div><div class="card-s">Minimum '+mg+' games played</div>';el.slice(0,5).forEach((p,i)=>{const pc=TC[p.team]||'#6366f1';const md=['🥇','🥈','🥉','4.','5.'];h+=`<div style="display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid #ffffff06"><span style="font-size:20px;width:30px;text-align:center">${md[i]}</span><span style="font-weight:700;min-width:140px;cursor:pointer;color:${pc}" onclick="openProfile('${p.player.replace(/'/g,"\\'")}')">${p.player}</span><span style="font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--dim)">${p.team} · ${p.games}g · ${p.winRate}%WR · ${p.kda} KDA</span><span style="margin-left:auto;font-family:'Orbitron',sans-serif;font-weight:700;color:${pc}">${p.mvpScore}</span></div>`});h+='</div>';if(wm.length){h+='<div class="card"><div class="card-t">Game Night MVPs</div><div class="card-s">Best performer each night</div><div class="mvp-weekly">';wm.forEach(w=>{const wc=TC[w.team]||'#6366f1';h+=`<div class="mvp-week-card"><div class="mwc-date">${formatDate(w.date)}</div><div class="mwc-name" style="color:${wc}">${w.player}</div><div class="mwc-score" style="color:${wc}">${w.score}</div><div class="mwc-line">${w.kda} KDA · ${w.games}g</div></div>`});h+='</div></div>'}document.getElementById('mvpContent').innerHTML=h}

// POWER RANKINGS
function calcPowerScore(p,all){const ks=['kda','winRate','csPerMin','goldPerMin','damagePerMin','visionPerMin'];const wt=[2,1.5,1,.8,1.2,.8];let tw=0,ws=0;ks.forEach((k,i)=>{const s=[...all].sort((a,b)=>a[k]-b[k]);const rk=s.findIndex(x=>x.player===p.player);const pc=rk/(s.length-1||1);ws+=pc*wt[i];tw+=wt[i]});return+((ws/tw)*100).toFixed(1)}
function renderPower(){const mg=parseInt(document.getElementById('prMinG').value);const el=PD.filter(p=>p.games>=mg);if(!el.length){document.getElementById('powerContent').innerHTML='<div class="nodata">Not enough data</div>';return}el.forEach(p=>p.powerScore=calcPowerScore(p,el));el.sort((a,b)=>b.powerScore-a.powerScore);const mx=el[0].powerScore;document.getElementById('powerContent').innerHTML=el.map((p,i)=>{const c=TC[p.team]||'#6366f1';const pct=(p.powerScore/mx*100).toFixed(1);const dl=Math.min(i*0.03,1.5);const rc=i===0?'r1':i===1?'r2':i===2?'r3':'';return`<div class="pr-row" style="animation-delay:${dl}s"><div class="pr-rank ${rc}" style="color:${i<3?c:'var(--dim)'}">${i+1}</div><div class="pr-info"><div class="pr-name" style="color:${c}" onclick="openProfile('${p.player.replace(/'/g,"\\'")}')">${p.player}</div><div class="pr-detail">${p.team} · ${ROLE_MAP[p.mainRole]||p.mainRole} · ${p.games}g · ${p.winRate}%WR</div></div><div class="pr-bar"><div class="pr-bar-fill" style="width:${pct}%;background:${c}"></div></div><div class="pr-score" style="color:${c}">${p.powerScore}</div></div>`}).join('')}
// PLAYER PROFILE
function openProfile(pn){const p=PD.find(x=>x.player===pn);if(!p)return;const c=TC[p.team]||'#6366f1';const rl=ROLE_MAP[p.mainRole]||p.mainRole;const el=PD.filter(x=>x.games>=3);el.forEach(x=>x.powerScore=calcPowerScore(x,el));el.sort((a,b)=>b.powerScore-a.powerScore);const pr=el.findIndex(x=>x.player===pn)+1;const ps=p.powerScore||calcPowerScore(p,el);const cm={};(p.champData||[]).forEach(x=>{if(!cm[x.champ])cm[x.champ]={games:0,wins:0,kills:0,deaths:0,assists:0};const ch=cm[x.champ];ch.games++;ch.wins+=(x.win?1:0);ch.kills+=x.kills;ch.deaths+=x.deaths;ch.assists+=x.assists});const cl=Object.entries(cm).map(([n,x])=>({name:n,games:x.games,wr:+(x.wins/x.games*100).toFixed(0),kda:+((x.kills+x.assists)/Math.max(x.deaths,1)).toFixed(2)})).sort((a,b)=>b.games-a.games);
function gR(k,inv){const s=[...PD].sort((a,b)=>inv?a[k]-b[k]:b[k]-a[k]);return s.findIndex(x=>x.player===pn)+1}
const avg={};const sks=['kda','killsPerGame','deathsPerGame','assistsPerGame','csPerMin','goldPerMin','damagePerMin','visionPerMin','winRate'];sks.forEach(k=>{const vs=PD.filter(x=>x.games>=3).map(x=>x[k]);avg[k]=vs.length?+(vs.reduce((a,b)=>a+b,0)/vs.length).toFixed(2):0});
const dp={};(p.champData||[]).forEach(x=>{if(!dp[x.date])dp[x.date]={kills:0,deaths:0,assists:0,games:0,wins:0,damage:0,duration:0};const d=dp[x.date];d.games++;d.kills+=x.kills;d.deaths+=x.deaths;d.assists+=x.assists;d.wins+=(x.win?1:0);d.damage+=x.damage;d.duration+=x.duration});const td=Object.keys(dp).sort();const tk=td.map(d=>{const x=dp[d];return+((x.kills+x.assists)/Math.max(x.deaths,1)).toFixed(2)});
let h=`<div class="prof-header"><div><div class="prof-name" style="color:${c}">${p.player}</div><div class="prof-sub">${p.team} · ${rl} · ${p.games} Games · ${p.wins}W ${p.losses}L</div></div><div style="display:flex;align-items:center"><div class="prof-rating" style="color:${c}" title="Power Rating">${ps}<span style="font-size:12px;color:var(--dim)"> #${pr}</span></div><button class="prof-share" onclick="shareProfile('${p.player.replace(/'/g,"\\'")}')"><span>⚡ SHARE</span></button></div></div>`;
h+='<div class="prof-section"><div class="prof-section-title">Core Stats</div><div class="prof-stats">';
[{label:'KDA',val:p.kda,fmt:'dec',key:'kda'},{label:'Win Rate',val:p.winRate,fmt:'pct',key:'winRate'},{label:'K/G',val:p.killsPerGame,fmt:'dec',key:'killsPerGame'},{label:'D/G',val:p.deathsPerGame,fmt:'dec',key:'deathsPerGame',inv:true},{label:'A/G',val:p.assistsPerGame,fmt:'dec',key:'assistsPerGame'},{label:'CS/Min',val:p.csPerMin,fmt:'dec',key:'csPerMin'},{label:'Gold/Min',val:p.goldPerMin,fmt:'dec',key:'goldPerMin'},{label:'DMG/Min',val:p.damagePerMin,fmt:'num',key:'damagePerMin'},{label:'Vision/Min',val:p.visionPerMin,fmt:'dec',key:'visionPerMin'},{label:'Games',val:p.games,fmt:'int',key:'games'}].forEach(s=>{const rk=gR(s.key,s.inv);const rc=rk<=3?'var(--gold)':rk<=10?'var(--cyan)':'var(--dim)';h+=`<div class="prof-stat"><div class="prof-stat-val" style="color:${c}">${fmtVal(s.val,s.fmt)}</div><div class="prof-stat-label">${s.label}</div><div class="prof-stat-rank" style="color:${rc}">#${rk} of ${PD.length}</div></div>`});h+='</div></div>';
h+='<div class="prof-section"><div class="prof-section-title">Vs League Average</div><div class="prof-vs-avg">';sks.forEach(function(k){var s=STATS.find(function(x){return x.key===k})||{name:k,fmt:'dec'};var pv=p[k],av=avg[k];var df=pv-av;var inv=(k==='deathsPerGame');var dc=inv?(df<0?'var(--green)':'var(--pink)'):(df>0?'var(--green)':'var(--pink)');var ds=(df>0?'+':'')+fmtVal(df,s.fmt);var mx=Math.max.apply(null,PD.map(function(x){return x[k]||0}));if(mx===0)mx=1;var pPct=(pv/mx*100).toFixed(1);var aPct=(av/mx*100).toFixed(1);var barColor=inv?(pv<=av?'var(--green)':'var(--pink)'):(pv>=av?'var(--green)':'var(--pink)');h+='<div class="vs-bar-row"><div class="vs-bar-label">'+s.name+'</div><div class="vs-bar-val" style="color:'+c+'">'+fmtVal(pv,s.fmt)+'</div><div class="vs-bar-track"><div class="vs-bar-fill" data-width="'+pPct+'" style="background:'+barColor+'"></div><div class="vs-bar-avg-mark" style="left:'+aPct+'%"><div class="vs-bar-avg-label">AVG</div></div></div><div class="vs-bar-diff" style="color:'+dc+'">'+ds+'</div></div>'});h+='</div></div>';
if(cl.length){h+='<div class="prof-section"><div class="prof-section-title">Champion Pool</div><div class="prof-champs">';cl.forEach(x=>{const wc=x.wr>=55?'var(--green)':x.wr<=45?'var(--pink)':'var(--text)';h+=`<div class="prof-champ"><div><div class="prof-champ-name">${x.name}</div><div class="prof-champ-games">${x.games} games · ${x.kda} KDA</div></div><div class="prof-champ-wr" style="color:${wc}">${x.wr}%</div></div>`});h+='</div></div>'}
if(td.length>1)h+='<div class="prof-section"><div class="prof-section-title">KDA Trend by Game Night</div><div class="prof-trend"><canvas id="trendCanvas" width="850" height="120"></canvas></div></div>';
if(p.doubleKills||p.tripleKills||p.quadraKills||p.pentaKills){h+='<div class="prof-section"><div class="prof-section-title">Multi-Kills</div><div class="prof-stats">';[{l:'Doubles',v:p.doubleKills},{l:'Triples',v:p.tripleKills},{l:'Quadras',v:p.quadraKills},{l:'Pentas',v:p.pentaKills}].forEach(m=>{if(m.v)h+=`<div class="prof-stat"><div class="prof-stat-val" style="color:${c}">${m.v}</div><div class="prof-stat-label">${m.l}</div></div>`});h+='</div></div>'}
document.getElementById('profileContent').innerHTML=h;document.getElementById('profileModal').classList.add('active');if(td.length>1)setTimeout(()=>drawTrend(td,tk,c),50)}

function drawTrend(dates,vals,color){const cv=document.getElementById('trendCanvas');if(!cv)return;const cx=cv.getContext('2d');const W=cv.width,H=cv.height,pd=30;cx.clearRect(0,0,W,H);const mn=Math.min(...vals)*.8,mx=Math.max(...vals)*1.2;const xs=(W-pd*2)/(dates.length-1||1);cx.strokeStyle='#1a1a3040';cx.lineWidth=1;for(let i=0;i<4;i++){const y=pd+(H-pd*2)*i/3;cx.beginPath();cx.moveTo(pd,y);cx.lineTo(W-pd,y);cx.stroke()}cx.beginPath();cx.strokeStyle=color;cx.lineWidth=2;const pts=[];vals.forEach((v,i)=>{const x=pd+i*xs,y=H-pd-(v-mn)/(mx-mn||1)*(H-pd*2);pts.push({x,y});i===0?cx.moveTo(x,y):cx.lineTo(x,y)});cx.stroke();
cx.beginPath();cx.strokeStyle=color;cx.lineWidth=6;cx.globalAlpha=.15;pts.forEach((p,i)=>{i===0?cx.moveTo(p.x,p.y):cx.lineTo(p.x,p.y)});cx.stroke();cx.globalAlpha=1;
cx.beginPath();pts.forEach((p,i)=>{i===0?cx.moveTo(p.x,p.y):cx.lineTo(p.x,p.y)});cx.lineTo(pts[pts.length-1].x,H-pd);cx.lineTo(pts[0].x,H-pd);cx.closePath();cx.fillStyle=color+'15';cx.fill();
pts.forEach((p,i)=>{cx.beginPath();cx.arc(p.x,p.y,4,0,Math.PI*2);cx.fillStyle=color;cx.fill();cx.beginPath();cx.arc(p.x,p.y,7,0,Math.PI*2);cx.strokeStyle=color+'40';cx.lineWidth=1;cx.stroke();cx.font='9px "Share Tech Mono",monospace';cx.fillStyle='#94a3b8';cx.textAlign='center';cx.fillText(vals[i].toFixed(1),p.x,p.y-12);cx.fillStyle='#4a5568';cx.fillText(dates[i].slice(5),p.x,H-8)})}

function closeProfile(){document.getElementById('profileModal').classList.remove('active');history.replaceState(null,'',location.pathname+'#'+curTab)}
document.getElementById('profileModal').addEventListener('click',e=>{if(e.target===document.getElementById('profileModal'))closeProfile()});

// SHARE
function shareProfile(pn){const u=location.origin+location.pathname+'?player='+encodeURIComponent(pn);navigator.clipboard.writeText(u).then(()=>showToast('Link copied to clipboard!')).catch(()=>{prompt('Copy this link:',u)})}
function showToast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500)}

// SCROLL
window.addEventListener('scroll',()=>{document.getElementById('bttBtn').classList.toggle('show',scrollY>400)});

// ════════════════════════════════════════
// MOUSE-REACTIVE PARTICLES
// ════════════════════════════════════════
(function(){let mx=0,my=0;document.addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY});
// Modify existing particle update to drift toward mouse
const origUpdate=window._particleUpdate;
setInterval(()=>{const cv=document.getElementById('particleCanvas');if(!cv)return;
document.querySelectorAll&&document.querySelectorAll('.brow').length},5000)})();

// ════════════════════════════════════════
// STAT TICKER (ESPN-style scrolling bar)
// ════════════════════════════════════════
function buildTicker(){
  if(!PD.length)return;
  const ticker=document.getElementById('statTicker');
  const track=document.getElementById('tickerTrack');
  ticker.style.display='block';
  const topKDA=[...PD].filter(p=>p.games>=5).sort((a,b)=>b.kda-a.kda)[0];
  const topWR=[...PD].filter(p=>p.games>=5).sort((a,b)=>b.winRate-a.winRate)[0];
  const topDMG=[...PD].filter(p=>p.games>=5).sort((a,b)=>b.damagePerMin-a.damagePerMin)[0];
  const topCS=[...PD].filter(p=>p.games>=5).sort((a,b)=>b.csPerMin-a.csPerMin)[0];
  const topVis=[...PD].filter(p=>p.games>=5).sort((a,b)=>b.visionPerMin-a.visionPerMin)[0];
  const topKills=[...PD].sort((a,b)=>b.totalKills-a.totalKills)[0];
  const topGames=[...PD].sort((a,b)=>b.games-a.games)[0];
  const mostPentas=[...PD].sort((a,b)=>b.pentaKills-a.pentaKills)[0];
  const items=[
    {label:'TOP KDA',player:topKDA?.player,val:topKDA?.kda?.toFixed(2)},
    {label:'BEST WR',player:topWR?.player,val:topWR?.winRate+'%'},
    {label:'TOP DMG/MIN',player:topDMG?.player,val:Math.round(topDMG?.damagePerMin||0)},
    {label:'TOP CS/MIN',player:topCS?.player,val:topCS?.csPerMin?.toFixed(2)},
    {label:'TOP VISION/MIN',player:topVis?.player,val:topVis?.visionPerMin?.toFixed(2)},
    {label:'MOST KILLS',player:topKills?.player,val:topKills?.totalKills},
    {label:'MOST GAMES',player:topGames?.player,val:topGames?.games},
    {label:'PENTA KILLS',player:mostPentas?.player,val:mostPentas?.pentaKills||0},
  ].filter(i=>i.player&&i.val);
  // Duplicate for seamless loop
  const html=items.map(i=>`<div class="ticker-item"><span class="ti-label">${i.label}:</span><span class="ti-player">${i.player}</span><span class="ti-val">${i.val}</span></div><span class="ticker-sep">◆</span>`).join('');
  track.innerHTML=html+html;
}

// ════════════════════════════════════════
// COUNTING NUMBER ANIMATION
// ════════════════════════════════════════
function animateCountUp(el,target,duration,fmt){
  const start=performance.now();const isFloat=fmt==='dec'||fmt==='pct';
  function tick(now){
    const elapsed=now-start;const progress=Math.min(elapsed/duration,1);
    const eased=1-Math.pow(1-progress,3);// ease-out cubic
    const current=target*eased;
    if(fmt==='pct')el.textContent=current.toFixed(1)+'%';
    else if(fmt==='dec')el.textContent=current.toFixed(2);
    else if(fmt==='num'||fmt==='int')el.textContent=Math.round(current).toLocaleString('en-US');
    else el.textContent=Math.round(current);
    if(progress<1)requestAnimationFrame(tick);
    else{if(fmt==='pct')el.textContent=target.toFixed(1)+'%';else if(fmt==='dec')el.textContent=target.toFixed(2);else if(fmt==='num'||fmt==='int')el.textContent=Math.round(target).toLocaleString('en-US');else el.textContent=Math.round(target)}
  }
  requestAnimationFrame(tick);
}

// Apply counting to meta bar numbers
function animateMetaNumbers(){
  const fields=[{id:'mPlayers'},{id:'mMatches'},{id:'mNights'},{id:'mTeams'}];
  fields.forEach(f=>{
    const el=document.getElementById(f.id);
    const val=parseInt(el.textContent);
    if(!isNaN(val)&&val>0){el.textContent='0';animateCountUp(el,val,800,'int')}
  });
}

// ════════════════════════════════════════
// CONFETTI SYSTEM (for MVP / #1 profiles)
// ════════════════════════════════════════
function fireConfetti(color){
  const cv=document.getElementById('confettiCanvas');const cx=cv.getContext('2d');
  cv.width=innerWidth;cv.height=innerHeight;
  const particles=[];const colors=[color,'#ffd700','#00f0ff','#ff2d7b','#a855f7','#22c55e'];
  for(let i=0;i<80;i++){
    particles.push({x:innerWidth/2+(Math.random()-.5)*200,y:innerHeight/2,vx:(Math.random()-.5)*12,vy:Math.random()*-14-4,
    size:Math.random()*6+2,color:colors[Math.floor(Math.random()*colors.length)],
    rotation:Math.random()*360,rotSpeed:(Math.random()-.5)*10,life:1,decay:Math.random()*.015+.008,
    shape:Math.random()>.5?'rect':'circle'});
  }
  function draw(){
    cx.clearRect(0,0,cv.width,cv.height);let alive=false;
    particles.forEach(p=>{
      if(p.life<=0)return;alive=true;
      p.x+=p.vx;p.y+=p.vy;p.vy+=.3;p.vx*=.99;p.rotation+=p.rotSpeed;p.life-=p.decay;
      cx.save();cx.translate(p.x,p.y);cx.rotate(p.rotation*Math.PI/180);cx.globalAlpha=p.life;cx.fillStyle=p.color;
      if(p.shape==='rect'){cx.fillRect(-p.size/2,-p.size/2,p.size,p.size*.6)}
      else{cx.beginPath();cx.arc(0,0,p.size/2,0,Math.PI*2);cx.fill()}
      cx.restore();
    });
    if(alive)requestAnimationFrame(draw);else cx.clearRect(0,0,cv.width,cv.height);
  }
  draw();
}

// ════════════════════════════════════════
// HOLOGRAPHIC SHIMMER (record cards)
// ════════════════════════════════════════
function initHoloShimmer(){
  document.querySelectorAll('.record-card').forEach(card=>{
    if(card.querySelector('.holo-sheen'))return;
    const sheen=document.createElement('div');sheen.className='holo-sheen';card.appendChild(sheen);
    card.addEventListener('mousemove',e=>{
      const r=card.getBoundingClientRect();
      const x=((e.clientX-r.left)/r.width*100);
      const y=((e.clientY-r.top)/r.height*100);
      sheen.style.background=`radial-gradient(circle at ${x}% ${y}%,rgba(0,240,255,.06) 0%,rgba(255,45,123,.04) 30%,rgba(168,85,247,.03) 60%,transparent 80%)`;
    });
  });
}

// ════════════════════════════════════════
// ROLE ICONS
// ════════════════════════════════════════
const ROLE_ICONS={TOP:'⚔',JUNGLE:'🌿',MIDDLE:'✦',BOTTOM:'🏹',UTILITY:'🛡'};

// ════════════════════════════════════════
// SPARKLINES for champion table
// ════════════════════════════════════════
function makeSparkline(vals,color,w,h){
  const cv=document.createElement('canvas');cv.width=w;cv.height=h;cv.className='sparkline';
  const cx=cv.getContext('2d');
  if(!vals.length)return cv;
  const mn=Math.min(...vals),mx=Math.max(...vals),range=mx-mn||1;
  cx.beginPath();cx.strokeStyle=color;cx.lineWidth=1.5;
  vals.forEach((v,i)=>{const x=i/(vals.length-1||1)*w;const y=h-((v-mn)/range)*h*.8-h*.1;i===0?cx.moveTo(x,y):cx.lineTo(x,y)});
  cx.stroke();return cv;
}

// ════════════════════════════════════════
// BEST GAME CARD (in player profile)
// ════════════════════════════════════════
function getBestGame(p){
  if(!p.champData||!p.champData.length)return null;
  let best=null,bestScore=-Infinity;
  p.champData.forEach(g=>{
    const score=(g.kills+g.assists)/Math.max(g.deaths,1)*2+g.damage/1000+(g.win?5:0);
    if(score>bestScore){bestScore=score;best=g}
  });
  return best;
}

function renderBestGameCard(p,color){
  const bg=getBestGame(p);if(!bg)return'';
  const kda=((bg.kills+bg.assists)/Math.max(bg.deaths,1)).toFixed(2);
  return`<div class="best-game"><div class="bg-label">★ Best Performance</div><div class="bg-stats"><div class="bg-stat"><div class="bg-stat-val" style="color:${color}">${bg.champ}</div><div class="bg-stat-label">Champion</div></div><div class="bg-stat"><div class="bg-stat-val" style="color:${bg.win?'var(--green)':'var(--pink)'}">${bg.win?'WIN':'LOSS'}</div><div class="bg-stat-label">Result</div></div><div class="bg-stat"><div class="bg-stat-val" style="color:${color}">${bg.kills}/${bg.deaths}/${bg.assists}</div><div class="bg-stat-label">KDA ${kda}</div></div><div class="bg-stat"><div class="bg-stat-val" style="color:${color}">${Math.round(bg.damage).toLocaleString()}</div><div class="bg-stat-label">Damage</div></div><div class="bg-stat"><div class="bg-stat-val" style="color:${color}">${bg.cs}</div><div class="bg-stat-label">CS</div></div><div class="bg-stat"><div class="bg-stat-val" style="color:var(--dim)">${formatDate(bg.date)}</div><div class="bg-stat-label">Date</div></div></div></div>`;
}

// ════════════════════════════════════════
// UI SOUND EFFECTS (optional toggle)
// ════════════════════════════════════════
let soundEnabled=false;
const audioCtx=typeof AudioContext!=='undefined'?new AudioContext():null;
function playTick(){
  if(!soundEnabled||!audioCtx)return;
  const osc=audioCtx.createOscillator();const gain=audioCtx.createGain();
  osc.connect(gain);gain.connect(audioCtx.destination);
  osc.frequency.value=800+Math.random()*400;osc.type='sine';
  gain.gain.setValueAtTime(0.03,audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.08);
  osc.start();osc.stop(audioCtx.currentTime+0.08);
}
function playSuccess(){
  if(!soundEnabled||!audioCtx)return;
  [800,1000,1200].forEach((f,i)=>{
    const osc=audioCtx.createOscillator();const gain=audioCtx.createGain();
    osc.connect(gain);gain.connect(audioCtx.destination);
    osc.frequency.value=f;osc.type='sine';
    gain.gain.setValueAtTime(0.02,audioCtx.currentTime+i*0.08);
    gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+i*0.08+0.15);
    osc.start(audioCtx.currentTime+i*0.08);osc.stop(audioCtx.currentTime+i*0.08+0.15);
  });
}

// ════════════════════════════════════════
// PATCH EXISTING FUNCTIONS TO ADD NEW EFFECTS
// ════════════════════════════════════════

// Patch loadData to add ticker + counting animation + auto-populate season dropdown
const _origLoadData=loadData;
loadData=async function(){
  await _origLoadData();
  // Auto-populate season dropdown from data
  const seasons=[...new Set(RAW.map(r=>(r['Season']||'').trim()).filter(s=>s))].sort();
  const sel=document.getElementById('seasonSel');
  sel.innerHTML='<option value="All">All Seasons</option>';
  seasons.forEach(s=>{
    const o=document.createElement('option');
    o.value=s;o.textContent=s.replace(/^S(\d)/,'Season $1');
    sel.appendChild(o);
  });
  // Select the latest season by default if available
  if(seasons.length){sel.value=seasons[seasons.length-1];onGlobalFilter()}
  buildTicker();
  animateMetaNumbers();
};

// Patch renderRecords to add holo shimmer
const _origRenderRecords=renderRecords;
renderRecords=function(){_origRenderRecords();setTimeout(initHoloShimmer,50)};

// Patch renderLeaderboard to add #1 row hero pulse + bar hover sounds
const _origRenderLeaderboard=renderLeaderboard;
renderLeaderboard=function(){
  _origRenderLeaderboard();
  // Add hero pulse to #1
  const firstRow=document.querySelector('.brow .rk.r1');
  if(firstRow){const row=firstRow.closest('.brow');if(row)row.classList.add('brow-hero')}
  // Add role icons to player names
  document.querySelectorAll('.brow').forEach(row=>{
    const tn=row.querySelector('.tn');
    if(tn&&!tn.dataset.iconified){
      tn.dataset.iconified='1';
      const text=tn.textContent;
      for(const[role,icon]of Object.entries(ROLE_ICONS)){
        const roleLabel=ROLE_MAP[role];
        if(text.includes(roleLabel)){
          tn.innerHTML=text.replace(roleLabel,`<span class="role-icon">${icon}</span>${roleLabel}`);
          break;
        }
      }
    }
  });
  // Click sounds
  document.querySelectorAll('.brow').forEach(r=>{
    if(!r.dataset.sounded){r.dataset.sounded='1';r.addEventListener('click',()=>playTick())}
  });
};

// Patch openProfile to add confetti for #1 + staggered stat animations + best game + BADGES + MASTERY + H2H
const _origOpenProfile=openProfile;
openProfile=function(pn){
  _origOpenProfile(pn);
  const p=PD.find(x=>x.player===pn);if(!p)return;
  const c=TC[p.team]||'#6366f1';
  // Check if #1 in any major stat
  const isElite=PD.filter(x=>x.games>=5).sort((a,b)=>b.kda-a.kda)[0]?.player===pn;
  if(isElite){fireConfetti(c);playSuccess()}
  // Stagger stat animations
  document.querySelectorAll('.prof-stat').forEach((el,i)=>{
    el.classList.add('prof-stat-anim');
    el.style.animationDelay=(i*0.05)+'s';
  });
  // Add best game card
  const profContent=document.getElementById('profileContent');
  const coreSection=profContent.querySelector('.prof-section');
  if(coreSection){
    const bgHTML=renderBestGameCard(p,c);
    if(bgHTML){const div=document.createElement('div');div.innerHTML=bgHTML;coreSection.after(div.firstElementChild)}
  }
  // ACHIEVEMENT BADGES — inject after header
  const badges=getAchievements(pn,getFilteredRows());
  if(badges.length){
    const header=profContent.querySelector('.prof-header')||profContent.firstElementChild;
    if(header){
      const bdiv=document.createElement('div');bdiv.innerHTML=renderBadgesHTML(badges);
      header.after(bdiv.firstElementChild);
    }
  }
  // PLAYSTYLE TAGS — inject after badges
  const psTags=getPlaystyleTags(pn,getFilteredRows());
  if(psTags.length){
    const lastBadge=profContent.querySelector('.ach-row');
    const insertAfter=lastBadge||profContent.querySelector('.prof-header')||profContent.firstElementChild;
    if(insertAfter){
      const pdiv=document.createElement('div');pdiv.innerHTML=renderPlaystyleHTML(psTags);
      insertAfter.after(pdiv.firstElementChild);
    }
  }
  // SCOUTING METRICS — consistency, form, team impact, export button
  const scoutRows=getFilteredRows();
  const consistency=getConsistency(pn,scoutRows);
  const form=getFormRating(pn,scoutRows);
  const teamRel=getTeamRelativeStats(pn,scoutRows);
  if(consistency||form||teamRel){
    let sh='<div class="prof-section"><div class="prof-section-title">Scouting Report</div>';
    sh+='<div class="scout-metrics">';
    if(consistency){
      sh+='<div class="scout-metric"><div class="scout-metric-val" style="color:'+consistency.color+'">'+consistency.score+'</div><div class="scout-metric-label">CONSISTENCY</div><div class="scout-metric-sub" style="color:'+consistency.color+'">'+consistency.label+'</div></div>';
    }
    if(form){
      sh+='<div class="scout-metric"><div class="scout-metric-val" style="color:'+form.color+'">'+form.icon+'</div><div class="scout-metric-label">FORM (LAST 5)</div><div class="scout-metric-sub" style="color:'+form.color+'">'+form.label+'</div><div class="form-bar">';
      form.dots.forEach(function(w){sh+='<div class="form-dot" style="background:'+(w?'var(--green)':'var(--pink)')+'"></div>'});
      sh+='</div><div class="scout-metric-sub" style="color:var(--dim)">'+form.recentKDA+' KDA · '+form.recentWR+'% WR</div></div>';
    }
    sh+='</div>';
    sh+='<button class="scout-export-btn" onclick="event.stopPropagation();copyScoutReport(\''+pn.replace(/'/g,"\\'")+'\')">📋 COPY SCOUTING REPORT</button>';
    sh+='</div>';
    // Insert before first prof-section (Core Stats)
    const firstSection=profContent.querySelector('.prof-section');
    if(firstSection){
      const sdiv=document.createElement('div');sdiv.innerHTML=sh;
      firstSection.before(sdiv.firstElementChild);
    }
    // Team Impact section — insert after scouting report
    if(teamRel&&teamRel.gamesAnalyzed){
      const tiHTML=renderTeamRelativeHTML(teamRel,c);
      const scoutSection=profContent.querySelector('.prof-section');
      if(scoutSection&&tiHTML){
        const tdiv=document.createElement('div');tdiv.innerHTML=tiHTML;
        scoutSection.after(tdiv.firstElementChild);
      }
    }
  }
  // CHAMPION MASTERY BORDERS — upgrade champ icons in profile
  profContent.querySelectorAll('.champ-icon,.champ-icon-lg').forEach(img=>{
    const champName=img.alt||img.title||'';
    if(!champName)return;
    const champData=(p.champData||[]).filter(x=>x.champ===champName);
    const games=champData.length;
    const mc=getMasteryClass(games);
    if(mc){
      const wrapper=document.createElement('span');
      wrapper.className='champ-mastery '+mc;
      wrapper.innerHTML=getMasteryTag(games);
      img.parentNode.insertBefore(wrapper,img);
      wrapper.insertBefore(img,wrapper.firstChild);
    }
  });
  // HEAD-TO-HEAD — if comparing, show H2H with compared player
  if(comparePlayers.length===1&&comparePlayers[0]!==pn){
    const other=comparePlayers[0];
    const op=PD.find(x=>x.player===other);
    if(op){
      const c2=TC[op.team]||'#6366f1';
      const h2hHTML=renderH2H(pn,other,c,c2);
      if(h2hHTML){
        const div=document.createElement('div');div.innerHTML=h2hHTML;
        profContent.appendChild(div.firstElementChild);
      }
    }
  }
  // Animate VS League Average bars
  setTimeout(function(){
    document.querySelectorAll('.vs-bar-fill').forEach(function(bar){
      var w=bar.getAttribute('data-width');
      if(w)bar.style.width=w+'%';
    });
  },100);
  // Animate stat values counting up
  document.querySelectorAll('.prof-stat-val').forEach(el=>{
    const text=el.textContent;
    const num=parseFloat(text.replace(/[,%]/g,''));
    if(!isNaN(num)&&num>0){
      const fmt=text.includes('%')?'pct':text.includes('.')?'dec':'int';
      el.textContent='0';
      animateCountUp(el,num,600,fmt);
    }
  });
};

// Patch onGlobalFilter to rebuild ticker
const _origOnGlobalFilter=onGlobalFilter;
onGlobalFilter=function(){_origOnGlobalFilter();buildTicker();animateMetaNumbers()};

// ════════════════════════════════════════
// DATA DRAGON CHAMPION PORTRAITS
// ════════════════════════════════════════
const DD_VERSION='16.4.1';
let DD_BASE=`https://ddragon.leagueoflegends.com/cdn/${DD_VERSION}/img/champion/`;

// Auto-fetch latest DDragon version so newest champs always have icons
(async function(){try{
  const r=await fetch('https://ddragon.leagueoflegends.com/api/versions.json');
  const v=await r.json();
  if(v&&v[0]){DD_BASE=`https://ddragon.leagueoflegends.com/cdn/${v[0]}/img/champion/`;console.log('DDragon version:',v[0])}
}catch(e){console.log('Using fallback DDragon version',DD_VERSION)}})();

// Champion name -> DDragon filename mapping (handles special cases)
const CHAMP_KEY_OVERRIDES={
  "Aurelion Sol":"AurelionSol","Bel'Veth":"Belveth","Cho'Gath":"Chogath",
  "Dr. Mundo":"DrMundo","Hwei":"Hwei","Jarvan IV":"JarvanIV",
  "K'Sante":"KSante","Kai'Sa":"Kaisa","Kha'Zix":"Khazix",
  "Kog'Maw":"KogMaw","Lee Sin":"LeeSin",
  "Master Yi":"MasterYi","Miss Fortune":"MissFortune","Nunu & Willump":"Nunu",
  "Rek'Sai":"RekSai","Renata Glasc":"Renata","Tahm Kench":"TahmKench",
  "Twisted Fate":"TwistedFate","Vel'Koz":"Velkoz","Wukong":"MonkeyKing",
  "Xin Zhao":"XinZhao","Zaahen":"Zaahen","Yunara":"Yunara",
  "Bel Veth":"Belveth","Kog Maw":"KogMaw","Rek Sai":"RekSai",
  "Cho Gath":"Chogath","Kha Zix":"Khazix","Kai Sa":"Kaisa",
  "K Sante":"KSante","Vel Koz":"Velkoz"
};

function getChampImgUrl(champName){
  if(!champName||champName==='Unknown')return'';
  const override=CHAMP_KEY_OVERRIDES[champName];
  if(override)return DD_BASE+override+'.png';
  // Default: remove spaces and special chars
  const key=champName.replace(/[' .]/g,'');
  return DD_BASE+key+'.png';
}

function champImg(name,cls){
  const url=getChampImgUrl(name);
  if(!url)return'';
  return`<img src="${url}" alt="${name}" class="${cls||'champ-icon'}" loading="lazy" onerror="this.style.display='none'">`;
}

// ════════════════════════════════════════
// SVG RANK BADGES (crown for 1st, medals for 2nd/3rd)
// ════════════════════════════════════════
function rankBadge(rank,color){
  if(rank===1)return`<span class="rk r1" style="font-size:18px">🥇</span>`;
  if(rank===2)return`<span class="rk r2" style="font-size:18px">🥈</span>`;
  if(rank===3)return`<span class="rk r3" style="font-size:18px">🥉</span>`;
  return`<span class="rk">${rank}</span>`;
}

// ════════════════════════════════════════
// PLAYER HOVER PREVIEW
// ════════════════════════════════════════
const preview=document.getElementById('playerPreview');
let previewTimeout=null;

function showPreview(playerName,e){
  const p=PD.find(x=>x.player===playerName);
  if(!p)return;
  clearTimeout(previewTimeout);
  const c=TC[p.team]||'#6366f1';
  const rl=ROLE_MAP[p.mainRole]||p.mainRole;
  const icon=ROLE_ICONS[p.mainRole]||'';
  // Top 3 champions
  const cm={};(p.champData||[]).forEach(x=>{cm[x.champ]=(cm[x.champ]||0)+1});
  const top3=Object.entries(cm).sort((a,b)=>b[1]-a[1]).slice(0,3);
  const champsHTML=top3.map(([ch])=>champImg(ch,'champ-icon-sm')).join('');

  preview.innerHTML=`<div class="pp-header"><div>${icon} <span class="pp-name" style="color:${c}">${p.player}</span><div class="pp-sub">${p.team} · ${rl} · ${p.games}G · ${p.wins}W ${p.losses}L</div></div></div><div class="pp-champs">${champsHTML}</div><div class="pp-stats"><div class="pp-stat"><div class="pp-stat-val" style="color:${c}">${p.kda}</div><div class="pp-stat-label">KDA</div></div><div class="pp-stat"><div class="pp-stat-val" style="color:${p.winRate>=55?'var(--green)':p.winRate<=45?'var(--pink)':c}">${p.winRate}%</div><div class="pp-stat-label">WIN RATE</div></div><div class="pp-stat"><div class="pp-stat-val" style="color:${c}">${Math.round(p.damagePerMin)}</div><div class="pp-stat-label">DMG/MIN</div></div><div class="pp-stat"><div class="pp-stat-val" style="color:${c}">${p.csPerMin}</div><div class="pp-stat-label">CS/MIN</div></div><div class="pp-stat"><div class="pp-stat-val" style="color:${c}">${p.visionPerMin}</div><div class="pp-stat-label">VIS/MIN</div></div><div class="pp-stat"><div class="pp-stat-val" style="color:${c}">${p.killsPerGame}/${p.deathsPerGame}/${p.assistsPerGame}</div><div class="pp-stat-label">K/D/A PER G</div></div></div>`;
  // Position
  const x=Math.min(e.clientX+15,innerWidth-310);
  const y=Math.min(e.clientY+15,innerHeight-280);
  preview.style.left=x+'px';preview.style.top=y+'px';
  preview.classList.add('visible');
}

function hidePreview(){previewTimeout=setTimeout(()=>{preview.classList.remove('visible')},100)}

function attachPreviewListeners(){
  document.querySelectorAll('[data-player-hover]').forEach(el=>{
    if(el.dataset.previewBound)return;el.dataset.previewBound='1';
    el.addEventListener('mouseenter',e=>showPreview(el.dataset.playerHover,e));
    el.addEventListener('mousemove',e=>{
      if(preview.classList.contains('visible')){
        const x=Math.min(e.clientX+15,innerWidth-310);
        const y=Math.min(e.clientY+15,innerHeight-280);
        preview.style.left=x+'px';preview.style.top=y+'px';
      }
    });
    el.addEventListener('mouseleave',hidePreview);
  });
}

// ════════════════════════════════════════
// PLAYER TRADING CARD
// ════════════════════════════════════════
function openTradingCard(playerName){
  const p=PD.find(x=>x.player===playerName);if(!p)return;
  const c=TC[p.team]||'#6366f1';
  const rl=ROLE_MAP[p.mainRole]||p.mainRole;
  const icon=ROLE_ICONS[p.mainRole]||'✦';
  const el=PD.filter(x=>x.games>=3);el.forEach(x=>x.powerScore=calcPowerScore(x,el));
  const ps=p.powerScore||calcPowerScore(p,el);
  // Top 5 champs
  const cm={};(p.champData||[]).forEach(x=>{cm[x.champ]=(cm[x.champ]||0)+1});
  const top5=Object.entries(cm).sort((a,b)=>b[1]-a[1]).slice(0,5);

  const overlay=document.getElementById('tradingCardOverlay');
  overlay.innerHTML=`<div class="trading-card"><div class="tc-glow" style="background:linear-gradient(90deg,${c},var(--cyan),${c})"></div><button class="tc-close" onclick="closeTradingCard()">✕</button><button class="tc-save" onclick="saveTradingCard()">📷 SAVE</button><div class="tc-top"><div class="tc-team-bg" style="background:${c}"></div><div class="tc-role-badge">${icon}</div><div class="tc-player-name" style="color:${c}">${p.player}</div><div class="tc-team-name">${p.team} · ${rl}</div><div class="tc-rating" style="color:${c}">${ps}</div></div><div class="tc-mid"><div class="tc-stat"><div class="tc-stat-val" style="color:${c}">${p.kda}</div><div class="tc-stat-label">KDA</div></div><div class="tc-stat"><div class="tc-stat-val" style="color:${p.winRate>=55?'var(--green)':p.winRate<=45?'var(--pink)':'var(--text)'}">${p.winRate}%</div><div class="tc-stat-label">Win Rate</div></div><div class="tc-stat"><div class="tc-stat-val" style="color:${c}">${p.games}</div><div class="tc-stat-label">Games</div></div><div class="tc-stat"><div class="tc-stat-val" style="color:${c}">${p.killsPerGame}</div><div class="tc-stat-label">K/G</div></div><div class="tc-stat"><div class="tc-stat-val" style="color:${c}">${p.deathsPerGame}</div><div class="tc-stat-label">D/G</div></div><div class="tc-stat"><div class="tc-stat-val" style="color:${c}">${p.assistsPerGame}</div><div class="tc-stat-label">A/G</div></div><div class="tc-stat"><div class="tc-stat-val" style="color:${c}">${p.csPerMin}</div><div class="tc-stat-label">CS/Min</div></div><div class="tc-stat"><div class="tc-stat-val" style="color:${c}">${Math.round(p.damagePerMin)}</div><div class="tc-stat-label">DMG/Min</div></div><div class="tc-stat"><div class="tc-stat-val" style="color:${c}">${p.visionPerMin}</div><div class="tc-stat-label">VIS/Min</div></div></div><div class="tc-champs">${top5.map(([ch])=>champImg(ch,'champ-icon-lg')).join('')}</div><div class="tc-bottom"><div class="tc-bottom-text">${adminConfig.seasonLabel.toUpperCase()} · ${adminConfig.leagueName}</div></div></div>`;
  overlay.classList.add('active');
  fireConfetti(c);playSuccess();
}

function closeTradingCard(){document.getElementById('tradingCardOverlay').classList.remove('active')}
document.getElementById('tradingCardOverlay').addEventListener('click',e=>{if(e.target===document.getElementById('tradingCardOverlay'))closeTradingCard()});

function saveTradingCard(){
  const card=document.querySelector('.trading-card');
  if(!card)return;
  const btn=card.querySelector('.tc-save');
  const closeBtn=card.querySelector('.tc-close');
  if(btn)btn.style.display='none';
  if(closeBtn)closeBtn.style.display='none';
  showToast('Generating image...');
  html2canvas(card,{backgroundColor:'#06060c',scale:2,useCORS:true,allowTaint:true,logging:false}).then(canvas=>{
    const link=document.createElement('a');
    const name=card.querySelector('.tc-player-name')?.textContent||'player';
    link.download=(adminConfig.leagueName.replace(/[^a-zA-Z0-9]/g,'_'))+'_Card_'+name.replace(/\s+/g,'_')+'.png';
    link.href=canvas.toDataURL('image/png');
    link.click();
    showToast('Card saved as PNG!');
  }).catch(e=>{
    console.error('Save failed:',e);
    showToast('Save failed — try screenshot instead');
  }).finally(()=>{
    if(btn)btn.style.display='';
    if(closeBtn)closeBtn.style.display='';
  });
}

// ════════════════════════════════════════
// PATCH FUNCTIONS TO ADD CHAMPION PORTRAITS
// ════════════════════════════════════════

// Patch renderLeaderboard to add champion icons + hover preview + rank badges
const _origRenderLB2=renderLeaderboard;
renderLeaderboard=function(){
  _origRenderLB2();
  // Add most-played champion icon to each row
  document.querySelectorAll('.brow').forEach(row=>{
    const pn=row.querySelector('.pn');
    if(!pn||pn.dataset.champed)return;
    pn.dataset.champed='1';
    const name=pn.textContent;
    const p=PD.find(x=>x.player===name);
    if(!p||!p.champData||!p.champData.length)return;
    // Find most played champ
    const cm={};p.champData.forEach(x=>{cm[x.champ]=(cm[x.champ]||0)+1});
    const top=Object.entries(cm).sort((a,b)=>b[1]-a[1])[0];
    if(top){
      const img=document.createElement('img');
      img.src=getChampImgUrl(top[0]);img.className='champ-mini';img.alt=top[0];
      img.loading='lazy';img.onerror=function(){this.style.display='none'};
      pn.insertBefore(img,pn.firstChild);
    }
    // Add hover preview data attribute
    pn.dataset.playerHover=name;
    // Make row right-clickable for trading card
    row.addEventListener('contextmenu',e=>{e.preventDefault();openTradingCard(name)});
  });
  // Replace rank numbers with SVG badges for top 3
  document.querySelectorAll('.brow .rk').forEach(el=>{
    if(el.dataset.badged)return;el.dataset.badged='1';
    const rank=parseInt(el.textContent);
    if(rank>=1&&rank<=3){
      const color=rank===1?'var(--gold)':rank===2?'var(--silver)':'var(--bronze)';
      el.innerHTML=rankBadge(rank,color);
      el.classList.remove('r1','r2','r3');
    }
  });
  attachPreviewListeners();
};

// Patch renderChampions to add champion icons
const _origRenderChamps2=renderChampions;
renderChampions=function(){
  _origRenderChamps2();
  document.querySelectorAll('.champ-table .champ-name').forEach(td=>{
    if(td.dataset.iconed)return;td.dataset.iconed='1';
    const name=td.textContent.trim();
    td.innerHTML=champImg(name,'champ-icon')+name;
  });
};

// Patch renderRecords to add champion icons
const _origRenderRecords2=renderRecords;
renderRecords=function(){
  _origRenderRecords2();
  document.querySelectorAll('.record-card .rec-detail').forEach(el=>{
    if(el.dataset.iconed)return;el.dataset.iconed='1';
    const text=el.textContent;
    const champName=text.split(' · ')[0].trim();
    if(champName)el.innerHTML=champImg(champName,'champ-icon-sm')+text;
  });
  // Add hover preview to record player names
  document.querySelectorAll('.record-card .rec-player').forEach(el=>{
    if(el.dataset.previewBound)return;
    el.dataset.playerHover=el.textContent.trim();
  });
  setTimeout(()=>{initHoloShimmer();attachPreviewListeners()},50);
};

// Patch openProfile to add champion portraits in champion pool + trading card button
const _origOpenProfile2=openProfile;
openProfile=function(pn){
  _origOpenProfile2(pn);
  // Add champion icons to champion pool
  document.querySelectorAll('.prof-champ').forEach(el=>{
    if(el.dataset.iconed)return;el.dataset.iconed='1';
    const nameEl=el.querySelector('.prof-champ-name');
    if(!nameEl)return;
    const name=nameEl.textContent.trim();
    const img=document.createElement('img');
    img.src=getChampImgUrl(name);img.className='champ-icon-lg';img.alt=name;
    img.loading='lazy';img.onerror=function(){this.style.display='none'};
    el.insertBefore(img,el.firstChild);
    el.style.gap='10px';
  });
  // Add trading card button to profile header
  const header=document.querySelector('.prof-header');
  if(header&&!header.dataset.tcBtn){
    header.dataset.tcBtn='1';
    const btn=document.createElement('button');
    btn.className='prof-share';btn.innerHTML='<span>🃏 CARD</span>';
    btn.style.marginLeft='8px';
    btn.onclick=()=>openTradingCard(pn);
    header.querySelector('div:last-child')?.appendChild(btn);
  }
};

// Patch renderMVP to add champion icons to weekly cards
const _origRenderMVP2=renderMVP;
renderMVP=function(){
  _origRenderMVP2();
  // Add hover preview to MVP names
  document.querySelectorAll('.mvp-crown .mvp-name, .mvp-week-card .mwc-name').forEach(el=>{
    const name=el.textContent.trim();
    el.dataset.playerHover=name;
  });
  attachPreviewListeners();
};

// Patch renderTeams to add hover previews
const _origRenderTeams2=renderTeams;
renderTeams=function(){
  _origRenderTeams2();
  document.querySelectorAll('.team-card .tc-roster span').forEach(el=>{
    el.dataset.playerHover=el.textContent.trim();
  });
  attachPreviewListeners();
};

// Patch renderPower to add hover previews + rank badges + champ icons
const _origRenderPower2=renderPower;
renderPower=function(){
  _origRenderPower2();
  document.querySelectorAll('.pr-row .pr-name').forEach(el=>{
    el.dataset.playerHover=el.textContent.trim();
  });
  // Add champion icon to power ranking rows
  document.querySelectorAll('.pr-row .pr-info').forEach(el=>{
    if(el.dataset.champed)return;el.dataset.champed='1';
    const nameEl=el.querySelector('.pr-name');
    if(!nameEl)return;
    const name=nameEl.textContent.trim();
    const p=PD.find(x=>x.player===name);
    if(!p||!p.champData||!p.champData.length)return;
    const cm={};p.champData.forEach(x=>{cm[x.champ]=(cm[x.champ]||0)+1});
    const top=Object.entries(cm).sort((a,b)=>b[1]-a[1])[0];
    if(top){
      const img=document.createElement('img');
      img.src=getChampImgUrl(top[0]);img.className='champ-icon-sm';img.alt=top[0];
      img.loading='lazy';img.onerror=function(){this.style.display='none'};
      nameEl.insertBefore(img,nameEl.firstChild);
    }
  });
  // Replace top 3 rank numbers with badges
  document.querySelectorAll('.pr-row .pr-rank').forEach((el,i)=>{
    if(el.dataset.badged)return;el.dataset.badged='1';
    if(i<3){
      const color=i===0?'var(--gold)':i===1?'var(--silver)':'var(--bronze)';
      el.innerHTML=rankBadge(i+1,color);
    }
  });
  attachPreviewListeners();
};

// ════════════════════════════════════════
// PLAYER LOOKUP FEATURE
// ════════════════════════════════════════

function renderLookupSuggestions(){
  const q=document.getElementById('lookupInput').value.toLowerCase().trim();
  const box=document.getElementById('lookupSuggestions');
  if(!q||q.length<1){box.innerHTML='';return}
  const matches=PD.filter(p=>p.player.toLowerCase().includes(q)).slice(0,8);
  if(!matches.length){box.innerHTML='<div style="font-family:\'Share Tech Mono\',monospace;font-size:10px;color:var(--dim)">No players found</div>';return}
  box.innerHTML='<div class="lookup-suggestions">'+matches.map(p=>{
    const c=TC[p.team]||'#6366f1';
    return`<div class="lookup-sug" onclick="runLookup('${p.player.replace(/'/g,"\\'")}')"><span style="color:${c}">${p.player}</span><span class="ls-team">${p.team}</span></div>`;
  }).join('')+'</div>';
}

function executeLookup(){
  const q=document.getElementById('lookupInput').value.trim();
  if(!q)return;
  const exact=PD.find(p=>p.player.toLowerCase()===q.toLowerCase());
  if(exact){runLookup(exact.player);return}
  const partial=PD.find(p=>p.player.toLowerCase().includes(q.toLowerCase()));
  if(partial){runLookup(partial.player);return}
  document.getElementById('lookupResult').innerHTML='<div class="nodata">No player found matching "'+q+'"</div>';
}

document.getElementById('lookupInput').addEventListener('keydown',e=>{if(e.key==='Enter')executeLookup()});

function runLookup(playerName){
  document.getElementById('lookupInput').value=playerName;
  document.getElementById('lookupSuggestions').innerHTML='';
  const p=PD.find(x=>x.player===playerName);
  if(!p){document.getElementById('lookupResult').innerHTML='<div class="nodata">Player not found</div>';return}

  const c=TC[p.team]||'#6366f1';
  const rl=ROLE_MAP[p.mainRole]||p.mainRole;
  const icon=ROLE_ICONS[p.mainRole]||'✦';
  const el=PD.filter(x=>x.games>=3);
  el.forEach(x=>x.powerScore=calcPowerScore(x,el));
  const ps=p.powerScore||calcPowerScore(p,el);
  el.sort((a,b)=>b.powerScore-a.powerScore);
  const rank=el.findIndex(x=>x.player===playerName)+1;

  // Percentile ranks
  function pctRank(key,inv){
    const vals=PD.filter(x=>x.games>=3).map(x=>x[key]).sort((a,b)=>a-b);
    const idx=vals.filter(v=>inv?v>p[key]:v<p[key]).length;
    return Math.round(idx/vals.length*100);
  }

  // Game log from raw data
  const rows=getFilteredRows();
  const gameLog=[];
  for(const r of rows){
    let n=r['Summoner Name']||'';
    if(NAME_MERGES[n])n=NAME_MERGES[n];
    if(n!==playerName)continue;
    gameLog.push({
      date:parseDate(r['Date']||''),
      champ:r['Champion']||'Unknown',
      win:r['Win']==='Win',
      kills:parseFloat(r['Kills'])||0,
      deaths:parseFloat(r['Deaths'])||0,
      assists:parseFloat(r['Assists'])||0,
      cs:parseFloat(r['CS'])||0,
      damage:parseFloat(r['Total Damage to Champions'])||0,
      gold:parseFloat(r['Gold Earned'])||0,
      duration:parseFloat(r['Game Duration (min)'])||0,
      vision:parseFloat(r['Vision Score'])||0,
      team:(r['Teams']||'').trim(),
      role:r['Role']||''
    });
  }
  gameLog.sort((a,b)=>b.date.localeCompare(a.date));

  // Champion breakdown
  const cm={};(p.champData||[]).forEach(x=>{
    if(!cm[x.champ])cm[x.champ]={games:0,wins:0,kills:0,deaths:0,assists:0,damage:0,cs:0};
    const ch=cm[x.champ];ch.games++;ch.wins+=(x.win?1:0);ch.kills+=x.kills;ch.deaths+=x.deaths;ch.assists+=x.assists;ch.damage+=x.damage;ch.cs+=x.cs;
  });
  const champList=Object.entries(cm).map(([n,x])=>({
    name:n,games:x.games,wr:+(x.wins/x.games*100).toFixed(0),
    kda:+((x.kills+x.assists)/Math.max(x.deaths,1)).toFixed(2),
    avgDmg:Math.round(x.damage/x.games),avgCS:Math.round(x.cs/x.games)
  })).sort((a,b)=>b.games-a.games);

  // Streaks
  let curStreak=0,bestWin=0,bestLoss=0,curWS=0,curLS=0;
  const sortedGames=[...gameLog].sort((a,b)=>a.date.localeCompare(b.date));
  sortedGames.forEach(g=>{
    if(g.win){curWS++;curLS=0;if(curWS>bestWin)bestWin=curWS}
    else{curLS++;curWS=0;if(curLS>bestLoss)bestLoss=curLS}
  });
  const lastGames=gameLog.slice(0,5);
  const recentWR=lastGames.length?Math.round(lastGames.filter(g=>g.win).length/lastGames.length*100):0;

  // Build HTML
  let h=`<div class="lookup-profile">`;

  // Header
  h+=`<div class="lookup-header" style="--tc:${c}"><div class="lh-icon">${icon}</div><div><div class="lh-name" style="color:${c}">${p.player}</div><div class="lh-sub">${p.team} · ${rl} · ${p.games} Games · ${p.wins}W ${p.losses}L · ${p.winRate}% WR</div></div><div style="margin-left:auto;text-align:right"><div class="lh-rating" style="color:${c}">${ps}</div><div class="lh-rating-label">POWER RATING #${rank}</div></div></div>`;

  // Stats grid
  h+=`<div class="lookup-grid">`;

  // Core stats with percentiles
  h+=`<div class="lookup-card"><div class="lc-title">Core Statistics</div>`;
  const coreStats=[
    {label:'KDA',val:p.kda,fmt:'dec',key:'kda',pct:pctRank('kda')},
    {label:'Kills/Game',val:p.killsPerGame,fmt:'dec',key:'killsPerGame',pct:pctRank('killsPerGame')},
    {label:'Deaths/Game',val:p.deathsPerGame,fmt:'dec',key:'deathsPerGame',pct:pctRank('deathsPerGame',true)},
    {label:'Assists/Game',val:p.assistsPerGame,fmt:'dec',key:'assistsPerGame',pct:pctRank('assistsPerGame')},
    {label:'CS/Min',val:p.csPerMin,fmt:'dec',key:'csPerMin',pct:pctRank('csPerMin')},
    {label:'Gold/Min',val:p.goldPerMin,fmt:'dec',key:'goldPerMin',pct:pctRank('goldPerMin')},
    {label:'Damage/Min',val:p.damagePerMin,fmt:'num',key:'damagePerMin',pct:pctRank('damagePerMin')},
    {label:'Vision/Min',val:p.visionPerMin,fmt:'dec',key:'visionPerMin',pct:pctRank('visionPerMin')},
  ];
  coreStats.forEach(s=>{
    const bc=s.pct>=75?'var(--green)':s.pct>=50?'var(--cyan)':s.pct>=25?'var(--gold)':'var(--pink)';
    h+=`<div style="display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid #ffffff06"><span style="font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--dim)">${s.label}</span><span style="display:flex;align-items:center;gap:8px"><span style="font-family:'Orbitron',sans-serif;font-size:12px;font-weight:700;color:${c}">${fmtVal(s.val,s.fmt)}</span><span style="font-family:'Share Tech Mono',monospace;font-size:9px;color:${bc};min-width:35px;text-align:right">Top ${100-s.pct}%</span></span></div>`;
  });
  h+=`</div>`;

  // Streaks & trends
  h+=`<div class="lookup-card"><div class="lc-title">Streaks & Trends</div>`;
  h+=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">`;
  h+=`<div style="background:var(--bg3);padding:10px;text-align:center"><div style="font-family:'Orbitron',sans-serif;font-size:18px;font-weight:700;color:var(--green)">${bestWin}</div><div style="font-family:'Share Tech Mono',monospace;font-size:8px;color:var(--dim);letter-spacing:1px">BEST WIN STREAK</div></div>`;
  h+=`<div style="background:var(--bg3);padding:10px;text-align:center"><div style="font-family:'Orbitron',sans-serif;font-size:18px;font-weight:700;color:var(--pink)">${bestLoss}</div><div style="font-family:'Share Tech Mono',monospace;font-size:8px;color:var(--dim);letter-spacing:1px">WORST LOSS STREAK</div></div>`;
  h+=`<div style="background:var(--bg3);padding:10px;text-align:center"><div style="font-family:'Orbitron',sans-serif;font-size:18px;font-weight:700;color:${recentWR>=50?'var(--green)':'var(--pink)'}">${recentWR}%</div><div style="font-family:'Share Tech Mono',monospace;font-size:8px;color:var(--dim);letter-spacing:1px">LAST 5 WIN RATE</div></div>`;
  h+=`<div style="background:var(--bg3);padding:10px;text-align:center"><div style="font-family:'Orbitron',sans-serif;font-size:18px;font-weight:700;color:${c}">${champList.length}</div><div style="font-family:'Share Tech Mono',monospace;font-size:8px;color:var(--dim);letter-spacing:1px">UNIQUE CHAMPS</div></div>`;
  h+=`</div>`;
  // Last 5 results
  h+=`<div style="font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim);margin-bottom:6px;letter-spacing:1px">LAST 5 RESULTS</div>`;
  h+=`<div style="display:flex;gap:4px">`;
  lastGames.forEach(g=>{
    h+=`<div style="width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-family:'Orbitron',sans-serif;font-size:9px;font-weight:700;background:${g.win?'#22c55e15':'#ff2d7b15'};border:1px solid ${g.win?'var(--green)':'var(--pink)'};color:${g.win?'var(--green)':'var(--pink)'}">${g.win?'W':'L'}</div>`;
  });
  h+=`</div></div>`;

  // Champion pool
  h+=`<div class="lookup-card" style="grid-column:1/-1"><div class="lc-title">Champion Pool</div>`;
  h+=`<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:8px">`;
  champList.slice(0,12).forEach(ch=>{
    const wc=ch.wr>=55?'var(--green)':ch.wr<=45?'var(--pink)':'var(--text)';
    h+=`<div style="display:flex;align-items:center;gap:8px;background:var(--bg3);padding:8px;border:1px solid transparent;transition:all .2s" onmouseover="this.style.borderColor='var(--border)'" onmouseout="this.style.borderColor='transparent'">${champImg(ch.name,'champ-icon')}<div style="flex:1;min-width:0"><div style="font-weight:700;font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${ch.name}</div><div style="font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--dim)">${ch.games}g · ${ch.kda} KDA · ${Math.round(ch.avgDmg).toLocaleString()} DMG</div></div><div style="font-family:'Orbitron',sans-serif;font-size:12px;font-weight:700;color:${wc}">${ch.wr}%</div></div>`;
  });
  h+=`</div></div>`;

  // Game Log
  h+=`<div class="lookup-card" style="grid-column:1/-1"><div class="lc-title">Game Log (Last 20)</div>`;
  h+=`<div style="overflow-x:auto">`;
  gameLog.slice(0,20).forEach(g=>{
    const kda=`${g.kills}/${g.deaths}/${g.assists}`;
    const kdaNum=((g.kills+g.assists)/Math.max(g.deaths,1)).toFixed(1);
    h+=`<div class="lookup-game-row"><div class="lgr-result" style="background:${g.win?'#22c55e15':'#ff2d7b15'};color:${g.win?'var(--green)':'var(--pink)'}">${g.win?'W':'L'}</div><div class="lgr-champ">${champImg(g.champ,'champ-icon-sm')}${g.champ}</div><div class="lgr-kda">${kda} <span style="color:var(--dim)">(${kdaNum})</span> · ${Math.round(g.damage).toLocaleString()} DMG · ${g.cs} CS</div><div class="lgr-date">${g.duration.toFixed(0)}m</div><div class="lgr-date">${g.date.slice(5)}</div></div>`;
  });
  h+=`</div></div>`;

  h+=`</div>`; // end lookup-grid

  // Actions
  h+=`<div class="lookup-actions"><button onclick="openProfile('${playerName.replace(/'/g,"\\'")}')">📊 Full Profile</button><button onclick="openTradingCard('${playerName.replace(/'/g,"\\'")}')">🃏 Trading Card</button><button onclick="toggleCompare('${playerName.replace(/'/g,"\\'")}');switchTab('leaderboard',true)">⚔ Add to Compare</button></div>`;

  h+=`</div>`; // end lookup-profile

  document.getElementById('lookupResult').innerHTML=h;
}

function renderLookup(){
  // Just ensure input is visible, don't clear results
  const input=document.getElementById('lookupInput');
  if(input&&!input.value&&PD.length){
    // Show some random suggestions
    const sample=PD.filter(p=>p.games>=5).sort(()=>Math.random()-.5).slice(0,6);
    document.getElementById('lookupSuggestions').innerHTML='<div style="font-family:\'Share Tech Mono\',monospace;font-size:10px;color:var(--dim);margin-bottom:8px;letter-spacing:1px">POPULAR PLAYERS</div><div class="lookup-suggestions">'+sample.map(p=>{
      const c=TC[p.team]||'#6366f1';
      return`<div class="lookup-sug" onclick="runLookup('${p.player.replace(/'/g,"\\'")}')"><span style="color:${c}">${p.player}</span><span class="ls-team">${p.team} · ${p.games}g</span></div>`;
    }).join('')+'</div>';
  }
}

// Add lookup to tab rendering
const _origRenderCurrentTab=renderCurrentTab;
renderCurrentTab=function(){
  if(curTab==='lookup'){renderLookup();return}
  if(curTab==='timeline'){renderTimeline();return}
  if(curTab==='scouting'){return}  // scouting is interactive, no auto-render
  _origRenderCurrentTab();
};

// ════════════════════════════════════════
// GAME NIGHT TIMELINE
// ════════════════════════════════════════
function renderTimeline(){
  var el=document.getElementById('timelineContent');if(!el)return;
  var rows=getFilteredRows();if(!rows.length){el.innerHTML='<div class="nodata">NO DATA</div>';return}

  // Group by date
  var nights={};
  rows.forEach(function(r){
    var d=(r['Date']||'').trim();if(!d)return;
    if(!nights[d])nights[d]=[];
    nights[d].push(r);
  });

  var sortedDates=Object.keys(nights).sort();
  if(!sortedDates.length){el.innerHTML='<div class="nodata">NO GAME NIGHTS</div>';return}

  // Apply date filters
  var fromVal=document.getElementById('tlFrom').value;
  var toVal=document.getElementById('tlTo').value;
  if(fromVal)sortedDates=sortedDates.filter(function(d){return d>=fromVal});
  if(toVal)sortedDates=sortedDates.filter(function(d){return d<=toVal});
  if(!sortedDates.length){el.innerHTML='<div class="nodata">NO GAME NIGHTS IN RANGE</div>';return}

  // Track running records for "new record" detection
  var allTimeRecords={kills:0,damage:0,kda:0};

  var h='<div class="tl-wrap"><div class="tl-line"></div>';

  sortedDates.forEach(function(date,di){
    var nightRows=nights[date];
    var matchIds=new Set(nightRows.map(function(r){return r['Match ID']||''}).filter(function(m){return m}));
    var matchCount=matchIds.size||Math.ceil(nightRows.length/10);

    // Aggregate player stats for this night
    var players={};
    nightRows.forEach(function(r){
      var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];if(!n)return;
      if(!players[n])players[n]={kills:0,deaths:0,assists:0,dmg:0,games:0,wins:0,team:'',champs:[],pentas:0,bestKills:0};
      var p=players[n];var k=parseFloat(r['Kills'])||0;
      p.kills+=k;p.deaths+=(parseFloat(r['Deaths'])||0);p.assists+=(parseFloat(r['Assists'])||0);
      p.dmg+=(parseFloat(r['Total Damage to Champions'])||0);p.games++;
      if(r['Win']==='Win')p.wins++;p.team=(r['Teams']||'').trim();
      p.champs.push(r['Champion']||'');p.pentas+=(parseFloat(r['Penta Kills'])||0);
      if(k>p.bestKills)p.bestKills=k;
    });

    // Find MVP of the night
    var mvpName='',mvpScore=-1,mvp=null;
    for(var name in players){
      var pl=players[name];
      var kda=(pl.kills+pl.assists)/Math.max(pl.deaths,1);
      var wr=pl.wins/pl.games;
      var score=kda*2+wr*3+(pl.dmg/pl.games/1000);
      if(score>mvpScore){mvpScore=score;mvpName=name;mvp=pl}
    }

    // Detect highlights
    var tags=[];
    var totalPlayers=Object.keys(players).length;

    // MVP tag
    if(mvpName&&mvp){
      var mkda=((mvp.kills+mvp.assists)/Math.max(mvp.deaths,1)).toFixed(1);
      tags.push({cls:'tl-mvp-tag',text:'⭐ MVP: '+mvpName+' ('+mkda+' KDA)'});
    }

    // Check for records broken this night
    var nightMaxKills=0,nightMaxDmg=0,nightMaxKDA=0;
    nightRows.forEach(function(r){
      var k=parseFloat(r['Kills'])||0,d=parseFloat(r['Deaths'])||0,a=parseFloat(r['Assists'])||0;
      var dmg=parseFloat(r['Total Damage to Champions'])||0;
      var kda=(k+a)/Math.max(d,1);
      if(k>nightMaxKills)nightMaxKills=k;
      if(dmg>nightMaxDmg)nightMaxDmg=dmg;
      if(kda>nightMaxKDA)nightMaxKDA=kda;
    });
    if(nightMaxKills>allTimeRecords.kills){allTimeRecords.kills=nightMaxKills;tags.push({cls:'tl-record-tag',text:'🏆 NEW KILL RECORD: '+nightMaxKills})}
    if(nightMaxDmg>allTimeRecords.damage){allTimeRecords.damage=nightMaxDmg;tags.push({cls:'tl-record-tag',text:'🏆 NEW DAMAGE RECORD: '+Math.round(nightMaxDmg).toLocaleString()})}

    // High kill games
    for(var pn in players){if(players[pn].bestKills>=15)tags.push({cls:'tl-kill-tag',text:'🔥 '+pn+': '+players[pn].bestKills+' kills'})}

    // Pentakills
    for(var pn2 in players){if(players[pn2].pentas>0)tags.push({cls:'tl-penta-tag',text:'💎 PENTAKILL: '+pn2})}

    // Match count
    tags.push({cls:'tl-match-tag',text:matchCount+' match'+(matchCount>1?'es':'')+' · '+totalPlayers+' players'});

    var isBig=tags.some(function(t){return t.cls==='tl-record-tag'||t.cls==='tl-penta-tag'});
    var dateStr=formatDate(parseDate(date));
    var delay=Math.min(di*0.06,2);

    // Build individual game rows for expand section
    var gameRows='';
    nightRows.forEach(function(r){
      var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];
      var k=parseFloat(r['Kills'])||0,d=parseFloat(r['Deaths'])||0,a=parseFloat(r['Assists'])||0;
      var champ=r['Champion']||'';var win=r['Win']==='Win';var tm=(r['Teams']||'').trim();
      var c=TC[tm]||'var(--dim)';
      gameRows+='<div class="tl-game"><span class="'+(win?'win':'loss')+'">'+(win?'W':'L')+'</span><span class="champ">'+champ+'</span><span class="player" style="color:'+c+'" onclick="openProfile(\''+n.replace(/'/g,"\\'")+'\')">' +n+'</span><span class="kda">'+k+'/'+d+'/'+a+'</span><span style="color:var(--dim)">'+tm+'</span></div>';
    });

    h+='<div class="tl-node" style="animation-delay:'+delay+'s">';
    h+='<div class="tl-dot'+(isBig?' big-night':'')+'"></div>';
    h+='<div class="tl-card" onclick="var ex=this.querySelector(\'.tl-expand\');if(ex)ex.classList.toggle(\'open\')">';
    h+='<div class="tl-date" style="color:'+(isBig?'var(--gold)':'var(--cyan)')+'">'+dateStr+'</div>';
    h+='<div class="tl-summary">GAME NIGHT '+(di+1)+'</div>';
    h+='<div class="tl-highlights">'+tags.map(function(t){return'<span class="tl-tag '+t.cls+'">'+t.text+'</span>'}).join('')+'</div>';
    h+='<div class="tl-expand"><div style="font-family:\'Share Tech Mono\',monospace;font-size:8px;color:var(--dim);letter-spacing:1px;margin-bottom:6px">ALL GAMES THIS NIGHT</div>'+gameRows+'</div>';
    h+='</div></div>';
  });

  h+='</div>';
  el.innerHTML=h;
}

// ════════════════════════════════════════
// SCOUTING TAB — FULL DEEP DIVE
// ════════════════════════════════════════
var _scoutPlayer='';

function onScoutSearch(val){
  var sg=document.getElementById('scoutSuggestions');if(!sg)return;
  if(!val||val.length<1){sg.innerHTML='';return}
  var q=val.toLowerCase();
  var matches=PD.filter(function(p){return p.player.toLowerCase().includes(q)}).slice(0,8);
  sg.innerHTML=matches.map(function(p){
    var c=TC[p.team]||'var(--cyan)';
    return'<div class="scout-suggest" onclick="document.getElementById(\'scoutInput\').value=\''+p.player.replace(/'/g,"\\'")+'\';runScoutReport()" style="border-left:3px solid '+c+'">'+p.player+'<span style="color:var(--dim);margin-left:6px;font-size:9px">'+p.team+'</span></div>';
  }).join('');
}

function runScoutReport(){
  var name=document.getElementById('scoutInput').value.trim();
  if(!name)return;
  document.getElementById('scoutSuggestions').innerHTML='';
  var p=PD.find(function(x){return x.player.toLowerCase()===name.toLowerCase()});
  if(!p){document.getElementById('scoutReport').innerHTML='<div class="nodata">PLAYER NOT FOUND</div>';document.getElementById('scoutReport').classList.add('active');return}
  _scoutPlayer=p.player;
  renderFullScout(p);
}

function renderFullScout(p){
  var el=document.getElementById('scoutReport');
  var c=TC[p.team]||'#6366f1';
  var rl=ROLE_MAP[p.mainRole]||p.mainRole;
  var rows=getFilteredRows();
  var pRows=rows.filter(function(r){var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];return n===p.player});

  // Helper: avg of column
  function colAvg(col){var vals=pRows.map(function(r){return parseFloat(r[col])||0});return vals.length?vals.reduce(function(s,v){return s+v},0)/vals.length:0}
  function colSum(col){return pRows.reduce(function(s,r){return s+(parseFloat(r[col])||0)},0)}
  // Percentile among all players with 3+ games
  var all=PD.filter(function(x){return x.games>=3});
  function pctOf(key,inv){
    var sorted=[].concat(all).sort(function(a,b){return a[key]-b[key]});
    var idx=sorted.findIndex(function(x){return x.player===p.player});
    var pc=idx/(sorted.length-1||1);
    return inv?1-pc:pc;
  }

  // Get team-relative stats
  var tr=getTeamRelativeStats(p.player,rows);
  var consist=getConsistency(p.player,rows);
  var form=getFormRating(p.player,rows);
  var tags=getPlaystyleTags(p.player,rows);

  var h='';

  // === HEADER ===
  h+='<div class="scout-header"><div><div class="scout-name" style="color:'+c+'">'+p.player+'</div>';
  h+='<div class="scout-sub">'+p.team+' · '+rl+' · '+p.games+' Games · '+p.wins+'W '+p.losses+'L · '+p.winRate+'% WR</div>';
  if(tags.length)h+='<div style="margin-top:6px">'+renderPlaystyleHTML(tags)+'</div>';
  h+='</div><div class="scout-actions">';
  h+='<button class="scout-btn primary" onclick="copyScoutReportFull(\''+p.player.replace(/'/g,"\\'")+'\')">📋 COPY REPORT</button>';
  h+='<button class="scout-btn" onclick="exportScoutCSV(\''+p.player.replace(/'/g,"\\'")+'\')">💾 SAVE CSV</button>';
  h+='<button class="scout-btn" onclick="shareScoutDiscord(\''+p.player.replace(/'/g,"\\'")+'\')">🎮 DISCORD EMBED</button>';
  h+='</div></div>';

  // === ROW HELPER WITH PERCENTILE BAR ===
  function statRow(label,val,fmt,pctile,color){
    var display=fmt==='pct'?val.toFixed(1)+'%':fmt==='int'?Math.round(val).toLocaleString():fmt==='dec1'?val.toFixed(1):fmt==='dec2'?val.toFixed(2):val;
    var barPct=Math.round(pctile*100);
    var barColor=barPct>=70?'var(--green)':barPct>=40?color:'var(--pink)';
    return'<div class="scout-row"><span class="scout-row-label">'+label+'</span><div class="scout-bar-wrap"><div class="scout-bar-track"><div class="scout-bar-fill" style="width:'+barPct+'%;background:'+barColor+'"></div></div><span class="scout-bar-pct">'+barPct+'%</span></div><span class="scout-row-val" style="color:'+barColor+'">'+display+'</span></div>';
  }

  // Simple row (no bar)
  function simpleRow(label,val,valColor){
    return'<div class="scout-row"><span class="scout-row-label">'+label+'</span><span class="scout-row-val" style="color:'+(valColor||'var(--text)')+'">'+val+'</span></div>';
  }

  h+='<div class="scout-grid">';

  // === CARD 1: CORE PERFORMANCE ===
  h+='<div class="scout-card"><div class="scout-card-title">Core Performance</div>';
  h+=statRow('KDA',p.kda,'dec2',pctOf('kda'),c);
  h+=statRow('Win Rate',p.winRate,'pct',pctOf('winRate'),c);
  h+=statRow('Kills/Game',p.killsPerGame,'dec1',pctOf('killsPerGame'),c);
  h+=statRow('Deaths/Game',p.deathsPerGame,'dec1',pctOf('deathsPerGame',true),c);
  h+=statRow('Assists/Game',p.assistsPerGame,'dec1',pctOf('assistsPerGame'),c);
  h+=simpleRow('Solo Kills/Game',colAvg('Solo Kills').toFixed(1));
  h+=simpleRow('Kill Participation',colAvg('Kill Participation %').toFixed(1)+'%');
  h+='</div>';

  // === CARD 2: DAMAGE PROFILE ===
  h+='<div class="scout-card"><div class="scout-card-title">Damage Profile</div>';
  h+=statRow('DMG/Min',p.damagePerMin,'int',pctOf('damagePerMin'),c);
  h+=simpleRow('DMG Share',colAvg('Damage Share %').toFixed(1)+'%',colAvg('Damage Share %')>=25?'var(--green)':c);
  h+=simpleRow('DMG Per Gold',colAvg('Damage Per Gold').toFixed(2));
  var phys=colSum('Physical Damage'),mag=colSum('Magic Damage'),tru=colSum('True Damage');
  var total=phys+mag+tru||1;
  h+=simpleRow('Physical',Math.round(phys/total*100)+'%','#ef4444');
  h+=simpleRow('Magic',Math.round(mag/total*100)+'%','#3b82f6');
  h+=simpleRow('True',Math.round(tru/total*100)+'%','#fbbf24');
  h+=simpleRow('DMG Taken/Min',colAvg('Damage Taken/min').toFixed(0));
  h+='</div>';

  // === CARD 3: LANING PHASE ===
  // Lane diffs: group by Match ID, find opponent with same Role on other team, subtract
  var _lm={};
  rows.forEach(function(r){var mid=r['Match ID']||'';if(mid){if(!_lm[mid])_lm[mid]=[];_lm[mid].push(r)}});
  var _ld={cs5:[],cs10:[],cs15:[],cs20:[],g5:[],g10:[],g15:[],g20:[],xp5:[],xp10:[],xp15:[],xp20:[]};
  var _lc=0;
  Object.keys(_lm).forEach(function(mid){
    var mr=_lm[mid];var me=null;
    mr.forEach(function(r){var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];if(n===p.player)me=r});
    if(!me)return;
    var myT=String(me['Teams']||me['FPL Team']||'').trim();
    var myR=String(me['Role']||'').trim();
    var opp=null;
    mr.forEach(function(r){
      var rT=String(r['Teams']||r['FPL Team']||'').trim();
      var rR=String(r['Role']||'').trim();
      if(rT!==myT&&rR===myR)opp=r;
    });
    if(!opp)return;
    _lc++;
    ['5','10','15','20'].forEach(function(t){
      _ld['cs'+t].push((parseFloat(me['CS@'+t])||0)-(parseFloat(opp['CS@'+t])||0));
      _ld['g'+t].push((parseFloat(me['Gold@'+t])||0)-(parseFloat(opp['Gold@'+t])||0));
      _ld['xp'+t].push((parseFloat(me['XP@'+t])||0)-(parseFloat(opp['XP@'+t])||0));
    });
  });
  function _lavg(arr){return arr.length?arr.reduce(function(s,v){return s+v},0)/arr.length:0}
  function _lcol(v){return v>0?'var(--green)':v<0?'var(--pink)':'var(--dim)'}
  function _lfmt(v,rnd){var s=rnd?Math.round(v):v.toFixed(1);return(v>0?'+':'')+s}

  h+='<div class="scout-card"><div class="scout-card-title">Laning Phase'+(_lc?' ('+_lc+' lane matchups)':'')+'</div>';
  h+='<div class="scout-laning">';
  ['5','10','15','20'].forEach(function(t){
    var d=_lavg(_ld['cs'+t]);
    h+='<div class="scout-lane-cell"><div class="scout-lane-min">CS Diff @'+t+'</div><div class="scout-lane-val" style="color:'+_lcol(d)+'">'+_lfmt(d)+'</div></div>';
  });
  h+='</div><div class="scout-laning" style="margin-top:4px">';
  ['5','10','15','20'].forEach(function(t){
    var d=_lavg(_ld['g'+t]);
    h+='<div class="scout-lane-cell"><div class="scout-lane-min">Gold Diff @'+t+'</div><div class="scout-lane-val" style="color:'+_lcol(d)+'">'+_lfmt(d,true)+'</div></div>';
  });
  h+='</div><div class="scout-laning" style="margin-top:4px">';
  ['5','10','15','20'].forEach(function(t){
    var d=_lavg(_ld['xp'+t]);
    h+='<div class="scout-lane-cell"><div class="scout-lane-min">XP Diff @'+t+'</div><div class="scout-lane-val" style="color:'+_lcol(d)+'">'+_lfmt(d,true)+'</div></div>';
  });
  h+='</div>';
  h+=simpleRow('Lvl 6 Timing',colAvg('Level 6 Timing (min)').toFixed(1)+' min');
  h+=simpleRow('CS Adv Over Opponent','+'+colAvg('Max CS Advantage on Lane Opponent').toFixed(1));
  h+=simpleRow('Lvl Lead Over Opponent','+'+colAvg('Max Level Lead on Lane Opponent').toFixed(1));
  h+=simpleRow('Lane Minions First 10',colAvg('Lane Minions First 10 Min').toFixed(0));
  h+=simpleRow('Jungle CS Before 10',colAvg('Jungle CS Before 10 Min').toFixed(0));
  h+='</div>';

  // === CARD 4: ECONOMY ===
  h+='<div class="scout-card"><div class="scout-card-title">Economy</div>';
  h+=statRow('Gold/Min',p.goldPerMin,'dec1',pctOf('goldPerMin'),c);
  h+=statRow('CS/Min',p.csPerMin,'dec1',pctOf('csPerMin'),c);
  h+=simpleRow('Gold Share',colAvg('Gold Share %').toFixed(1)+'%',colAvg('Gold Share %')>=24?'var(--gold)':c);
  h+=simpleRow('Turret Plates',colAvg('Turret Plates Destroyed').toFixed(1)+'/g');
  h+=simpleRow('Bounty Gold Earned',colAvg('Bounty Gold').toFixed(0)+'/g');
  h+='</div>';

  // === CARD 5: VISION & MAP CONTROL ===
  h+='<div class="scout-card"><div class="scout-card-title">Vision & Map Control</div>';
  h+=statRow('Vision/Min',p.visionPerMin,'dec2',pctOf('visionPerMin'),c);
  h+=simpleRow('Wards Placed/Game',colAvg('Wards Placed').toFixed(1));
  h+=simpleRow('Wards Killed/Game',colAvg('Wards Killed').toFixed(1));
  h+=simpleRow('Control Wards/Game',colAvg('Control Wards Bought').toFixed(1));
  h+=simpleRow('Vision Adv vs Opponent',colAvg('Vision Score Advantage Over Lane Opponent').toFixed(2));
  h+=simpleRow('Wards Guarded/Game',colAvg('Wards Guarded').toFixed(1));
  h+='</div>';

  // === CARD 6: TEAM IMPACT ===
  h+='<div class="scout-card"><div class="scout-card-title">Team Impact</div>';
  if(tr&&tr.gamesAnalyzed){
    if(tr.dmgShare!==null)h+=simpleRow('DMG Share (calc)',tr.dmgShare.toFixed(1)+'%',tr.dmgShare>=25?'var(--green)':c);
    if(tr.goldShare!==null)h+=simpleRow('Gold Share (calc)',tr.goldShare.toFixed(1)+'%');
    if(tr.killParticipation!==null)h+=simpleRow('Kill Participation (calc)',tr.killParticipation.toFixed(1)+'%',tr.killParticipation>=70?'var(--green)':c);
    if(tr.deathShare!==null)h+=simpleRow('Death Share',tr.deathShare.toFixed(1)+'%',tr.deathShare>=30?'var(--pink)':tr.deathShare<=15?'var(--green)':c);
  }
  h+=simpleRow('Heal+Shield',colAvg('Effective Heal and Shield').toFixed(0)+'/g');
  h+=simpleRow('CC Time/Game',colAvg('Time CCing Others (s)').toFixed(1)+'s');
  h+=simpleRow('Total CC Dealt/Game',colAvg('Total CC Dealt (s)').toFixed(0)+'s');
  h+=simpleRow('Healing on Team/Game',colAvg('Healing on Teammates').toFixed(0));
  h+=simpleRow('Shielding on Team/Game',colAvg('Shielding on Teammates').toFixed(0));
  h+='</div>';

  // === CARD 7: OBJECTIVES ===
  h+='<div class="scout-card"><div class="scout-card-title">Objectives</div>';
  h+=simpleRow('Turret Kills/Game',colAvg('Turret Kills').toFixed(1));
  h+=simpleRow('Turret Damage/Game',colAvg('Turret Damage').toFixed(0));
  h+=simpleRow('Objective DMG/Game',colAvg('Objective Damage').toFixed(0));
  h+=simpleRow('Turret Takedowns/Game',colAvg('Turret Takedowns').toFixed(1));
  h+=simpleRow('Objs Stolen/Game',colAvg('Objectives Stolen').toFixed(2));
  h+=simpleRow('First Tower Rate',((pRows.filter(function(r){return r['First Turret Killed']==='Yes'}).length/pRows.length)*100).toFixed(0)+'%');
  h+=simpleRow('First Blood Rate',((pRows.filter(function(r){return r['First Blood Kill']==='Yes'}).length/pRows.length)*100).toFixed(0)+'%');
  h+='</div>';

  // === CARD 8: COMBAT MECHANICS ===
  h+='<div class="scout-card"><div class="scout-card-title">Combat Mechanics</div>';
  h+=simpleRow('Skillshots Hit/Game',colAvg('Skillshots Hit').toFixed(0));
  h+=simpleRow('Skillshots Dodged/Game',colAvg('Skillshots Dodged').toFixed(0));
  var hitRate=colAvg('Skillshots Hit')/(colAvg('Skillshots Hit')+colAvg('Skillshots Dodged')+0.01)*100;
  h+=simpleRow('Largest Multi Kill',Math.max.apply(null,pRows.map(function(r){return parseFloat(r['Largest Multi Kill'])||0})));
  h+=simpleRow('Largest Killing Spree',Math.max.apply(null,pRows.map(function(r){return parseFloat(r['Largest Killing Spree'])||0})));
  h+=simpleRow('Longest Time Alive',Math.round(colAvg('Longest Time Alive (s)')/60)+'m avg');
  h+=simpleRow('Time Dead/Game',Math.round(colAvg('Total Time Dead (s)'))+'s');
  h+=simpleRow('Solo Kills Total',colSum('Solo Kills'));
  h+='</div>';

  // === CARD 9: CHAMPION POOL ===
  var cm={};(p.champData||[]).forEach(function(x){
    if(!cm[x.champ])cm[x.champ]={games:0,wins:0,kills:0,deaths:0,assists:0,dmg:0,cs:0,dur:0};
    var ch=cm[x.champ];ch.games++;if(x.win)ch.wins++;ch.kills+=x.kills;ch.deaths+=x.deaths;ch.assists+=x.assists;ch.dmg+=x.damage;ch.cs+=x.cs||0;ch.dur+=x.duration||0;
  });
  // Also pull extra data from raw rows for this card
  pRows.forEach(function(r){
    var chName=r['Champion']||'';if(!chName)return;
    if(!cm[chName])return;
    if(!cm[chName]._soloKills)cm[chName]._soloKills=0;
    if(!cm[chName]._gold)cm[chName]._gold=0;
    cm[chName]._soloKills+=(parseFloat(r['Solo Kills'])||0);
    cm[chName]._gold+=(parseFloat(r['Gold Earned'])||0);
  });
  var champList=Object.entries(cm).map(function(e){
    var n=e[0],d=e[1];
    var kda=((d.kills+d.assists)/Math.max(d.deaths,1));
    var wr=d.wins/d.games*100;
    var avgDmg=d.dmg/d.games;
    var avgCS=d.dur>0?(d.cs/(d.dur)): 0;
    return{name:n,games:d.games,wins:d.wins,wr:wr,kda:kda,kills:d.kills/d.games,deaths:d.deaths/d.games,assists:d.assists/d.games,avgDmg:avgDmg,csMin:avgCS,soloKills:(d._soloKills||0)/d.games,gold:(d._gold||0)/d.games};
  }).sort(function(a,b){return b.games-a.games});

  if(champList.length){
    h+='<div class="scout-card" style="grid-column:1/-1"><div class="scout-card-title">Champion Pool ('+champList.length+' Champions)</div>';
    // Header row
    h+='<div style="display:grid;grid-template-columns:32px 1fr 50px 60px 50px 60px 60px 60px 70px;gap:4px;padding:4px 0;border-bottom:1px solid var(--border);font-family:\'Share Tech Mono\',monospace;font-size:8px;color:var(--dim);letter-spacing:1px">';
    h+='<div></div><div>CHAMPION</div><div style="text-align:center">GAMES</div><div style="text-align:center">WIN RATE</div><div style="text-align:center">KDA</div><div style="text-align:center">K/D/A</div><div style="text-align:center">DMG/G</div><div style="text-align:center">CS/MIN</div><div style="text-align:center">RATING</div></div>';
    champList.forEach(function(ch){
      var wrColor=ch.wr>=60?'var(--green)':ch.wr>=50?'var(--text)':'var(--pink)';
      var kdaColor=ch.kda>=4?'var(--green)':ch.kda>=2.5?'var(--text)':'var(--pink)';
      // Rating: weighted score of wr, kda, games
      var rating=Math.min(100,Math.round(ch.wr*0.4+Math.min(ch.kda*8,40)+Math.min(ch.games*3,20)));
      var ratingColor=rating>=75?'var(--green)':rating>=50?'var(--gold)':'var(--pink)';
      var ratingLabel=rating>=80?'S':rating>=65?'A':rating>=50?'B':rating>=35?'C':'D';
      var barW=Math.min(rating,100);
      // Mastery tier label
      var tier=ch.games>=15?'OTP':ch.games>=10?'MAIN':ch.games>=5?'COMFORT':ch.games>=3?'POCKET':'';
      var tierColor=ch.games>=15?'#b9f2ff':ch.games>=10?'var(--gold)':ch.games>=5?'#c0c0c0':'var(--dim)';
      h+='<div style="display:grid;grid-template-columns:32px 1fr 50px 60px 50px 60px 60px 60px 70px;gap:4px;padding:6px 0;border-bottom:1px solid #ffffff04;align-items:center;font-family:\'Share Tech Mono\',monospace;font-size:11px">';
      h+='<div>'+champImg(ch.name,'champ-icon')+'</div>';
      h+='<div><span style="font-weight:700">'+ch.name+'</span>'+(tier?' <span style="font-size:8px;color:'+tierColor+';letter-spacing:1px">'+tier+'</span>':'')+'</div>';
      h+='<div style="text-align:center">'+ch.games+'</div>';
      h+='<div style="text-align:center;color:'+wrColor+'">'+ch.wr.toFixed(0)+'%</div>';
      h+='<div style="text-align:center;color:'+kdaColor+'">'+ch.kda.toFixed(1)+'</div>';
      h+='<div style="text-align:center;color:var(--dim);font-size:10px">'+ch.kills.toFixed(1)+'/'+ch.deaths.toFixed(1)+'/'+ch.assists.toFixed(1)+'</div>';
      h+='<div style="text-align:center">'+Math.round(ch.avgDmg).toLocaleString()+'</div>';
      h+='<div style="text-align:center">'+ch.csMin.toFixed(1)+'</div>';
      h+='<div style="text-align:center"><div style="display:flex;align-items:center;gap:4px;justify-content:center"><div style="width:30px;height:5px;background:#ffffff08;border-radius:2px;overflow:hidden"><div style="width:'+barW+'%;height:100%;background:'+ratingColor+'"></div></div><span style="color:'+ratingColor+';font-weight:700;font-size:12px">'+ratingLabel+'</span></div></div>';
      h+='</div>';
    });
    h+='</div>';
  }

  // === CARD 10: BAN & COUNTER RECOMMENDATIONS ===
  if(champList.length){
    h+='<div class="scout-card" style="grid-column:1/-1"><div class="scout-card-title">Draft Intelligence</div>';
    h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">';

    // === BAN RECOMMENDATIONS ===
    // Sort by: games * winrate * kda (most dangerous picks)
    var banPriority=champList.filter(function(ch){return ch.games>=2}).map(function(ch){
      var threat=ch.wr/100*ch.kda*Math.sqrt(ch.games);
      return{name:ch.name,games:ch.games,wr:ch.wr,kda:ch.kda,threat:threat};
    }).sort(function(a,b){return b.threat-a.threat});

    h+='<div><div style="font-family:\'Orbitron\',sans-serif;font-size:9px;letter-spacing:2px;color:var(--pink);margin-bottom:10px">🚫 RECOMMENDED BANS</div>';
    h+='<div style="font-family:\'Share Tech Mono\',monospace;font-size:9px;color:var(--dim);margin-bottom:8px">Highest threat picks — ban these to weaken '+p.player+'</div>';
    if(banPriority.length){
      banPriority.slice(0,5).forEach(function(ch,i){
        var urgency=i===0?'MUST BAN':i===1?'HIGH PRIORITY':i===2?'STRONG BAN':'CONSIDER';
        var urgColor=i===0?'var(--pink)':i===1?'#f97316':i===2?'var(--gold)':'var(--dim)';
        h+='<div style="display:flex;align-items:center;gap:10px;padding:6px 0;border-bottom:1px solid #ffffff04">';
        h+='<div style="width:20px;text-align:center;font-family:\'Orbitron\',sans-serif;font-size:11px;color:'+urgColor+'">'+(i+1)+'</div>';
        h+=champImg(ch.name,'champ-icon');
        h+='<div style="flex:1"><div style="font-family:\'Share Tech Mono\',monospace;font-size:11px;font-weight:700">'+ch.name+'</div>';
        h+='<div style="font-family:\'Share Tech Mono\',monospace;font-size:9px;color:var(--dim)">'+ch.games+'g · '+ch.wr.toFixed(0)+'% WR · '+ch.kda.toFixed(1)+' KDA</div></div>';
        h+='<div style="font-family:\'Share Tech Mono\',monospace;font-size:8px;letter-spacing:1px;color:'+urgColor+';text-align:right">'+urgency+'</div>';
        h+='</div>';
      });
    } else {
      h+='<div style="color:var(--dim);font-size:10px">Not enough data (need 2+ games on a champ)</div>';
    }

    // Why these bans
    if(banPriority.length>=2){
      h+='<div style="margin-top:10px;padding:8px;background:var(--bg);border-left:2px solid var(--pink);font-family:\'Share Tech Mono\',monospace;font-size:9px;color:var(--dim)">';
      var topBan=banPriority[0];
      h+='<span style="color:var(--pink)">'+topBan.name+'</span> is their strongest pick at <span style="color:var(--green)">'+topBan.wr.toFixed(0)+'% WR</span> with <span style="color:var(--green)">'+topBan.kda.toFixed(1)+' KDA</span> over '+topBan.games+' games. ';
      if(banPriority.length>=3){
        h+='Banning <span style="color:var(--pink)">'+banPriority[0].name+'</span> and <span style="color:var(--pink)">'+banPriority[1].name+'</span> removes their two highest-threat comfort picks.';
      }
      h+='</div>';
    }
    h+='</div>';

    // === EXPLOIT WEAKNESSES (what to pick / force them onto) ===
    var weakChamps=champList.filter(function(ch){return ch.games>=2}).map(function(ch){
      var weakness=(100-ch.wr)/100*(1/Math.max(ch.kda,0.5))*Math.sqrt(ch.games);
      return{name:ch.name,games:ch.games,wr:ch.wr,kda:ch.kda,deaths:ch.deaths,weakness:weakness};
    }).sort(function(a,b){return b.weakness-a.weakness});

    // Find their bad matchup patterns: champs where they lose and die a lot
    var lossChamps=champList.filter(function(ch){return ch.games>=2&&ch.wr<50}).sort(function(a,b){return a.wr-b.wr});
    var highDeathChamps=champList.filter(function(ch){return ch.games>=2&&ch.deaths>=4}).sort(function(a,b){return b.deaths-a.deaths});

    h+='<div><div style="font-family:\'Orbitron\',sans-serif;font-size:9px;letter-spacing:2px;color:var(--green);margin-bottom:10px">✅ EXPLOIT WEAKNESSES</div>';
    h+='<div style="font-family:\'Share Tech Mono\',monospace;font-size:9px;color:var(--dim);margin-bottom:8px">Force them onto weak picks or exploit patterns</div>';

    // Champs they're bad at
    if(lossChamps.length){
      h+='<div style="font-family:\'Share Tech Mono\',monospace;font-size:8px;letter-spacing:1px;color:var(--dim);margin-bottom:4px">WORST CHAMPIONS (let these through)</div>';
      lossChamps.slice(0,3).forEach(function(ch){
        h+='<div style="display:flex;align-items:center;gap:10px;padding:5px 0;border-bottom:1px solid #ffffff04">';
        h+=champImg(ch.name,'champ-icon');
        h+='<div style="flex:1;font-family:\'Share Tech Mono\',monospace;font-size:11px">'+ch.name+'</div>';
        h+='<div style="font-family:\'Share Tech Mono\',monospace;font-size:10px"><span style="color:var(--pink)">'+ch.wr.toFixed(0)+'% WR</span> · '+ch.kda.toFixed(1)+' KDA · '+ch.games+'g</div>';
        h+='</div>';
      });
    }

    // Champs they've lost AGAINST the most (enemy champs that beat them)
    var enemyChamps={};
    var matchGroups={};
    rows.forEach(function(r){var mid=r['Match ID']||'';if(mid){if(!matchGroups[mid])matchGroups[mid]=[];matchGroups[mid].push(r)}});
    for(var mid in matchGroups){
      var mRows=matchGroups[mid];
      var pRow=null;
      mRows.forEach(function(r){var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];if(n===p.player)pRow=r});
      if(!pRow)continue;
      var pTeam=(pRow['Teams']||pRow['FPL Team']||'').trim();
      var lost=pRow['Win']!=='Win';
      mRows.forEach(function(r){
        var rTeam=(r['Teams']||r['FPL Team']||'').trim();
        if(rTeam===pTeam)return; // same team, skip
        var eCh=r['Champion']||'';if(!eCh)return;
        if(!enemyChamps[eCh])enemyChamps[eCh]={games:0,losses:0};
        enemyChamps[eCh].games++;
        if(lost)enemyChamps[eCh].losses++;
      });
    }
    var nemesis=Object.entries(enemyChamps).filter(function(e){return e[1].games>=2&&e[1].losses>=2}).map(function(e){
      return{name:e[0],games:e[1].games,losses:e[1].losses,lossRate:e[1].losses/e[1].games*100};
    }).sort(function(a,b){return b.losses-a.losses||b.lossRate-a.lossRate});

    if(nemesis.length){
      h+='<div style="margin-top:10px;font-family:\'Share Tech Mono\',monospace;font-size:8px;letter-spacing:1px;color:var(--dim);margin-bottom:4px">NEMESIS CHAMPIONS (they lose to these)</div>';
      nemesis.slice(0,5).forEach(function(ch){
        var lrColor=ch.lossRate>=75?'var(--green)':'var(--gold)';
        h+='<div style="display:flex;align-items:center;gap:10px;padding:5px 0;border-bottom:1px solid #ffffff04">';
        h+=champImg(ch.name,'champ-icon');
        h+='<div style="flex:1;font-family:\'Share Tech Mono\',monospace;font-size:11px">'+ch.name+'</div>';
        h+='<div style="font-family:\'Share Tech Mono\',monospace;font-size:10px"><span style="color:'+lrColor+'">'+ch.losses+'L</span> in '+ch.games+'g · <span style="color:'+lrColor+'">'+ch.lossRate.toFixed(0)+'% loss rate</span></div>';
        h+='</div>';
      });
    }

    // Exploitable patterns
    h+='<div style="margin-top:10px;font-family:\'Share Tech Mono\',monospace;font-size:8px;letter-spacing:1px;color:var(--dim);margin-bottom:4px">EXPLOITABLE PATTERNS</div>';
    var patterns=[];
    // High death rate overall
    if(p.deathsPerGame>=4)patterns.push({icon:'💀',text:'Dies '+p.deathsPerGame.toFixed(1)+' times/game — pick aggressive all-in champions',color:'var(--green)'});
    // Low vision
    if(colAvg('Wards Placed')<8)patterns.push({icon:'👁️',text:'Low ward count ('+colAvg('Wards Placed').toFixed(1)+'/g) — abuse vision gaps with flanks and roams',color:'var(--green)'});
    // Weak early game (low CS@10 or Gold@10)
    var cs10=colAvg('CS@10');
    if(cs10>0&&cs10<60&&(p.mainRole==='MIDDLE'||p.mainRole==='BOTTOM'||p.mainRole==='TOP'))patterns.push({icon:'🏰',text:'Avg '+cs10.toFixed(0)+' CS@10 — punish weak laning with early aggression',color:'var(--green)'});
    // Small champ pool
    var comfortPicks=champList.filter(function(ch){return ch.games>=3}).length;
    if(comfortPicks<=2)patterns.push({icon:'🎭',text:'Only '+comfortPicks+' comfort pick'+(comfortPicks>1?'s':'')+' — easy to ban out',color:'var(--green)'});
    // Feast or famine (high variance)
    if(consist&&consist.score<40)patterns.push({icon:'🎲',text:'Inconsistent performer ('+consist.score+'/100) — coinflip player, may tilt if set behind early',color:'var(--green)'});
    // Low KP
    if(colAvg('Kill Participation %')<55)patterns.push({icon:'🏝️',text:'Low kill participation ('+colAvg('Kill Participation %').toFixed(0)+'%) — isolated from team, target in side lanes',color:'var(--green)'});
    // Damage type skew
    var phys=colSum('Physical Damage'),mag=colSum('Magic Damage'),totalDmg=phys+mag||1;
    if(mag/totalDmg>0.85)patterns.push({icon:'🛡️',text:Math.round(mag/totalDmg*100)+'% magic damage — stack MR to neutralize',color:'var(--green)'});
    if(phys/totalDmg>0.85)patterns.push({icon:'🛡️',text:Math.round(phys/totalDmg*100)+'% physical damage — stack armor to neutralize',color:'var(--green)'});

    if(patterns.length){
      patterns.forEach(function(pt){
        h+='<div style="display:flex;align-items:flex-start;gap:8px;padding:5px 0;border-bottom:1px solid #ffffff04;font-family:\'Share Tech Mono\',monospace;font-size:10px">';
        h+='<span>'+pt.icon+'</span><span style="color:'+pt.color+'">'+pt.text+'</span></div>';
      });
    } else {
      h+='<div style="color:var(--dim);font-size:10px">No major exploitable weaknesses detected — well-rounded player</div>';
    }

    h+='</div>';
    h+='</div></div>'; // close grid + card
  }

  // === CARD 11: SCOUTING ASSESSMENT ===
  h+='<div class="scout-card" style="grid-column:1/-1"><div class="scout-card-title">Assessment</div>';
  h+='<div class="scout-metrics">';
  if(consist){
    h+='<div class="scout-metric"><div class="scout-metric-val" style="color:'+consist.color+'">'+consist.score+'</div><div class="scout-metric-label">CONSISTENCY</div><div class="scout-metric-sub" style="color:'+consist.color+'">'+consist.label+'</div></div>';
  }
  if(form){
    h+='<div class="scout-metric"><div class="scout-metric-val" style="color:'+form.color+'">'+form.icon+'</div><div class="scout-metric-label">FORM</div><div class="scout-metric-sub" style="color:'+form.color+'">'+form.label+'</div><div class="form-bar">';
    form.dots.forEach(function(w){h+='<div class="form-dot" style="background:'+(w?'var(--green)':'var(--pink)')+'"></div>'});
    h+='</div></div>';
  }
  // Strengths/Weaknesses
  var strengths=[],weaknesses=[];
  [{key:'kda',name:'KDA'},{key:'winRate',name:'Win Rate'},{key:'killsPerGame',name:'Kills'},{key:'deathsPerGame',name:'Deaths',inv:true},{key:'csPerMin',name:'CS/Min'},{key:'damagePerMin',name:'Damage'},{key:'visionPerMin',name:'Vision'},{key:'goldPerMin',name:'Gold'}].forEach(function(ch){
    var pc=pctOf(ch.key,ch.inv);
    if(pc>=0.8)strengths.push(ch.name);
    if(pc<=0.2)weaknesses.push(ch.name);
  });
  h+='<div class="scout-metric" style="flex:2"><div class="scout-metric-label" style="margin-bottom:6px">STRENGTHS</div>';
  h+=strengths.length?strengths.map(function(s){return'<span class="playstyle-tag" style="color:var(--green);background:#22c55e12;border-color:#22c55e40">✅ '+s+'</span>'}).join(' '):'<span style="color:var(--dim);font-size:10px">None above 80th percentile</span>';
  h+='<div class="scout-metric-label" style="margin-top:8px;margin-bottom:6px">WEAKNESSES</div>';
  h+=weaknesses.length?weaknesses.map(function(s){return'<span class="playstyle-tag" style="color:var(--pink);background:#ef444412;border-color:#ef444440">⚠️ '+s+'</span>'}).join(' '):'<span style="color:var(--dim);font-size:10px">None below 20th percentile</span>';
  h+='</div></div></div>';

  h+='</div>'; // close scout-grid

  h+='<div style="text-align:center;padding:20px 0 10px;font-family:\'Orbitron\',sans-serif;font-size:10px;letter-spacing:3px;color:var(--pink);opacity:.7">⚠️ IF YOU ARE JUST ASS AT THE GAME AND LOSE WITH THIS HELP I AM NOT RESPONSIBLE ⚠️</div>';

  el.innerHTML=h;
  el.classList.add('active');
}

// === EXPORT: FULL CLIPBOARD REPORT ===
function copyScoutReportFull(playerName){
  var report=generateScoutReport(playerName);
  // Enhance with laning data
  var rows=getFilteredRows();
  var pRows=rows.filter(function(r){var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];return n===playerName});
  function colAvg(col){var v=pRows.map(function(r){return parseFloat(r[col])||0});return v.length?v.reduce(function(s,x){return s+x},0)/v.length:0}
  var laning='\n🏰 LANING PHASE\n';
  laning+='   CS@10: '+colAvg('CS@10').toFixed(0)+' | CS@15: '+colAvg('CS@15').toFixed(0)+'\n';
  laning+='   Gold@10: '+Math.round(colAvg('Gold@10'))+' | Gold@15: '+Math.round(colAvg('Gold@15'))+'\n';
  laning+='   Lvl 6 Timing: '+colAvg('Level 6 Timing (min)').toFixed(1)+'min\n';
  laning+='   CS Adv: +'+colAvg('Max CS Advantage on Lane Opponent').toFixed(1)+' | Lvl Lead: +'+colAvg('Max Level Lead on Lane Opponent').toFixed(1)+'\n';
  laning+='   Solo Kills/Game: '+colAvg('Solo Kills').toFixed(1)+'\n';
  report=report.replace('═══════════════════════',laning+'═══════════════════════');
  navigator.clipboard.writeText(report).then(function(){showScoutToast('📋 FULL SCOUTING REPORT COPIED')});
}

// === EXPORT: CSV ===
function exportScoutCSV(playerName){
  var rows=getFilteredRows();
  var pRows=rows.filter(function(r){var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];return n===playerName});
  if(!pRows.length)return;
  var headers=Object.keys(pRows[0]);
  var csv=headers.join(',')+'\n';
  pRows.forEach(function(r){
    csv+=headers.map(function(h){var v=String(r[h]||'').replace(/,/g,';').replace(/"/g,'""');return'"'+v+'"'}).join(',')+'\n';
  });
  var blob=new Blob([csv],{type:'text/csv'});
  var url=URL.createObjectURL(blob);
  var a=document.createElement('a');a.href=url;a.download=playerName.replace(/[^a-zA-Z0-9]/g,'_')+'_scouting.csv';a.click();
  URL.revokeObjectURL(url);
  showScoutToast('💾 CSV DOWNLOADED: '+playerName);
}

// === EXPORT: DISCORD WEBHOOK EMBED ===
function shareScoutDiscord(playerName){
  var p=PD.find(function(x){return x.player===playerName});if(!p)return;
  var c=TC[p.team]||'#6366f1';
  var rl=ROLE_MAP[p.mainRole]||p.mainRole;
  var rows=getFilteredRows();
  var pRows=rows.filter(function(r){var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];return n===playerName});
  function colAvg(col){var v=pRows.map(function(r){return parseFloat(r[col])||0});return v.length?v.reduce(function(s,x){return s+x},0)/v.length:0}
  var tags=getPlaystyleTags(playerName,rows);
  var consist=getConsistency(playerName,rows);
  var form=getFormRating(playerName,rows);
  var tr=getTeamRelativeStats(playerName,rows);

  // Build Discord embed JSON
  var embed={
    embeds:[{
      color:parseInt(c.replace('#',''),16),
      author:{name:'🔍 SCOUTING REPORT'},
      title:playerName+' — '+p.team,
      description:'**'+rl+'** · '+p.games+' Games · '+p.winRate+'% WR'+(tags.length?'\n'+tags.map(function(t){return t.icon+' '+t.text}).join(' · '):''),
      fields:[
        {name:'📊 Core Stats',value:'**KDA:** '+p.kda+' | **K/D/A:** '+p.killsPerGame+'/'+p.deathsPerGame+'/'+p.assistsPerGame+'\n**Solo Kills/G:** '+colAvg('Solo Kills').toFixed(1)+' | **KP:** '+colAvg('Kill Participation %').toFixed(1)+'%',inline:false},
        {name:'💥 Damage',value:'**DMG/Min:** '+Math.round(p.damagePerMin)+'\n**DMG Share:** '+colAvg('Damage Share %').toFixed(1)+'%\n**DMG/Gold:** '+colAvg('Damage Per Gold').toFixed(2),inline:true},
        {name:'💰 Economy',value:'**Gold/Min:** '+p.goldPerMin+'\n**CS/Min:** '+p.csPerMin+'\n**Gold Share:** '+colAvg('Gold Share %').toFixed(1)+'%',inline:true},
        {name:'👁 Vision',value:'**Vis/Min:** '+p.visionPerMin+'\n**Wards/G:** '+colAvg('Wards Placed').toFixed(1)+'\n**CW/G:** '+colAvg('Control Wards Bought').toFixed(1),inline:true},
        {name:'🏰 Laning',value:'**CS@10:** '+colAvg('CS@10').toFixed(0)+' | **CS@15:** '+colAvg('CS@15').toFixed(0)+'\n**Gold@10:** '+Math.round(colAvg('Gold@10'))+' | **Gold@15:** '+Math.round(colAvg('Gold@15'))+'\n**Lvl 6:** '+colAvg('Level 6 Timing (min)').toFixed(1)+'min | **CS Adv:** +'+colAvg('Max CS Advantage on Lane Opponent').toFixed(1),inline:false},
      ],
      thumbnail:{url:'https://ddragon.leagueoflegends.com/cdn/14.24.1/img/champion/'+((p.champData&&p.champData.length?p.champData.sort(function(a,b){return(b.win?1:0)-(a.win?1:0)})[0].champ:'Aatrox').replace(/[^a-zA-Z]/g,''))+'.png'}
    }]
  };

  if(consist)embed.embeds[0].fields.push({name:'📏 Consistency',value:consist.score+'/100 ('+consist.label+')',inline:true});
  if(form)embed.embeds[0].fields.push({name:'📈 Form',value:form.icon+' '+form.label+'\nLast 5: '+form.dots.map(function(w){return w?'**W**':'L'}).join(' '),inline:true});

  // Copy as JSON for pasting into webhook tester or bot
  var jsonStr=JSON.stringify(embed,null,2);
  navigator.clipboard.writeText(jsonStr).then(function(){showScoutToast('🎮 DISCORD EMBED JSON COPIED — Paste into webhook or bot')});
}

function showScoutToast(msg){
  var toast=document.getElementById('scoutToast');
  if(!toast){toast=document.createElement('div');toast.id='scoutToast';toast.className='scout-toast';document.body.appendChild(toast)}
  toast.textContent=msg;toast.classList.add('show');
  setTimeout(function(){toast.classList.remove('show')},2500);
}

// ════════════════════════════════════════
// SHEET CONFIG SYSTEM (reads from Google Sheet "Config" tab)
// ════════════════════════════════════════

const DEFAULT_CONFIG={
  leagueName:'FRANCHISE PREMIER LEAGUE',
  subtitle:'PLAYER PERFORMANCE DASHBOARD',
  seasonLabel:'Season 3 // Official Stats',
  creditLine:'Stats compiled by Drib x Lizzo Mukkbang',
  footerText:'FRANCHISE PREMIER LEAGUE — POWERED BY RIOT API — LIVE FROM GOOGLE SHEETS',
  colorPrimary:'#00f0ff',
  colorSecondary:'#ff2d7b',
  colorAccent:'#a855f7',
  colorBg:'#06060c',
  logoUrl:'',
  tabs:[
    {id:'leaderboard',name:'Leaderboard',enabled:true},
    {id:'teams',name:'Teams',enabled:true},
    {id:'champions',name:'Champions',enabled:true},
    {id:'records',name:'Records',enabled:true},
    {id:'mvp',name:'MVP',enabled:true},
    {id:'power',name:'Power Rankings',enabled:true},
    {id:'timeline',name:'📅 Timeline',enabled:true},
    {id:'scouting',name:'🔍 Scouting',enabled:true},
    {id:'lookup',name:'🔍 Player Lookup',enabled:true},
  ],
  teamColors:{},
  minGamesDefault:5,
};

let adminConfig=JSON.parse(JSON.stringify(DEFAULT_CONFIG));

async function loadSheetConfig(){
  try{
    const sid=SHEET_ID;
    const rows=await new Promise(function(resolve,reject){
      const cb='_gcfg_'+Math.random().toString(36).slice(2);
      const url='https://docs.google.com/spreadsheets/d/'+sid+'/gviz/tq?tqx=responseHandler:'+cb+'&sheet=Config&headers=1';
      const timeout=setTimeout(function(){delete window[cb];reject(new Error('Config request timed out'))},5000);
      window[cb]=function(r){clearTimeout(timeout);delete window[cb];document.body.removeChild(s);try{
        if(!r.table||!r.table.cols){reject(new Error('No Config table'));return}
        const cols=r.table.cols.map(function(c){return c.label||c.id});
        const rows=r.table.rows.map(function(row){var o={};row.c.forEach(function(cell,i){o[cols[i]]=cell?(cell.v!==null&&cell.v!==undefined?String(cell.v):''):''});return o});
        resolve(rows)}catch(e){reject(e)}};
      var s=document.createElement('script');s.src=url;
      s.onerror=function(){clearTimeout(timeout);delete window[cb];reject(new Error('Config tab not found'))};
      document.body.appendChild(s);
    });
    var cfg={};
    rows.forEach(function(r){
      var keys=Object.keys(r);
      var key='',val='';
      if(r['Key']!==undefined){key=r['Key'];val=r['Value']||''}
      else if(r['key']!==undefined){key=r['key'];val=r['value']||''}
      else if(keys.length>=2){key=r[keys[0]]||'';val=r[keys[1]]||''}
      if(key.trim()&&key.trim()!=='Key'&&key.trim()!=='key'){cfg[key.trim()]=val.trim()}
    });
    console.log('Config from sheet:',cfg);
    if(cfg.leagueName)adminConfig.leagueName=esc(cfg.leagueName);
    if(cfg.subtitle)adminConfig.subtitle=esc(cfg.subtitle);
    if(cfg.seasonLabel)adminConfig.seasonLabel=esc(cfg.seasonLabel);
    if(cfg.creditLine)adminConfig.creditLine=esc(cfg.creditLine);
    if(cfg.footerText)adminConfig.footerText=esc(cfg.footerText);
    if(cfg.colorPrimary&&/^#[0-9a-fA-F]{3,8}$/.test(cfg.colorPrimary))adminConfig.colorPrimary=cfg.colorPrimary;
    if(cfg.colorSecondary&&/^#[0-9a-fA-F]{3,8}$/.test(cfg.colorSecondary))adminConfig.colorSecondary=cfg.colorSecondary;
    if(cfg.colorAccent&&/^#[0-9a-fA-F]{3,8}$/.test(cfg.colorAccent))adminConfig.colorAccent=cfg.colorAccent;
    if(cfg.colorBg&&/^#[0-9a-fA-F]{3,8}$/.test(cfg.colorBg))adminConfig.colorBg=cfg.colorBg;
    if(cfg.logoUrl!==undefined&&(cfg.logoUrl===''||/^https?:\/\//i.test(cfg.logoUrl)))adminConfig.logoUrl=cfg.logoUrl;
    if(cfg.minGamesDefault)adminConfig.minGamesDefault=parseInt(cfg.minGamesDefault)||5;
    var tabMap={tabLeaderboard:'leaderboard',tabTeams:'teams',tabChampions:'champions',tabRecords:'records',tabMvp:'mvp',tabPower:'power',tabTimeline:'timeline',tabScouting:'scouting',tabLookup:'lookup'};
    for(var cfgKey in tabMap){
      if(cfg[cfgKey]!==undefined){
        var v=String(cfg[cfgKey]).toLowerCase();
        var tab=adminConfig.tabs.find(function(t){return t.id===tabMap[cfgKey]});
        if(tab)tab.enabled=(v==='true'||v==='yes'||v==='1');
      }
    }
    if(cfg.tabOrder){
      var order=cfg.tabOrder.split(',').map(function(s){return s.trim()});
      var reordered=[];
      order.forEach(function(id){var tab=adminConfig.tabs.find(function(t){return t.id===id});if(tab)reordered.push(tab)});
      adminConfig.tabs.forEach(function(t){if(!reordered.find(function(r){return r.id===t.id}))reordered.push(t)});
      adminConfig.tabs=reordered;
    }
    for(var k in cfg){if(k.indexOf('teamColor_')===0){adminConfig.teamColors[k.replace('teamColor_','')]=cfg[k]}}
    console.log('Sheet config applied:',adminConfig.leagueName,adminConfig.colorPrimary);
  }catch(e){
    console.log('No Config tab, using defaults:',e.message);
  }
}

function applyConfig(){
  var c=adminConfig;
  try{
    document.title=c.leagueName+' — Stats Dashboard';
    var h1=document.querySelector('.hdr h1');if(h1){h1.textContent=c.leagueName;h1.dataset.text=c.leagueName}
    var sub=document.querySelector('.hdr .sub');if(sub)sub.textContent=c.subtitle;
    var badge=document.querySelector('.badge');if(badge)badge.textContent=c.seasonLabel;
    var cred=document.querySelector('.hdr .cred');if(cred)cred.textContent=c.creditLine;
    var ftr=document.querySelector('.ftr');if(ftr)ftr.textContent=c.footerText;
    var root=document.documentElement.style;
    if(c.colorPrimary){root.setProperty('--cyan',c.colorPrimary);root.setProperty('--cyan-dim',c.colorPrimary+'25');root.setProperty('--cyan-glow',c.colorPrimary+'40')}
    if(c.colorSecondary){root.setProperty('--pink',c.colorSecondary);root.setProperty('--pink-glow',c.colorSecondary+'40')}
    if(c.colorAccent){root.setProperty('--purple',c.colorAccent);root.setProperty('--purple-glow',c.colorAccent+'40')}
    if(c.colorBg&&c.colorBg!=='#06060c'){root.setProperty('--bg',c.colorBg)}
    var logoEl=document.getElementById('customLogo');
    if(c.logoUrl){
      if(!logoEl){logoEl=document.createElement('img');logoEl.id='customLogo';logoEl.style.cssText='max-height:50px;margin-bottom:8px;display:block;margin-left:auto;margin-right:auto';document.querySelector('.hdr').insertBefore(logoEl,document.querySelector('.badge'))}
      logoEl.src=c.logoUrl;
    }else if(logoEl){logoEl.remove()}
    var nav=document.getElementById('tabNav');
    var existing=[].slice.call(nav.querySelectorAll('.tab-btn'));
    nav.innerHTML='';
    c.tabs.forEach(function(t){
      if(!t.enabled)return;
      var btn=existing.find(function(b){return b.dataset.tab===t.id});
      if(btn){btn.textContent=t.name;nav.appendChild(btn)}
      else{var nb=document.createElement('button');nb.className='tab-btn';nb.dataset.tab=t.id;nb.textContent=t.name;nb.addEventListener('click',function(){switchTab(t.id,true)});nav.appendChild(nb)}
    });
    c.tabs.forEach(function(t){
      var pg=document.getElementById('pg-'+t.id);
      if(pg&&!t.enabled)pg.style.display='none';
      if(pg&&t.enabled)pg.style.removeProperty('display');
    });
    if(c.teamColors&&Object.keys(c.teamColors).length){
      for(var team in c.teamColors){TC[team]=c.teamColors[team]}
    }
    var mgSel=document.getElementById('minGSel');
    if(mgSel){
      var opt=[].slice.call(mgSel.options).find(function(o){return o.value===String(c.minGamesDefault)});
      if(opt)mgSel.value=c.minGamesDefault;
    }
  }catch(err){console.error('applyConfig error:',err)}
}

// ════════════════════════════════════════
// ACHIEVEMENT BADGES
// ════════════════════════════════════════
function getAchievements(player,allRows){
  var badges=[];
  var pRows=allRows.filter(function(r){var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];return n===player});
  if(!pRows.length)return badges;
  var maxKills=0,has0Death=false,maxDmg=0,maxCS=0,maxVision=0,pentaTotal=0,quadraTotal=0,tripleTotal=0,fbCount=0;
  pRows.forEach(function(r){
    var k=parseFloat(r['Kills'])||0,d=parseFloat(r['Deaths'])||0;
    var dmg=parseFloat(r['Total Damage to Champions'])||0;
    var cs=parseFloat(r['CS'])||0;
    var vis=parseFloat(r['Vision Score'])||0;
    if(k>maxKills)maxKills=k;
    if(d===0&&r['Win']==='Win')has0Death=true;
    if(dmg>maxDmg)maxDmg=dmg;if(cs>maxCS)maxCS=cs;if(vis>maxVision)maxVision=vis;
    pentaTotal+=(parseFloat(r['Penta Kills'])||0);
    quadraTotal+=(parseFloat(r['Quadra Kills'])||0);
    tripleTotal+=(parseFloat(r['Triple Kills'])||0);
    var fb=r['First Blood']||'';if(fb==='True'||fb==='true'||fb==='1')fbCount++;
  });
  var p=PD.find(function(x){return x.player===player});if(!p)return badges;
  if(pentaTotal>0)badges.push({icon:'\ud83d\udc8e',text:'PENTAKILL CLUB',color:'#b9f2ff',bg:'#b9f2ff15',tier:5});
  if(quadraTotal>0)badges.push({icon:'\u26a1',text:'QUADRA STRIKER',color:'#fbbf24',bg:'#fbbf2415',tier:4});
  if(tripleTotal>=3)badges.push({icon:'\ud83d\udd31',text:'TRIPLE THREAT',color:'#a855f7',bg:'#a855f715',tier:3});
  if(maxKills>=20)badges.push({icon:'\ud83d\udd25',text:'20+ KILL GAME',color:'#ef4444',bg:'#ef444415',tier:4});
  else if(maxKills>=15)badges.push({icon:'\ud83d\udd25',text:'15+ KILL GAME',color:'#f97316',bg:'#f9731615',tier:3});
  if(has0Death)badges.push({icon:'\ud83d\udee1\ufe0f',text:'UNKILLABLE',color:'#22c55e',bg:'#22c55e15',tier:4});
  if(p.kda>=5)badges.push({icon:'\ud83d\udc51',text:'KDA KING (5+)',color:'#ffd700',bg:'#ffd70015',tier:4});
  else if(p.kda>=4)badges.push({icon:'\u2b50',text:'KDA ELITE (4+)',color:'#fbbf24',bg:'#fbbf2415',tier:3});
  if(p.winRate>=70&&p.games>=5)badges.push({icon:'\ud83c\udfc6',text:'DOMINANT (70%+ WR)',color:'#22c55e',bg:'#22c55e15',tier:5});
  else if(p.winRate>=60&&p.games>=5)badges.push({icon:'\ud83d\udcc8',text:'CLUTCH (60%+ WR)',color:'#34d399',bg:'#34d39915',tier:3});
  if(maxDmg>=40000)badges.push({icon:'\ud83d\udc80',text:'DAMAGE DEMON (40K+)',color:'#ef4444',bg:'#ef444415',tier:4});
  if(maxVision>=80)badges.push({icon:'\ud83d\udc41\ufe0f',text:'VISION KING',color:'#3b82f6',bg:'#3b82f615',tier:3});
  if(maxCS>=300)badges.push({icon:'\ud83c\udf3e',text:'CS MACHINE (300+)',color:'#a3e635',bg:'#a3e63515',tier:3});
  if(fbCount>=5)badges.push({icon:'\ud83e\ude78',text:'FIRST BLOOD HUNTER',color:'#dc2626',bg:'#dc262615',tier:3});
  if(p.games>=30)badges.push({icon:'\ud83c\udf96\ufe0f',text:'VETERAN (30+ GAMES)',color:'#6366f1',bg:'#6366f115',tier:2});
  else if(p.games>=20)badges.push({icon:'\u2694\ufe0f',text:'SEASONED (20+ GAMES)',color:'#818cf8',bg:'#818cf815',tier:2});
  var uniqueChamps=new Set(pRows.map(function(r){return r['Champion']})).size;
  if(uniqueChamps>=15)badges.push({icon:'\ud83c\udfad',text:'FLEX MASTER (15+ CHAMPS)',color:'#c084fc',bg:'#c084fc15',tier:3});
  var champCounts={};(p.champData||[]).forEach(function(x){champCounts[x.champ]=(champCounts[x.champ]||0)+1});
  var maxChampGames=Math.max.apply(null,Object.values(champCounts).concat([0]));
  if(maxChampGames>=15)badges.push({icon:'\ud83d\udc9c',text:'ONE TRICK',color:'#e879f9',bg:'#e879f915',tier:3});
  badges.sort(function(a,b){return b.tier-a.tier});
  return badges;
}
function renderBadgesHTML(badges){
  if(!badges.length)return'';
  return'<div class="ach-row">'+badges.map(function(b,i){
    return'<div class="ach-badge" style="color:'+b.color+';border-color:'+b.color+'40;background:'+b.bg+';animation-delay:'+i*0.08+'s"><span class="ach-icon">'+b.icon+'</span>'+b.text+'</div>';
  }).join('')+'</div>';
}

// ════════════════════════════════════════
// CHAMPION MASTERY BORDERS
// ════════════════════════════════════════
function getMasteryClass(games){
  if(games>=15)return'mastery-diamond';if(games>=10)return'mastery-gold';if(games>=5)return'mastery-silver';if(games>=3)return'mastery-bronze';return'';
}
function getMasteryTag(games){
  if(games>=15)return'<span class="mastery-tag" style="background:#b9f2ff;color:#000">OTP</span>';
  if(games>=10)return'<span class="mastery-tag" style="background:#ffd700;color:#000">MAIN</span>';
  return'';
}

// ════════════════════════════════════════
// HEAD-TO-HEAD
// ════════════════════════════════════════
function findH2H(player1,player2,allRows){
  var matchIds={};
  allRows.forEach(function(r){var mid=r['Match ID']||'';if(!mid)return;if(!matchIds[mid])matchIds[mid]=[];matchIds[mid].push(r)});
  var games=[];
  for(var mid in matchIds){
    var rows=matchIds[mid],p1r=null,p2r=null;
    rows.forEach(function(r){var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];if(n===player1)p1r=r;if(n===player2)p2r=r});
    if(p1r&&p2r){
      var t1=(p1r['Teams']||'').trim(),t2=(p2r['Teams']||'').trim();
      if(t1!==t2)games.push({p1:{win:p1r['Win']==='Win',kills:parseFloat(p1r['Kills'])||0,deaths:parseFloat(p1r['Deaths'])||0,assists:parseFloat(p1r['Assists'])||0,dmg:parseFloat(p1r['Total Damage to Champions'])||0},p2:{win:p2r['Win']==='Win',kills:parseFloat(p2r['Kills'])||0,deaths:parseFloat(p2r['Deaths'])||0,assists:parseFloat(p2r['Assists'])||0,dmg:parseFloat(p2r['Total Damage to Champions'])||0}});
    }
  }
  return games;
}
function renderH2H(player1,player2,c1,c2){
  var rows=getFilteredRows();var games=findH2H(player1,player2,rows);
  if(!games.length)return'';
  var w1=0,w2=0,k1=0,k2=0,d1=0,d2=0,a1=0,a2=0,dm1=0,dm2=0;
  games.forEach(function(g){if(g.p1.win)w1++;if(g.p2.win)w2++;k1+=g.p1.kills;k2+=g.p2.kills;d1+=g.p1.deaths;d2+=g.p2.deaths;a1+=g.p1.assists;a2+=g.p2.assists;dm1+=g.p1.dmg;dm2+=g.p2.dmg});
  var kda1=((k1+a1)/Math.max(d1,1)).toFixed(2),kda2=((k2+a2)/Math.max(d2,1)).toFixed(2);
  function fmtH(v){return typeof v==='number'&&v>=1000?Math.round(v/1000)+'K':v}
  function sr(l,v1,v2,inv){var w=inv?(v1<v2?'left':'right'):(v1>v2?'left':'right');return'<div class="val left'+(w==='left'?' winner':'')+'" style="color:'+(w==='left'?c1:'var(--text)')+'">'+fmtH(v1)+'</div><div class="label">'+l+'</div><div class="val right'+(w==='right'?' winner':'')+'" style="color:'+(w==='right'?c2:'var(--text)')+'">'+fmtH(v2)+'</div>'}
  return'<div class="h2h-card"><div class="h2h-header">\u2694 HEAD TO HEAD \xb7 '+games.length+' GAME'+(games.length>1?'S':'')+'</div><div class="h2h-vs"><div class="h2h-player"><div class="name" style="color:'+c1+'">'+player1+'</div><div class="score" style="color:'+(w1>=w2?c1:'var(--dim)')+'">'+w1+'</div></div><div class="h2h-divider">VS</div><div class="h2h-player"><div class="name" style="color:'+c2+'">'+player2+'</div><div class="score" style="color:'+(w2>=w1?c2:'var(--dim)')+'">'+w2+'</div></div></div><div class="h2h-stats">'+sr('WINS',w1,w2)+sr('KDA',kda1,kda2)+sr('KILLS',k1,k2)+sr('DEATHS',d1,d2,true)+sr('ASSISTS',a1,a2)+sr('DAMAGE',dm1,dm2)+'</div></div>';
}

// ════════════════════════════════════════
// PLAYER OF THE WEEK SPOTLIGHT
// ════════════════════════════════════════
function renderPOTW(){
  var banner=document.getElementById('potwBanner');if(!banner)return;
  if(!RAW||!RAW.length){banner.innerHTML='';return}
  // Find the most recent game night
  var dates={};
  RAW.forEach(function(r){
    var d=r['Date']||'';if(!d)return;
    if(!dates[d])dates[d]=[];
    dates[d].push(r);
  });
  var sortedDates=Object.keys(dates).sort();
  if(!sortedDates.length){banner.innerHTML='';return}
  var latestDate=sortedDates[sortedDates.length-1];
  var latestRows=dates[latestDate];
  // Aggregate stats for that night
  var players={};
  latestRows.forEach(function(r){
    var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];if(!n)return;
    if(!players[n])players[n]={kills:0,deaths:0,assists:0,dmg:0,games:0,wins:0,team:'',champ:''};
    var p=players[n];
    p.kills+=parseFloat(r['Kills'])||0;
    p.deaths+=parseFloat(r['Deaths'])||0;
    p.assists+=parseFloat(r['Assists'])||0;
    p.dmg+=parseFloat(r['Total Damage to Champions'])||0;
    p.games++;
    if(r['Win']==='Win')p.wins++;
    p.team=(r['Teams']||'').trim();
    p.champ=r['Champion']||'';
  });
  // Score each player: KDA*2 + win%*3 + dmg_normalized
  var best=null,bestScore=-1,bestName='';
  for(var name in players){
    var pl=players[name];
    var kda=(pl.kills+pl.assists)/Math.max(pl.deaths,1);
    var wr=pl.wins/pl.games;
    var score=kda*2+wr*3+(pl.dmg/pl.games/1000);
    if(score>bestScore){bestScore=score;best=pl;bestName=name}
  }
  if(!best||!bestName){banner.innerHTML='';return}
  var c=TC[best.team]||'var(--cyan)';
  var kda=((best.kills+best.assists)/Math.max(best.deaths,1)).toFixed(2);
  var wr=Math.round(best.wins/best.games*100);
  var avgDmg=Math.round(best.dmg/best.games).toLocaleString();
  var dateStr=formatDate(parseDate(latestDate));
  var champKey=best.champ.replace(/[^a-zA-Z]/g,'');
  var imgSrc=DD_BASE+(CHAMP_KEY_OVERRIDES[best.champ]||champKey)+'.png';
  banner.innerHTML='<div class="potw"><div class="potw-label"><span class="star">\u2605</span> PLAYER OF THE WEEK <span class="star">\u2605</span></div><div class="potw-main"><img class="potw-champ" src="'+imgSrc+'" alt="'+best.champ+'" onerror="this.style.display=\'none\'"><div class="potw-info"><div class="potw-name" style="color:'+c+'" onclick="openProfile(\''+bestName.replace(/'/g,"\\'")+'\')">' +bestName+'</div><div class="potw-team">'+best.team+' \xb7 '+best.champ+' \xb7 '+best.games+' GAME'+(best.games>1?'S':'')+'</div></div><div class="potw-stats"><div class="potw-stat"><div class="potw-stat-val" style="color:'+c+'">'+kda+'</div><div class="potw-stat-lbl">KDA</div></div><div class="potw-stat"><div class="potw-stat-val" style="color:'+(wr>=50?'var(--green)':'var(--pink)')+'">'+wr+'%</div><div class="potw-stat-lbl">WIN RATE</div></div><div class="potw-stat"><div class="potw-stat-val" style="color:'+c+'">'+best.kills+'/'+best.deaths+'/'+best.assists+'</div><div class="potw-stat-lbl">K/D/A</div></div><div class="potw-stat"><div class="potw-stat-val" style="color:'+c+'">'+avgDmg+'</div><div class="potw-stat-lbl">DMG/GAME</div></div></div><div class="potw-date">'+dateStr+'</div></div></div>';
}

// ════════════════════════════════════════
// SCOUTING: TEAM-RELATIVE STATS
// ════════════════════════════════════════
function getTeamRelativeStats(player,allRows){
  // Group rows by Match ID
  var matches={};
  allRows.forEach(function(r){
    var mid=r['Match ID']||'';if(!mid)return;
    if(!matches[mid])matches[mid]=[];
    matches[mid].push(r);
  });

  var dmgShares=[],goldShares=[],kps=[],deathShares=[];
  var laningCS=[],laningGold=[]; // for future laning columns

  for(var mid in matches){
    var rows=matches[mid];
    var playerRow=null;
    var teamRows=[];
    rows.forEach(function(r){
      var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];
      if(n===player)playerRow=r;
    });
    if(!playerRow)continue;
    var pTeam=(playerRow['Teams']||'').trim();
    rows.forEach(function(r){if((r['Teams']||'').trim()===pTeam)teamRows.push(r)});
    if(teamRows.length<2)continue;

    // Damage share
    var teamDmg=teamRows.reduce(function(s,r){return s+(parseFloat(r['Total Damage to Champions'])||0)},0);
    var pDmg=parseFloat(playerRow['Total Damage to Champions'])||0;
    if(teamDmg>0)dmgShares.push(pDmg/teamDmg*100);

    // Gold share
    var teamGold=teamRows.reduce(function(s,r){return s+(parseFloat(r['Gold Earned'])||0)},0);
    var pGold=parseFloat(playerRow['Gold Earned'])||0;
    if(teamGold>0)goldShares.push(pGold/teamGold*100);

    // Kill participation
    var teamKills=teamRows.reduce(function(s,r){return s+(parseFloat(r['Kills'])||0)},0);
    var pK=parseFloat(playerRow['Kills'])||0;
    var pA=parseFloat(playerRow['Assists'])||0;
    if(teamKills>0)kps.push((pK+pA)/teamKills*100);

    // Death share
    var teamDeaths=teamRows.reduce(function(s,r){return s+(parseFloat(r['Deaths'])||0)},0);
    var pD=parseFloat(playerRow['Deaths'])||0;
    if(teamDeaths>0)deathShares.push(pD/teamDeaths*100);

    // Future: laning stats if columns exist
    if(playerRow['CS Diff at 10']!==undefined&&playerRow['CS Diff at 10']!==''){
      laningCS.push(parseFloat(playerRow['CS Diff at 10'])||0);
    }
    if(playerRow['Gold Diff at 10']!==undefined&&playerRow['Gold Diff at 10']!==''){
      laningGold.push(parseFloat(playerRow['Gold Diff at 10'])||0);
    }
  }

  function avg(arr){return arr.length?arr.reduce(function(s,v){return s+v},0)/arr.length:null}

  return{
    dmgShare:avg(dmgShares),
    goldShare:avg(goldShares),
    killParticipation:avg(kps),
    deathShare:avg(deathShares),
    csDiffAt10:avg(laningCS),
    goldDiffAt10:avg(laningGold),
    gamesAnalyzed:dmgShares.length
  };
}

function renderTeamRelativeHTML(stats,color){
  if(!stats||!stats.gamesAnalyzed)return'';
  var h='<div class="prof-section"><div class="prof-section-title">Team Impact (' +stats.gamesAnalyzed+' games analyzed)</div>';
  h+='<div class="scout-metrics">';

  // Damage %
  if(stats.dmgShare!==null){
    var dc=stats.dmgShare>=25?'var(--green)':stats.dmgShare<=15?'var(--pink)':color;
    h+='<div class="scout-metric"><div class="scout-metric-val" style="color:'+dc+'">'+stats.dmgShare.toFixed(1)+'%</div><div class="scout-metric-label">DMG SHARE</div><div class="scout-metric-sub" style="color:var(--dim)">'+(stats.dmgShare>=25?'High carry load':stats.dmgShare>=20?'Expected share':'Low damage output')+'</div></div>';
  }
  // Gold %
  if(stats.goldShare!==null){
    var gc=stats.goldShare>=24?'var(--gold)':color;
    h+='<div class="scout-metric"><div class="scout-metric-val" style="color:'+gc+'">'+stats.goldShare.toFixed(1)+'%</div><div class="scout-metric-label">GOLD SHARE</div><div class="scout-metric-sub" style="color:var(--dim)">'+(stats.goldShare>=24?'Resource heavy':stats.goldShare>=18?'Balanced':'Low econ')+'</div></div>';
  }
  // Kill Participation
  if(stats.killParticipation!==null){
    var kc=stats.killParticipation>=70?'var(--green)':stats.killParticipation<=50?'var(--pink)':color;
    h+='<div class="scout-metric"><div class="scout-metric-val" style="color:'+kc+'">'+stats.killParticipation.toFixed(1)+'%</div><div class="scout-metric-label">KILL PARTICIPATION</div><div class="scout-metric-sub" style="color:var(--dim)">'+(stats.killParticipation>=70?'Highly involved':stats.killParticipation>=55?'Average':'Often absent from fights')+'</div></div>';
  }
  // Death Share
  if(stats.deathShare!==null){
    var dsc=stats.deathShare<=15?'var(--green)':stats.deathShare>=30?'var(--pink)':color;
    h+='<div class="scout-metric"><div class="scout-metric-val" style="color:'+dsc+'">'+stats.deathShare.toFixed(1)+'%</div><div class="scout-metric-label">DEATH SHARE</div><div class="scout-metric-sub" style="color:var(--dim)">'+(stats.deathShare<=15?'Rarely caught out':stats.deathShare<=25?'Average deaths':'Frequent liability')+'</div></div>';
  }

  h+='</div>';

  // Laning stats if available
  if(stats.csDiffAt10!==null||stats.goldDiffAt10!==null){
    h+='<div class="scout-metrics" style="margin-top:8px">';
    if(stats.csDiffAt10!==null){
      var cc=stats.csDiffAt10>=5?'var(--green)':stats.csDiffAt10<=-5?'var(--pink)':color;
      h+='<div class="scout-metric"><div class="scout-metric-val" style="color:'+cc+'">'+(stats.csDiffAt10>=0?'+':'')+stats.csDiffAt10.toFixed(1)+'</div><div class="scout-metric-label">CS DIFF @ 10</div><div class="scout-metric-sub" style="color:var(--dim)">'+(stats.csDiffAt10>=5?'Lane dominant':stats.csDiffAt10<=-5?'Loses lane CS':'Even laner')+'</div></div>';
    }
    if(stats.goldDiffAt10!==null){
      var glc=stats.goldDiffAt10>=300?'var(--green)':stats.goldDiffAt10<=-300?'var(--pink)':color;
      h+='<div class="scout-metric"><div class="scout-metric-val" style="color:'+glc+'">'+(stats.goldDiffAt10>=0?'+':'')+Math.round(stats.goldDiffAt10)+'</div><div class="scout-metric-label">GOLD DIFF @ 10</div><div class="scout-metric-sub" style="color:var(--dim)">'+(stats.goldDiffAt10>=300?'Wins lane':stats.goldDiffAt10<=-300?'Behind early':'Even early')+'</div></div>';
    }
    h+='</div>';
  }

  h+='</div>';
  return h;
}
function getPlaystyleTags(player,allRows){
  var tags=[];
  var pRows=allRows.filter(function(r){var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];return n===player});
  if(!pRows.length)return tags;
  var p=PD.find(function(x){return x.player===player});if(!p||p.games<3)return tags;
  var all=PD.filter(function(x){return x.games>=3});
  if(!all.length)return tags;

  // Calculate percentiles
  function pct(key,inv){
    var sorted=[].concat(all).sort(function(a,b){return a[key]-b[key]});
    var idx=sorted.findIndex(function(x){return x.player===player});
    var pc=idx/(sorted.length-1||1);
    return inv?1-pc:pc;
  }

  // Kill-focused
  if(pct('killsPerGame')>=0.8)tags.push({icon:'\u2694\uFE0F',text:'AGGRESSIVE',color:'#ef4444',bg:'#ef444412',border:'#ef444440'});
  // Death-averse
  if(pct('deathsPerGame',true)>=0.8)tags.push({icon:'\uD83D\uDEE1\uFE0F',text:'SAFE PLAYER',color:'#22c55e',bg:'#22c55e12',border:'#22c55e40'});
  // Vision control
  if(pct('visionPerMin')>=0.75)tags.push({icon:'\uD83D\uDC41\uFE0F',text:'VISION CONTROL',color:'#3b82f6',bg:'#3b82f612',border:'#3b82f640'});
  // Farm heavy
  if(pct('csPerMin')>=0.8)tags.push({icon:'\uD83C\uDF3E',text:'FARM HEAVY',color:'#a3e635',bg:'#a3e63512',border:'#a3e63540'});
  // Damage dealer
  if(pct('damagePerMin')>=0.8)tags.push({icon:'\uD83D\uDCA5',text:'DAMAGE DEALER',color:'#f97316',bg:'#f9731612',border:'#f9731640'});
  // Team player (high assist ratio)
  var assistRatio=p.assistsPerGame/(p.killsPerGame+p.assistsPerGame+0.01);
  if(assistRatio>=0.65)tags.push({icon:'\uD83E\uDD1D',text:'TEAM PLAYER',color:'#8b5cf6',bg:'#8b5cf612',border:'#8b5cf640'});
  // Carry (high kill share + damage)
  if(pct('killsPerGame')>=0.7&&pct('damagePerMin')>=0.7)tags.push({icon:'\uD83D\uDC51',text:'CARRY THREAT',color:'#fbbf24',bg:'#fbbf2412',border:'#fbbf2440'});
  // Clutch (high WR)
  if(p.winRate>=65&&p.games>=5)tags.push({icon:'\uD83C\uDFAF',text:'CLUTCH FACTOR',color:'#22d3ee',bg:'#22d3ee12',border:'#22d3ee40'});
  // Feast or famine (high KDA variance — calculated in consistency)
  // Gold efficient
  if(pct('goldPerMin')>=0.8)tags.push({icon:'\uD83D\uDCB0',text:'GOLD EFFICIENT',color:'#fbbf24',bg:'#fbbf2412',border:'#fbbf2440'});

  return tags;
}

function renderPlaystyleHTML(tags){
  if(!tags.length)return'';
  return'<div class="playstyle-row">'+tags.map(function(t){
    return'<span class="playstyle-tag" style="color:'+t.color+';background:'+t.bg+';border-color:'+t.border+'">'+t.icon+' '+t.text+'</span>';
  }).join('')+'</div>';
}

// ════════════════════════════════════════
// SCOUTING: CONSISTENCY RATING
// ════════════════════════════════════════
function getConsistency(player,allRows){
  var pRows=allRows.filter(function(r){var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];return n===player});
  if(pRows.length<3)return null;
  var kdas=pRows.map(function(r){
    var k=parseFloat(r['Kills'])||0,d=parseFloat(r['Deaths'])||0,a=parseFloat(r['Assists'])||0;
    return(k+a)/Math.max(d,1);
  });
  var mean=kdas.reduce(function(s,v){return s+v},0)/kdas.length;
  var variance=kdas.reduce(function(s,v){return s+Math.pow(v-mean,2)},0)/kdas.length;
  var stddev=Math.sqrt(variance);
  var cv=stddev/Math.max(mean,0.01); // coefficient of variation
  // Score: lower CV = more consistent. Scale 0-100
  var score=Math.max(0,Math.min(100,Math.round((1-cv/2)*100)));
  var label=score>=80?'ROCK SOLID':score>=60?'RELIABLE':score>=40?'VARIABLE':'FEAST OR FAMINE';
  var color=score>=80?'#22c55e':score>=60?'#3b82f6':score>=40?'#fbbf24':'#ef4444';
  return{score:score,label:label,color:color,cv:cv.toFixed(2),stddev:stddev.toFixed(2),mean:mean.toFixed(2)};
}

// ════════════════════════════════════════
// SCOUTING: FORM RATING (RECENT TREND)
// ════════════════════════════════════════
function getFormRating(player,allRows){
  var pRows=allRows.filter(function(r){var n=r['Summoner Name']||'';if(NAME_MERGES[n])n=NAME_MERGES[n];return n===player});
  if(pRows.length<5)return null;
  // Sort by date
  pRows.sort(function(a,b){return(a['Date']||'').localeCompare(b['Date']||'')});
  var last5=pRows.slice(-5);
  var prev=pRows.slice(0,-5);
  if(!prev.length)prev=pRows.slice(0,Math.floor(pRows.length/2));

  function avgKDA(rows){
    var total=rows.reduce(function(s,r){
      var k=parseFloat(r['Kills'])||0,d=parseFloat(r['Deaths'])||0,a=parseFloat(r['Assists'])||0;
      return{k:s.k+k,d:s.d+d,a:s.a+a};
    },{k:0,d:0,a:0});
    return(total.k+total.a)/Math.max(total.d,1);
  }
  function avgWR(rows){
    var w=rows.filter(function(r){return r['Win']==='Win'}).length;
    return w/rows.length*100;
  }

  var recentKDA=avgKDA(last5),prevKDA=avgKDA(prev);
  var recentWR=avgWR(last5),prevWR=avgWR(prev);
  var kdaDiff=recentKDA-prevKDA;
  var wrDiff=recentWR-prevWR;

  // Form score based on recent vs historical
  var formScore=kdaDiff*10+wrDiff*0.5;
  var label=formScore>=10?'ON FIRE':formScore>=3?'TRENDING UP':formScore>=-3?'STABLE':formScore>=-10?'COOLING DOWN':'COLD STREAK';
  var icon=formScore>=10?'\uD83D\uDD25':formScore>=3?'\uD83D\uDCC8':formScore>=-3?'\u2796':formScore>=-10?'\uD83D\uDCC9':'\u2744\uFE0F';
  var color=formScore>=10?'#ef4444':formScore>=3?'#22c55e':formScore>=-3?'var(--dim)':formScore>=-10?'#3b82f6':'#60a5fa';

  // Win/loss dots for last 5
  var dots=last5.map(function(r){return r['Win']==='Win'});

  return{label:label,icon:icon,color:color,recentKDA:recentKDA.toFixed(2),prevKDA:prevKDA.toFixed(2),recentWR:Math.round(recentWR),dots:dots,kdaDiff:kdaDiff,formScore:formScore};
}

// ════════════════════════════════════════
// SCOUTING: EXPORT REPORT
// ════════════════════════════════════════
function generateScoutReport(playerName){
  var p=PD.find(function(x){return x.player===playerName});if(!p)return'';
  var rows=getFilteredRows();
  var c=getConsistency(playerName,rows);
  var f=getFormRating(playerName,rows);
  var tags=getPlaystyleTags(playerName,rows);
  var tr=getTeamRelativeStats(playerName,rows);
  var rl=ROLE_MAP[p.mainRole]||p.mainRole;

  // Top 3 champs
  var cm={};(p.champData||[]).forEach(function(x){if(!cm[x.champ])cm[x.champ]={g:0,w:0};cm[x.champ].g++;if(x.win)cm[x.champ].w++});
  var top3=Object.entries(cm).sort(function(a,b){return b[1].g-a[1].g}).slice(0,3).map(function(e){
    return e[0]+' ('+e[1].g+'g, '+Math.round(e[1].w/e[1].g*100)+'% WR)';
  });

  var lines=[];
  lines.push('═══ SCOUTING REPORT ═══');
  lines.push(playerName+' — '+p.team+' — '+rl);
  lines.push('');
  lines.push('📊 STATS ('+p.games+' games)');
  lines.push('   KDA: '+p.kda+' | WR: '+p.winRate+'% | K/G: '+p.killsPerGame+' | D/G: '+p.deathsPerGame);
  lines.push('   CS/Min: '+p.csPerMin+' | DMG/Min: '+Math.round(p.damagePerMin)+' | Gold/Min: '+p.goldPerMin);
  lines.push('');
  if(tr&&tr.gamesAnalyzed){
    lines.push('📈 TEAM IMPACT ('+tr.gamesAnalyzed+' games)');
    if(tr.dmgShare!==null)lines.push('   DMG Share: '+tr.dmgShare.toFixed(1)+'%'+(tr.dmgShare>=25?' (high carry load)':tr.dmgShare<=15?' (low output)':''));
    if(tr.goldShare!==null)lines.push('   Gold Share: '+tr.goldShare.toFixed(1)+'%'+(tr.goldShare>=24?' (resource heavy)':tr.goldShare<=16?' (low econ)':''));
    if(tr.killParticipation!==null)lines.push('   Kill Participation: '+tr.killParticipation.toFixed(1)+'%'+(tr.killParticipation>=70?' (highly involved)':tr.killParticipation<=50?' (often absent)':''));
    if(tr.deathShare!==null)lines.push('   Death Share: '+tr.deathShare.toFixed(1)+'%'+(tr.deathShare>=30?' ⚠ frequent liability':tr.deathShare<=15?' ✅ rarely caught out':''));
    if(tr.csDiffAt10!==null)lines.push('   CS Diff @10: '+(tr.csDiffAt10>=0?'+':'')+tr.csDiffAt10.toFixed(1));
    if(tr.goldDiffAt10!==null)lines.push('   Gold Diff @10: '+(tr.goldDiffAt10>=0?'+':'')+Math.round(tr.goldDiffAt10));
    lines.push('');
  }
  lines.push('🎮 TOP CHAMPIONS');
  top3.forEach(function(ch){lines.push('   '+ch)});
  lines.push('');
  if(tags.length){
    lines.push('🏷️ PLAYSTYLE');
    lines.push('   '+tags.map(function(t){return t.text}).join(' · '));
    lines.push('');
  }
  if(c){
    lines.push('📏 CONSISTENCY: '+c.score+'/100 ('+c.label+')');
    lines.push('   Avg KDA: '+c.mean+' | Std Dev: '+c.stddev);
    lines.push('');
  }
  if(f){
    lines.push('🔥 FORM: '+f.icon+' '+f.label);
    lines.push('   Last 5: '+f.recentKDA+' KDA, '+f.recentWR+'% WR');
    lines.push('   Prior:  '+f.prevKDA+' KDA');
    lines.push('   Recent: '+f.dots.map(function(w){return w?'W':'L'}).join(' '));
    lines.push('');
  }

  // Strengths/weaknesses
  var all=PD.filter(function(x){return x.games>=3});
  function pctRank(key,inv){
    var sorted=[].concat(all).sort(function(a,b){return a[key]-b[key]});
    var idx=sorted.findIndex(function(x){return x.player===playerName});
    var pc=idx/(sorted.length-1||1);
    return inv?1-pc:pc;
  }
  var strengths=[],weaknesses=[];
  var checks=[
    {key:'kda',name:'KDA'},{key:'winRate',name:'Win Rate'},{key:'killsPerGame',name:'Kills'},
    {key:'deathsPerGame',name:'Deaths',inv:true},{key:'csPerMin',name:'CS/Min'},
    {key:'damagePerMin',name:'Damage'},{key:'visionPerMin',name:'Vision'},{key:'goldPerMin',name:'Gold'}
  ];
  checks.forEach(function(ch){
    var pc=pctRank(ch.key,ch.inv);
    if(pc>=0.8)strengths.push(ch.name+' (top '+Math.round((1-pc)*100)+'%)');
    if(pc<=0.2)weaknesses.push(ch.name+' (bottom '+Math.round(pc*100)+'%)');
  });
  if(strengths.length){lines.push('✅ STRENGTHS: '+strengths.join(', '))}
  if(weaknesses.length){lines.push('⚠️ WEAKNESSES: '+weaknesses.join(', '))}
  lines.push('');
  lines.push('═══════════════════════');

  return lines.join('\n');
}

function copyScoutReport(playerName){
  var report=generateScoutReport(playerName);
  navigator.clipboard.writeText(report).then(function(){
    var toast=document.getElementById('scoutToast');
    if(!toast){toast=document.createElement('div');toast.id='scoutToast';toast.className='scout-toast';document.body.appendChild(toast)}
    toast.textContent='📋 SCOUTING REPORT COPIED';
    toast.classList.add('show');
    setTimeout(function(){toast.classList.remove('show')},2000);
  });
}

// ════════════════════════════════════════
// BROADCAST INTRO
// ════════════════════════════════════════
function showBroadcastIntro(){
  var ov=document.createElement('div');ov.className='intro-overlay';
  ov.innerHTML='<div class="intro-logo"><span>&nbsp;</span></div><div class="intro-line"></div><div class="intro-sub">&nbsp;</div><div class="intro-stats"><div class="intro-stat"><div class="num" id="introPlayers">0</div><div class="lbl">PLAYERS</div></div><div class="intro-stat"><div class="num" id="introMatches">0</div><div class="lbl">MATCHES</div></div><div class="intro-stat"><div class="num" id="introChamps">0</div><div class="lbl">CHAMPIONS</div></div></div>';
  document.body.appendChild(ov);return ov;
}

// GO — broadcast intro, load config, load data
async function init(){
  var intro=showBroadcastIntro();
  await loadSheetConfig();
  applyConfig();
  document.getElementById('mainWrap').style.visibility='visible';
  intro.querySelector('.intro-logo span').textContent=adminConfig.leagueName;
  intro.querySelector('.intro-sub').textContent=adminConfig.subtitle;
  intro.querySelector('.intro-line').style.background='linear-gradient(90deg,'+adminConfig.colorPrimary+','+adminConfig.colorSecondary+')';
  var ls=intro.querySelector('.intro-logo span');ls.style.background='linear-gradient(135deg,'+adminConfig.colorPrimary+','+adminConfig.colorSecondary+','+adminConfig.colorAccent+')';ls.style.webkitBackgroundClip='text';ls.style.webkitTextFillColor='transparent';
  // Restart animations so they play with correct content
  intro.querySelector('.intro-logo').style.animation='none';intro.querySelector('.intro-logo').offsetHeight;intro.querySelector('.intro-logo').style.animation='';
  intro.querySelector('.intro-sub').style.animation='none';intro.querySelector('.intro-sub').offsetHeight;intro.querySelector('.intro-sub').style.animation='';
  intro.querySelector('.intro-line').style.animation='none';intro.querySelector('.intro-line').offsetHeight;intro.querySelector('.intro-line').style.animation='';
  intro.querySelector('.intro-stats').style.animation='none';intro.querySelector('.intro-stats').offsetHeight;intro.querySelector('.intro-stats').style.animation='';
  await loadData();
  renderPOTW();
  var np=PD.length;
  var nm=new Set(RAW.map(function(r){return r['Match ID']||''}).filter(function(m){return m})).size;
  var nc=new Set(RAW.map(function(r){return r['Champion']}).filter(function(c){return c})).size;
  animateCountUp(document.getElementById('introPlayers'),np,800,'int');
  animateCountUp(document.getElementById('introMatches'),nm,800,'int');
  animateCountUp(document.getElementById('introChamps'),nc,800,'int');
  setTimeout(function(){intro.classList.add('done');setTimeout(function(){intro.remove()},900)},2800);
  buildTicker();animateMetaNumbers();
}
init();
</script>
</body>
</html>
